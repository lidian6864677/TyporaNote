卡顿优化





CPU

- 对象的创建 调整 销毁 放到子线程操作
- 预排版： 文本的计算
- 预渲染： 文本的异步绘制，合成，图片的解码  在子线程中操作

facebook   ASDK  可以实现

GPU

- 减少离屏渲染，  
- 利用CPU减轻GPU的压力



离屏渲染：

当我们 设置圆角 和 masktobounce一起设置的时候会触发

阴影、光栅化。

离屏渲染是在GPU层面出现的。 \

当UI视图的标记为 不能在显示当前屏幕之前就预合成，机会新开辟一块缓冲区去合成

就是离屏渲染， 因为这增加了GPU的工作量，有可能造成CPU和GPU的整体时间超过了16.7ms就会造成屏幕显示的掉帧，也就是卡顿，所以我们要注意这个离屏渲染



如何避免









当我们指定了UI视图的某些属性标记为他在未预合成之前不能用于当前屏幕上面直接显示的时候，离屏渲染的概念起源于GPU层面，值得是在当前屏幕路缓冲区以外新开辟一个缓冲区 进行渲染操作。







CPU和GPU在进行视图绘制中做了很多工作 离屏渲染在GPU的层面上出现的，由于离屏渲染使GPU层面触发了openGL的多通道渲染管线，产生了额外的开销

触发离屏渲染的时候会增加GPU的工作量， 如果GPU的工作量增加了， 有可能导致CPU和GPU加起来的总毫秒超过了16.7ms 那么就可能导致UI的卡顿和掉帧。所以要避免离屏渲染。

离屏渲染会创建新的缓冲区，有上下文的切换，所以GPU会有额外的开销。

1. 对于纹理的渲染  减少触发离屏渲染，可以依托于CPU的异步绘制机制 减轻GPU的压力
2. 混合视图， 视图层级如果特别复杂的话，混合叠加视图的话，GPU会对每一个视图的合成像素值的合成计算，减轻复杂性会减轻压力 ， 也可以CPU异步绘制 达到 GPU的视图层级少， 就减轻了GPU的压力

1. 对象的创建  调整  销毁  放到子线程去做
2. 预排版，对于UI的布局计算文本计算  放到子线程去做  主线程就有充足的时间相应用户操作
3. 预渲染，文本的异步绘制，图片的解码  都在子线程操作

