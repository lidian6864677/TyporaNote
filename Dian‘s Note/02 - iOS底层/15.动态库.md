## 动态库生成

1. 生成.o文件     为使用的AFN的文件生成  模拟编译器编译阶段

   ```
   clang -x objective-c \
   -target x86_64-apple-macos11.1 \
   -fobjc-arc \
   -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.1.sdk \
   -c test.m -o test.o \
   -I ./AFNetworking
   ```

2. 动态库查看

   ```shell
   objdump --macho --exports-trie '/Users/dian1/Desktop/视频/009-Logic iOS 高级强化VIP班/20210122强化班第 四 节 课：动态库/动态库/上课代码/动态库原理_静态库转动态库/dylib/libTestExample.dylib'
   ```


3. 

   ```
   Otool -l xxx grep "YYY" -A 5
   xxx: 可指定文件名称
   YYY： 搜索关键字
   -A 5 : 向下展示5行	
   ```

   



### tdb格式

tdb  全程是 text-based stub libraries， 本质上就是一个YAML描述的文本文件 

他的作用是用于记录动态库的一些信息，包括导出符号、动态库的构架信息、动态库的依赖信息

用于避免在真机开发过程中直接使用传统的 dylib 

对于真机来说  由于动态库都是在设备上，在xcode上使用基于tdb格式的伪framework可以大大较小xcode的大小

### shell脚本

```shell

LANGUAGE=objective-c
TARGET=x86_64-apple-macos11.1
SYSROOT=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.1.sdk

FILE_NAME=test
STATICLIBRARY=TestExample
HEAD_PATH=./dylib
LIBRARY_PATH=./dylib

echo "-------------编译test.m to test.o------------------"
clang -x $LANGUAGE  \
-target $TARGET     \
-fobjc-arc          \
-isysroot $SYSROOT  \
-I ${HEAD_PATH}   \
-c ${FILE_NAME}.m -o ${FILE_NAME}.o
echo "-------------进入到dylib目录------------------"
pushd ${HEAD_PATH}
echo "-------------编译TestExample.m to TestExample.o------------------"

clang -x $LANGUAGE  \
-target $TARGET     \
-fobjc-arc          \
-isysroot $SYSROOT  \
-c ${STATICLIBRARY}.m -o ${STATICLIBRARY}.o





echo "-------------编译动态库TestExample.o to TestExample.dylib------------------"

clang -dynamiclib   \
-target $TARGET     \
-fobjc-arc          \
-isysroot $SYSROOT  \
${STATICLIBRARY}.o -o lib${STATICLIBRARY}.dylib

echo "-------------退出dylib目录------------------"
popd

echo "-------------test.o链接libTestExample.dylib to test EXEC------------------"
clang -target $TARGET   \
-fobjc-arc              \
-isysroot $SYSROOT      \
-L ${LIBRARY_PATH}       \
-l${STATICLIBRARY} \
$FILE_NAME.o -o $FILE_NAME

```

