<!doctype html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<title>面试题汇总</title><link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css'><style type='text/css'>html, body {overflow-x: initial !important;}@include-when-export url(http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/**
 * css forked from https://github.com/GitbookIO/gitbook 
 * www.gitbook.com
 * Apache License
 * https://github.com/GitbookIO/gitbook/blob/master/LICENSE
 **/

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: normal;
    src: local('Open Sans Regular'),url('./github/400.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: normal;
    src: local('Open Sans Italic'),url('./github/400i.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: bold;
    src: local('Open Sans Bold'),url('./github/700.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: bold;
    src: local('Open Sans Bold Italic'),url('./github/700i.woff') format('woff')
}

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
	-webkit-font-smoothing: antialiased;
}

#write{
    max-width: 800px;
  	margin: 0 auto;
  	padding: 20px 30px 40px 30px;
	padding-top: 20px;
}

#write:after{
	height:80px;
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}
body > *:last-child {
    margin-bottom: 0 !important;
}
a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    -webkit-font-smoothing: antialiased;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    /*background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;*/
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
   padding-bottom: .3em;
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}
h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 4px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
    border-bottom: 1px solid #ddd;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}
body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}
a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}
h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}
li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dddddd;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
}
table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n) {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-gutters {
    border-right: 1px solid #ddd;
}

pre.md-fences,
.md-fences,
code,
tt {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}
pre.md-fences,
.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding: 0.2em 1em;
    padding-top: 8px;
    padding-bottom: 6px;
}
.task-list{
	padding-left: 0;
}

.task-list-item {
	padding-left:32px;
}

.task-list-item input {
  top: 3px;
  left: 8px;
}

@media screen and (min-width: 914px) {
    /*body {
        width: 854px;
        margin: 0 auto;
    }*/
}
@media print {
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag{
	color: inherit;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}
@include-when-export url(http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/**
 * css forked from https://github.com/GitbookIO/gitbook 
 * www.gitbook.com
 * Apache License
 * https://github.com/GitbookIO/gitbook/blob/master/LICENSE
 **/

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: normal;
    src: local('Open Sans Regular'),url('./github/400.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: normal;
    src: local('Open Sans Italic'),url('./github/400i.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: bold;
    src: local('Open Sans Bold'),url('./github/700.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: bold;
    src: local('Open Sans Bold Italic'),url('./github/700i.woff') format('woff')
}

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
	-webkit-font-smoothing: antialiased;
}

#write{
    max-width: 800px;
  	margin: 0 auto;
  	padding: 20px 30px 40px 30px;
	padding-top: 20px;
}

#write:after{
	height:80px;
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}
body > *:last-child {
    margin-bottom: 0 !important;
}
a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    -webkit-font-smoothing: antialiased;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    /*background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;*/
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
   padding-bottom: .3em;
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}
h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 4px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
    border-bottom: 1px solid #ddd;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}
body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}
a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}
h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}
li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dddddd;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
}
table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n) {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-gutters {
    border-right: 1px solid #ddd;
}

pre.md-fences,
.md-fences,
code,
tt {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}
pre.md-fences,
.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding: 0.2em 1em;
    padding-top: 8px;
    padding-bottom: 6px;
}
.task-list{
	padding-left: 0;
}

.task-list-item {
	padding-left:32px;
}

.task-list-item input {
  top: 3px;
  left: 8px;
}

@media screen and (min-width: 914px) {
    /*body {
        width: 854px;
        margin: 0 auto;
    }*/
}
@media print {
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag{
	color: inherit;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}
.CodeMirror { height: auto; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; }
.CodeMirror-lines { padding: 4px 0px; }
.CodeMirror pre { }
.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { background-color: white; }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background-color: rgb(247, 247, 247); white-space: nowrap; }
.CodeMirror-linenumbers { }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.CodeMirror div.CodeMirror-cursor { border-left-width: 1px; border-left-style: solid; border-left-color: black; z-index: 3; }
.CodeMirror div.CodeMirror-secondarycursor { border-left-width: 1px; border-left-style: solid; border-left-color: silver; }
.CodeMirror.cm-keymap-fat-cursor div.CodeMirror-cursor { width: auto; border: 0px; background-color: rgb(119, 238, 119); z-index: 1; background-position: initial initial; background-repeat: initial initial; }
.CodeMirror div.CodeMirror-cursor.CodeMirror-overwrite { }
.cm-tab { display: inline-block; }
.cm-s-typora-default .cm-header, .cm-s-typora-default .cm-property { color: rgb(217, 79, 138); }
.cm-s-typora-default pre.cm-header1:not(.cm-atom) :not(.cm-overlay) { font-size: 2rem; line-height: 2rem; }
.cm-s-typora-default pre.cm-header2:not(.cm-atom) :not(.cm-overlay) { font-size: 1.4rem; line-height: 1.4rem; }
.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number { color: rgb(149, 132, 134); }
.cm-s-typora-default .cm-table-row, .cm-s-typora-default .cm-block-start { font-family: monospace; }
.cm-s-typora-default .cm-comment { color: rgb(74, 90, 159); font-family: monospace; }
.cm-s-typora-default .cm-tag { color: rgb(169, 68, 66); }
.cm-s-typora-default .cm-string { color: rgb(126, 134, 169); }
.cm-s-typora-default .cm-link { color: rgb(196, 122, 15); text-decoration: underline; }
.cm-s-typora-default .cm-variable-2, .cm-s-typora-default .cm-variable-1 { color: inherit; }
.cm-s-typora-default .cm-overlay { font-size: 1rem; font-family: monospace; }
.CodeMirror.cm-s-typora-default div.CodeMirror-cursor { border-left-width: 3px; border-left-style: solid; border-left-color: rgb(228, 98, 154); }
.cm-s-typora-default .CodeMirror-activeline-background { left: -60px; right: -30px; background-color: rgba(204, 204, 204, 0.2); background-position: initial initial; background-repeat: initial initial; }
.cm-s-typora-default .CodeMirror-gutters { border-right-style: none; background-color: inherit; }
.cm-s-typora-default .cm-trailing-space-new-line::after, .cm-startspace::after, .cm-starttab .cm-tab::after { content: '•'; position: absolute; left: 0px; opacity: 0; font-family: LetterGothicStd, monospace; }
.os-windows .cm-startspace::after, .os-windows .cm-starttab .cm-tab::after { left: -0.1em; }
.cm-starttab .cm-tab::after { content: ' '; }
.cm-startspace, .cm-tab, .cm-starttab, .cm-trailing-space-a, .cm-trailing-space-b, .cm-trailing-space-new-line { font-family: monospace; position: relative; }
.cm-s-typora-default .cm-trailing-space-new-line::after { content: '↓'; opacity: 0.3; }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: black; }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-property { color: black; }
.cm-s-inner .cm-operator { color: black; }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: blue; }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: bold; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: rgb(255, 0, 0); }
.cm-invalidchar { color: rgb(255, 0, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.CodeMirror-activeline-background { background-color: rgb(232, 242, 255); background-position: initial initial; background-repeat: initial initial; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 100%; outline: none; position: relative; box-sizing: content-box; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow-x: hidden; overflow-y: scroll; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow-y: hidden; overflow-x: scroll; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border-width: 0px; background-color: transparent; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background-position: initial initial; background-repeat: initial initial; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: -webkit-fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-widget { }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.CodeMirror-selected { background-color: rgb(217, 217, 217); background-position: initial initial; background-repeat: initial initial; }
.CodeMirror-focused .CodeMirror-selected { background-color: rgb(215, 212, 240); background-position: initial initial; background-repeat: initial initial; }
.cm-searching { background-color: rgba(255, 255, 0, 0.4); background-position: initial initial; background-repeat: initial initial; }
.CodeMirror span { }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


@include-when-export url(http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/**
 * css forked from https://github.com/GitbookIO/gitbook 
 * www.gitbook.com
 * Apache License
 * https://github.com/GitbookIO/gitbook/blob/master/LICENSE
 **/

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: normal;
    src: local('Open Sans Regular'),url('./github/400.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: normal;
    src: local('Open Sans Italic'),url('./github/400i.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: bold;
    src: local('Open Sans Bold'),url('./github/700.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: bold;
    src: local('Open Sans Bold Italic'),url('./github/700i.woff') format('woff')
}

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
	-webkit-font-smoothing: antialiased;
}

#write{
    max-width: 800px;
  	margin: 0 auto;
  	padding: 20px 30px 40px 30px;
	padding-top: 20px;
}

#write:after{
	height:80px;
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}
body > *:last-child {
    margin-bottom: 0 !important;
}
a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    -webkit-font-smoothing: antialiased;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    /*background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;*/
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
   padding-bottom: .3em;
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}
h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 4px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
    border-bottom: 1px solid #ddd;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}
body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}
a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}
h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}
li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dddddd;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
}
table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n) {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-gutters {
    border-right: 1px solid #ddd;
}

pre.md-fences,
.md-fences,
code,
tt {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}
pre.md-fences,
.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding: 0.2em 1em;
    padding-top: 8px;
    padding-bottom: 6px;
}
.task-list{
	padding-left: 0;
}

.task-list-item {
	padding-left:32px;
}

.task-list-item input {
  top: 3px;
  left: 8px;
}

@media screen and (min-width: 914px) {
    /*body {
        width: 854px;
        margin: 0 auto;
    }*/
}
@media print {
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag{
	color: inherit;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}
html { font-size: 14px; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1rem; line-height: 1.42857143; color: rgb(51, 51, 51); background-color: rgb(255, 255, 255); overflow-x: hidden; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { background-color: rgb(181, 214, 252); text-shadow: none; background-position: initial initial; background-repeat: initial initial; }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; padding-bottom: 70px; white-space: pre-wrap; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export #write { margin: 0px auto; }
#write > p:first-child, #write > ul:first-child, #write > ol:first-child, #write > pre:first-child, #write > blockquote:first-child, #write > div:first-child, #write > table:first-child { margin-top: 30px; }
img { max-width: 100%; }
input, button, select, textarea { color: inherit; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; line-height: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
::before, ::after, * { box-sizing: border-box; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write div, #write pre { width: inherit; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6 { position: relative; }
h1 { font-size: 2rem; }
p { -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.mathjax-block { margin-top: 0px; margin-bottom: 0px; -webkit-margin-before: 0rem; -webkit-margin-after: 0rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: bold; font-style: italic; }
a { cursor: pointer; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; margin: 4px 0px 0px; }
tr { page-break-inside: avoid; page-break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; page-break-inside: auto; }
table.md-table td { min-width: 80px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
pre { white-space: pre-wrap; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences, pre.md-fences { font-size: 0.9rem; display: block; page-break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; position: relative !important; background-position: inherit inherit; background-repeat: inherit inherit; }
.md-fences .CodeMirror.CodeMirror-wrap { top: -1.6em; margin-bottom: -1.6em; }
.md-fences.mock-cm { white-space: pre-wrap; }
.show-fences-line-number pre.md-fences { padding-left: 0px; }
.show-fences-line-number pre.md-fences.mock-cm { padding-left: 40px; }
.footnotes { color: rgb(136, 136, 136); font-size: 0.9rem; padding-top: 1em; padding-bottom: 1em; }
.footnotes + .footnotes { margin-top: -1em; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background-color: transparent; text-decoration: none; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1rem; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: normal; text-align: left; box-sizing: content-box; direction: ltr; background-position: initial initial; background-repeat: initial initial; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li p, li .mathjax-block { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; }
@media print { 
  html, body { height: 100%; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  h1, h2, h3, h4, h5, h6 { page-break-after: avoid; orphans: 2; }
  p { orphans: 4; }
  @page { margin: 20mm 0mm; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
#write pre.md-meta-block { font-size: 0.8rem; min-height: 2.86rem; white-space: pre-wrap; background-color: rgb(204, 204, 204); display: block; background-position: initial initial; background-repeat: initial initial; }
p > .md-image:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: none; box-shadow: none; }
.task-list { list-style-type: none; }
.task-list-item { position: relative; padding-left: 1em; }
.task-list-item input { position: absolute; top: 0px; left: 0px; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-top-left-radius: 10px; border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc::after, .md-toc-content::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: bold; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
.md-toc-h6 { margin-left: 12em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 8em; }
  .md-toc-h6 { margin-left: 9.5em; }
}
a.md-toc-inner { color: inherit; font-size: inherit; font-style: inherit; font-weight: inherit; text-decoration: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: '.'; }
.md-tag { opacity: 0.5; }
code { text-align: left; }
h1 .md-tag, h2 .md-tag, h3 .md-tag, h4 .md-tag, h5 .md-tag, h6 .md-tag { font-weight: initial; opacity: 0.35; }
a.md-header-anchor.md-print-anchor { border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: none !important; background-color: transparent !important; text-shadow: initial !important; background-position: initial initial !important; background-repeat: initial initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.mathjax-block .MathJax_SVG_Display { text-align: center; margin: 1em 0em; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 100%; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: monospace; }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: normal; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { -webkit-transition: none; transition: none; }


@include-when-export url(http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/**
 * css forked from https://github.com/GitbookIO/gitbook 
 * www.gitbook.com
 * Apache License
 * https://github.com/GitbookIO/gitbook/blob/master/LICENSE
 **/

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: normal;
    src: local('Open Sans Regular'),url('./github/400.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: normal;
    src: local('Open Sans Italic'),url('./github/400i.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: bold;
    src: local('Open Sans Bold'),url('./github/700.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: bold;
    src: local('Open Sans Bold Italic'),url('./github/700i.woff') format('woff')
}

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
	-webkit-font-smoothing: antialiased;
}

#write{
    max-width: 800px;
  	margin: 0 auto;
  	padding: 20px 30px 40px 30px;
	padding-top: 20px;
}

#write:after{
	height:80px;
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}
body > *:last-child {
    margin-bottom: 0 !important;
}
a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    -webkit-font-smoothing: antialiased;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    /*background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;*/
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
   padding-bottom: .3em;
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}
h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 4px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
    border-bottom: 1px solid #ddd;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}
body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}
a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}
h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}
li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dddddd;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
}
table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n) {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-gutters {
    border-right: 1px solid #ddd;
}

pre.md-fences,
.md-fences,
code,
tt {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}
pre.md-fences,
.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding: 0.2em 1em;
    padding-top: 8px;
    padding-bottom: 6px;
}
.task-list{
	padding-left: 0;
}

.task-list-item {
	padding-left:32px;
}

.task-list-item input {
  top: 3px;
  left: 8px;
}

@media screen and (min-width: 914px) {
    /*body {
        width: 854px;
        margin: 0 auto;
    }*/
}
@media print {
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag{
	color: inherit;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}
@include-when-export url(http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/**
 * css forked from https://github.com/GitbookIO/gitbook 
 * www.gitbook.com
 * Apache License
 * https://github.com/GitbookIO/gitbook/blob/master/LICENSE
 **/

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: normal;
    src: local('Open Sans Regular'),url('./github/400.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: normal;
    src: local('Open Sans Italic'),url('./github/400i.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: bold;
    src: local('Open Sans Bold'),url('./github/700.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: bold;
    src: local('Open Sans Bold Italic'),url('./github/700i.woff') format('woff')
}

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
	-webkit-font-smoothing: antialiased;
}

#write{
    max-width: 800px;
  	margin: 0 auto;
  	padding: 20px 30px 40px 30px;
	padding-top: 20px;
}

#write:after{
	height:80px;
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}
body > *:last-child {
    margin-bottom: 0 !important;
}
a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    -webkit-font-smoothing: antialiased;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    /*background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;*/
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
   padding-bottom: .3em;
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}
h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 4px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
    border-bottom: 1px solid #ddd;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}
body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}
a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}
h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}
li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dddddd;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
}
table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n) {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-gutters {
    border-right: 1px solid #ddd;
}

pre.md-fences,
.md-fences,
code,
tt {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}
pre.md-fences,
.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding: 0.2em 1em;
    padding-top: 8px;
    padding-bottom: 6px;
}
.task-list{
	padding-left: 0;
}

.task-list-item {
	padding-left:32px;
}

.task-list-item input {
  top: 3px;
  left: 8px;
}

@media screen and (min-width: 914px) {
    /*body {
        width: 854px;
        margin: 0 auto;
    }*/
}
@media print {
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag{
	color: inherit;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}
@include-when-export url(http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/**
 * css forked from https://github.com/GitbookIO/gitbook 
 * www.gitbook.com
 * Apache License
 * https://github.com/GitbookIO/gitbook/blob/master/LICENSE
 **/

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: normal;
    src: local('Open Sans Regular'),url('./github/400.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: normal;
    src: local('Open Sans Italic'),url('./github/400i.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: bold;
    src: local('Open Sans Bold'),url('./github/700.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: bold;
    src: local('Open Sans Bold Italic'),url('./github/700i.woff') format('woff')
}

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
	-webkit-font-smoothing: antialiased;
}

#write{
    max-width: 800px;
  	margin: 0 auto;
  	padding: 20px 30px 40px 30px;
	padding-top: 20px;
}

#write:after{
	height:80px;
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}
body > *:last-child {
    margin-bottom: 0 !important;
}
a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    -webkit-font-smoothing: antialiased;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    /*background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;*/
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
   padding-bottom: .3em;
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}
h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 4px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
    border-bottom: 1px solid #ddd;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}
body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}
a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}
h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}
li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dddddd;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
}
table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n) {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-gutters {
    border-right: 1px solid #ddd;
}

pre.md-fences,
.md-fences,
code,
tt {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}
pre.md-fences,
.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding: 0.2em 1em;
    padding-top: 8px;
    padding-bottom: 6px;
}
.task-list{
	padding-left: 0;
}

.task-list-item {
	padding-left:32px;
}

.task-list-item input {
  top: 3px;
  left: 8px;
}

@media screen and (min-width: 914px) {
    /*body {
        width: 854px;
        margin: 0 auto;
    }*/
}
@media print {
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag{
	color: inherit;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}
@include-when-export url(http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/**
 * css forked from https://github.com/GitbookIO/gitbook 
 * www.gitbook.com
 * Apache License
 * https://github.com/GitbookIO/gitbook/blob/master/LICENSE
 **/

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: normal;
    src: local('Open Sans Regular'),url('./github/400.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: normal;
    src: local('Open Sans Italic'),url('./github/400i.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: bold;
    src: local('Open Sans Bold'),url('./github/700.woff') format('woff')
}

@font-face {
    font-family: 'Open Sans';
    font-style: italic;
    font-weight: bold;
    src: local('Open Sans Bold Italic'),url('./github/700i.woff') format('woff')
}

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
	-webkit-font-smoothing: antialiased;
}

#write{
    max-width: 800px;
  	margin: 0 auto;
  	padding: 20px 30px 40px 30px;
	padding-top: 20px;
}

#write:after{
	height:80px;
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}
body > *:last-child {
    margin-bottom: 0 !important;
}
a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    -webkit-font-smoothing: antialiased;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    /*background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;*/
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
   padding-bottom: .3em;
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}
h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 4px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
    border-bottom: 1px solid #ddd;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}
body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}
body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}
a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}
h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}
li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dddddd;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
}
table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n) {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #cccccc;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-gutters {
    border-right: 1px solid #ddd;
}

pre.md-fences,
.md-fences,
code,
tt {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}
pre.md-fences,
.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding: 0.2em 1em;
    padding-top: 8px;
    padding-bottom: 6px;
}
.task-list{
	padding-left: 0;
}

.task-list-item {
	padding-left:32px;
}

.task-list-item input {
  top: 3px;
  left: 8px;
}

@media screen and (min-width: 914px) {
    /*body {
        width: 854px;
        margin: 0 auto;
    }*/
}
@media print {
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
    border-radius: 3px;
    font-family: Consolas, "Liberation Mono", Courier, monospace;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag{
	color: inherit;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}
</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-mac'><div class='md-toc' mdtype='toc'><p class="md-toc-content"><span class="md-toc-item md-toc-h1" data-ref="c6"><a class="md-toc-inner" href="#header-c6">知识点树</a></span><span class="md-toc-item md-toc-h2" data-ref="c7"><a class="md-toc-inner" href="#header-c7">思维导图</a></span><span class="md-toc-item md-toc-h1" data-ref="c13"><a class="md-toc-inner" href="#header-c13">OC的理解与特性</a></span><span class="md-toc-item md-toc-h2" data-ref="c14"><a class="md-toc-inner" href="#header-c14">动态特性</a></span><span class="md-toc-item md-toc-h1" data-ref="c32"><a class="md-toc-inner" href="#header-c32">Runtime(运行时)</a></span><span class="md-toc-item md-toc-h2" data-ref="c33"><a class="md-toc-inner" href="#header-c33">基本解释</a></span><span class="md-toc-item md-toc-h2" data-ref="c54"><a class="md-toc-inner" href="#header-c54">简单实例</a></span><span class="md-toc-item md-toc-h2" data-ref="c65"><a class="md-toc-inner" href="#header-c65">实际应用</a></span><span class="md-toc-item md-toc-h3" data-ref="c66"><a class="md-toc-inner" href="#header-c66">Json到Model的转化</a></span><span class="md-toc-item md-toc-h3" data-ref="c77"><a class="md-toc-inner" href="#header-c77">快速归档</a></span><span class="md-toc-item md-toc-h3" data-ref="c88"><a class="md-toc-inner" href="#header-c88">访问私有变量</a></span><span class="md-toc-item md-toc-h3" data-ref="c95"><a class="md-toc-inner" href="#header-c95">给分类（Category）添加属性</a></span><span class="md-toc-item md-toc-h3" data-ref="c111"><a class="md-toc-inner" href="#header-c111">Method swizzling(方法交换)</a></span><span class="md-toc-item md-toc-h3" data-ref="c147"><a class="md-toc-inner" href="#header-c147">KVO的底层实现</a></span><span class="md-toc-item md-toc-h1" data-ref="c168"><a class="md-toc-inner" href="#header-c168">Runloop(运行循环)</a></span><span class="md-toc-item md-toc-h2" data-ref="c169"><a class="md-toc-inner" href="#header-c169">基本解释</a></span><span class="md-toc-item md-toc-h3" data-ref="c170"><a class="md-toc-inner" href="#header-c170">作用(作用重大)</a></span><span class="md-toc-item md-toc-h3" data-ref="c183"><a class="md-toc-inner" href="#header-c183">重要说明</a></span><span class="md-toc-item md-toc-h3" data-ref="c193"><a class="md-toc-inner" href="#header-c193">Runloop对象</a></span><span class="md-toc-item md-toc-h3" data-ref="c207"><a class="md-toc-inner" href="#header-c207">Runloop与线程</a></span><span class="md-toc-item md-toc-h3" data-ref="c218"><a class="md-toc-inner" href="#header-c218">获得Runloop对象</a></span><span class="md-toc-item md-toc-h2" data-ref="c220"><a class="md-toc-inner" href="#header-c220">基本应用</a></span><span class="md-toc-item md-toc-h1" data-ref="c266"><a class="md-toc-inner" href="#header-c266">位移枚举</a></span><span class="md-toc-item md-toc-h2" data-ref="c267"><a class="md-toc-inner" href="#header-c267">基本理解</a></span><span class="md-toc-item md-toc-h1" data-ref="c270"><a class="md-toc-inner" href="#header-c270">MRC／ARC(内存管理)</a></span><span class="md-toc-item md-toc-h2" data-ref="c271"><a class="md-toc-inner" href="#header-c271">简述基本原则</a></span><span class="md-toc-item md-toc-h2" data-ref="c288"><a class="md-toc-inner" href="#header-c288">其他注意事项</a></span><span class="md-toc-item md-toc-h1" data-ref="c326"><a class="md-toc-inner" href="#header-c326">MVC/MVVM</a></span><span class="md-toc-item md-toc-h2" data-ref="c327"><a class="md-toc-inner" href="#header-c327">如何理解MVC设计模式</a></span><span class="md-toc-item md-toc-h2" data-ref="c346"><a class="md-toc-inner" href="#header-c346">如何理解MVVM设计模式</a></span><span class="md-toc-item md-toc-h1" data-ref="c356"><a class="md-toc-inner" href="#header-c356">iOS常见加密方法</a></span><span class="md-toc-item md-toc-h2" data-ref="c367"><a class="md-toc-inner" href="#header-c367">base64加密</a></span><span class="md-toc-item md-toc-h3" data-ref="c391"><a class="md-toc-inner" href="#header-c391">将文件进行加密</a></span><span class="md-toc-item md-toc-h3" data-ref="c393"><a class="md-toc-inner" href="#header-c393">将文件进行解密</a></span><span class="md-toc-item md-toc-h3" data-ref="c395"><a class="md-toc-inner" href="#header-c395">利用终端命令进行base64运算:</a></span><span class="md-toc-item md-toc-h2" data-ref="c397"><a class="md-toc-inner" href="#header-c397">POST加密</a></span><span class="md-toc-item md-toc-h3" data-ref="c398"><a class="md-toc-inner" href="#header-c398">A. 搭建UI框架</a></span><span class="md-toc-item md-toc-h3" data-ref="c420"><a class="md-toc-inner" href="#header-c420">B. 实现基本加密</a></span><span class="md-toc-item md-toc-h3" data-ref="c440"><a class="md-toc-inner" href="#header-c440">C. 实现页面间跳转</a></span><span class="md-toc-item md-toc-h2" data-ref="c462"><a class="md-toc-inner" href="#header-c462">Token值介绍</a></span><span class="md-toc-item md-toc-h2" data-ref="c513"><a class="md-toc-inner" href="#header-c513">MD5加密--(信息-摘要算法) 哈希算法之一</a></span><span class="md-toc-item md-toc-h3" data-ref="c519"><a class="md-toc-inner" href="#header-c519">基本介绍</a></span><span class="md-toc-item md-toc-h3" data-ref="c558"><a class="md-toc-inner" href="#header-c558">使用方法</a></span><span class="md-toc-item md-toc-h2" data-ref="c592"><a class="md-toc-inner" href="#header-c592">钥匙串访问</a></span><span class="md-toc-item md-toc-h3" data-ref="c593"><a class="md-toc-inner" href="#header-c593">基本介绍</a></span><span class="md-toc-item md-toc-h3" data-ref="c607"><a class="md-toc-inner" href="#header-c607">简单使用</a></span><span class="md-toc-item md-toc-h2" data-ref="c630"><a class="md-toc-inner" href="#header-c630">指纹识别</a></span><span class="md-toc-item md-toc-h3" data-ref="c631"><a class="md-toc-inner" href="#header-c631">简单介绍</a></span><span class="md-toc-item md-toc-h3" data-ref="c639"><a class="md-toc-inner" href="#header-c639">使用步骤</a></span><span class="md-toc-item md-toc-h2" data-ref="c657"><a class="md-toc-inner" href="#header-c657">AES/RSA</a></span><span class="md-toc-item md-toc-h3" data-ref="c658"><a class="md-toc-inner" href="#header-c658">简单介绍</a></span><span class="md-toc-item md-toc-h3" data-ref="c686"><a class="md-toc-inner" href="#header-c686">使用步骤</a></span><span class="md-toc-item md-toc-h1" data-ref="c691"><a class="md-toc-inner" href="#header-c691">网络协议</a></span><span class="md-toc-item md-toc-h2" data-ref="c692"><a class="md-toc-inner" href="#header-c692">TCP和UDP的区别于联系</a></span><span class="md-toc-item md-toc-h2" data-ref="c703"><a class="md-toc-inner" href="#header-c703">TCP连接的三次握手</a></span><span class="md-toc-item md-toc-h2" data-ref="c714"><a class="md-toc-inner" href="#header-c714">SOCKET原理</a></span><span class="md-toc-item md-toc-h3" data-ref="c715"><a class="md-toc-inner" href="#header-c715">套接字（socket）概念</a></span><span class="md-toc-item md-toc-h3" data-ref="c717"><a class="md-toc-inner" href="#header-c717">建立socket连接</a></span><span class="md-toc-item md-toc-h3" data-ref="c719"><a class="md-toc-inner" href="#header-c719">SOCKET连接与TCP连接</a></span><span class="md-toc-item md-toc-h3" data-ref="c721"><a class="md-toc-inner" href="#header-c721">Socket连接与HTTP连接</a></span><span class="md-toc-item md-toc-h3" data-ref="c725"><a class="md-toc-inner" href="#header-c725">Scoket连接和HTTP连接的区别：</a></span><span class="md-toc-item md-toc-h2" data-ref="c736"><a class="md-toc-inner" href="#header-c736">HTTP协议的特点，关于HTTP请求GET和POST的区别</a></span><span class="md-toc-item md-toc-h1" data-ref="c778"><a class="md-toc-inner" href="#header-c778">多线程</a></span><span class="md-toc-item md-toc-h2" data-ref="c779"><a class="md-toc-inner" href="#header-c779">线程与进程的区别和联系?</a></span><span class="md-toc-item md-toc-h2" data-ref="c799"><a class="md-toc-inner" href="#header-c799">多线程编程</a></span><span class="md-toc-item md-toc-h2" data-ref="c834"><a class="md-toc-inner" href="#header-c834">定时器与线程的区别;</a></span><span class="md-toc-item md-toc-h2" data-ref="c842"><a class="md-toc-inner" href="#header-c842">平常常用的多线程处理方式及优缺点</a></span><span class="md-toc-item md-toc-h3" data-ref="c845"><a class="md-toc-inner" href="#header-c845">四种方式的优缺点介绍:</a></span><span class="md-toc-item md-toc-h2" data-ref="c859"><a class="md-toc-inner" href="#header-c859">GCD线程死锁</a></span><span class="md-toc-item md-toc-h2" data-ref="c908"><a class="md-toc-inner" href="#header-c908">队列和多线程的使用原理</a></span><span class="md-toc-item md-toc-h1" data-ref="c934"><a class="md-toc-inner" href="#header-c934">单例</a></span><span class="md-toc-item md-toc-h2" data-ref="c935"><a class="md-toc-inner" href="#header-c935">简单理解</a></span><span class="md-toc-item md-toc-h2" data-ref="c941"><a class="md-toc-inner" href="#header-c941">手写单例</a></span><span class="md-toc-item md-toc-h1" data-ref="c945"><a class="md-toc-inner" href="#header-c945">keyPath/KVC/KVO</a></span><span class="md-toc-item md-toc-h2" data-ref="c946"><a class="md-toc-inner" href="#header-c946">键路径</a></span><span class="md-toc-item md-toc-h2" data-ref="c957"><a class="md-toc-inner" href="#header-c957">键值编码KVC</a></span><span class="md-toc-item md-toc-h2" data-ref="c965"><a class="md-toc-inner" href="#header-c965">键值观察KVO</a></span><span class="md-toc-item md-toc-h2" data-ref="c973"><a class="md-toc-inner" href="#header-c973">Demo</a></span><span class="md-toc-item md-toc-h2" data-ref="c981"><a class="md-toc-inner" href="#header-c981">KVC机制通过key找到value的原理</a></span><span class="md-toc-item md-toc-h2" data-ref="c995"><a class="md-toc-inner" href="#header-c995">在 Objective-C 中如何实现 KVO</a></span><span class="md-toc-item md-toc-h2" data-ref="c1012"><a class="md-toc-inner" href="#header-c1012">代理的作用</a></span><span class="md-toc-item md-toc-h2" data-ref="c1026"><a class="md-toc-inner" href="#header-c1026">NSNotification、Block、Delegate和KVO的区别</a></span><span class="md-toc-item md-toc-h2" data-ref="c1044"><a class="md-toc-inner" href="#header-c1044">实际应用</a></span><span class="md-toc-item md-toc-h1" data-ref="c1056"><a class="md-toc-inner" href="#header-c1056">UIViewController的完整生命周期</a></span><span class="md-toc-item md-toc-h1" data-ref="c1087"><a class="md-toc-inner" href="#header-c1087">UIImageView添加圆角</a></span><span class="md-toc-item md-toc-h1" data-ref="c1100"><a class="md-toc-inner" href="#header-c1100">程序优化</a></span><span class="md-toc-item md-toc-h2" data-ref="c1101"><a class="md-toc-inner" href="#header-c1101">内存的使用和优化的注意事项</a></span><span class="md-toc-item md-toc-h1" data-ref="c1137"><a class="md-toc-inner" href="#header-c1137">XIB与Storyboards的优缺点</a></span><span class="md-toc-item md-toc-h1" data-ref="c1157"><a class="md-toc-inner" href="#header-c1157">iOS的应用生命周期</a></span><span class="md-toc-item md-toc-h2" data-ref="c1158"><a class="md-toc-inner" href="#header-c1158">应用程序的状态</a></span><span class="md-toc-item md-toc-h1" data-ref="c1221"><a class="md-toc-inner" href="#header-c1221">数据解析</a></span><span class="md-toc-item md-toc-h2" data-ref="c1222"><a class="md-toc-inner" href="#header-c1222">XML数据解析方式各有什么不同，JSON解析有哪些框架？</a></span><span class="md-toc-item md-toc-h1" data-ref="c1240"><a class="md-toc-inner" href="#header-c1240">iOS 开发中数据持久性有哪几种?</a></span><span class="md-toc-item md-toc-h2" data-ref="c1241"><a class="md-toc-inner" href="#header-c1241">基本解释</a></span><span class="md-toc-item md-toc-h2" data-ref="c1260"><a class="md-toc-inner" href="#header-c1260">coreData</a></span><span class="md-toc-item md-toc-h3" data-ref="c1261"><a class="md-toc-inner" href="#header-c1261">CoreData的介绍：</a></span><span class="md-toc-item md-toc-h3" data-ref="c1272"><a class="md-toc-inner" href="#header-c1272">CoreData的特征：</a></span><span class="md-toc-item md-toc-h3" data-ref="c1289"><a class="md-toc-inner" href="#header-c1289">Core Data的6成员对象</a></span><span class="md-toc-item md-toc-h3" data-ref="c1309"><a class="md-toc-inner" href="#header-c1309">Core Data的功能</a></span><span class="md-toc-item md-toc-h2" data-ref="c1344"><a class="md-toc-inner" href="#header-c1344">FMDB</a></span><span class="md-toc-item md-toc-h3" data-ref="c1345"><a class="md-toc-inner" href="#header-c1345">使用框架</a></span><span class="md-toc-item md-toc-h3" data-ref="c1346"><a class="md-toc-inner" href="#header-c1346">官网地址</a></span><span class="md-toc-item md-toc-h3" data-ref="c1349"><a class="md-toc-inner" href="#header-c1349">直接拖拽</a></span><span class="md-toc-item md-toc-h3" data-ref="c1363"><a class="md-toc-inner" href="#header-c1363">Podfile</a></span><span class="md-toc-item md-toc-h3" data-ref="c1371"><a class="md-toc-inner" href="#header-c1371">单例</a></span><span class="md-toc-item md-toc-h3" data-ref="c1377"><a class="md-toc-inner" href="#header-c1377">代码小结</a></span><span class="md-toc-item md-toc-h3" data-ref="c1398"><a class="md-toc-inner" href="#header-c1398">插入数据</a></span><span class="md-toc-item md-toc-h3" data-ref="c1422"><a class="md-toc-inner" href="#header-c1422">删除数据</a></span><span class="md-toc-item md-toc-h3" data-ref="c1424"><a class="md-toc-inner" href="#header-c1424">更新数据</a></span><span class="md-toc-item md-toc-h3" data-ref="c1426"><a class="md-toc-inner" href="#header-c1426">查询数据</a></span><span class="md-toc-item md-toc-h3" data-ref="c1442"><a class="md-toc-inner" href="#header-c1442">批量插入数据</a></span><span class="md-toc-item md-toc-h3" data-ref="c1444"><a class="md-toc-inner" href="#header-c1444">FMDB 主要函数</a></span><span class="md-toc-item md-toc-h3" data-ref="c1459"><a class="md-toc-inner" href="#header-c1459">网络七层协议</a></span><span class="md-toc-item md-toc-h1" data-ref="c1506"><a class="md-toc-inner" href="#header-c1506">NSObject的load和initialize方法</a></span><span class="md-toc-item md-toc-h2" data-ref="c1507"><a class="md-toc-inner" href="#header-c1507">load和initialize的共同特点</a></span><span class="md-toc-item md-toc-h2" data-ref="c1517"><a class="md-toc-inner" href="#header-c1517">load和initialize的区别</a></span><span class="md-toc-item md-toc-h1" data-ref="c1555"><a class="md-toc-inner" href="#header-c1555">支付宝SDK使用</a></span><span class="md-toc-item md-toc-h1" data-ref="c1606"><a class="md-toc-inner" href="#header-c1606">推送</a></span><span class="md-toc-item md-toc-h2" data-ref="c1607"><a class="md-toc-inner" href="#header-c1607">远程推送</a></span><span class="md-toc-item md-toc-h2" data-ref="c1669"><a class="md-toc-inner" href="#header-c1669">极光推送</a></span><span class="md-toc-item md-toc-h3" data-ref="c1670"><a class="md-toc-inner" href="#header-c1670">要点</a></span><span class="md-toc-item md-toc-h1" data-ref="c1693"><a class="md-toc-inner" href="#header-c1693">如何追踪app崩溃率，如何解决线上闪退</a></span><span class="md-toc-item md-toc-h2" data-ref="c1697"><a class="md-toc-inner" href="#header-c1697">违反iOS系统规则产生crash的三种类型</a></span><span class="md-toc-item md-toc-h2" data-ref="c1720"><a class="md-toc-inner" href="#header-c1720">应用逻辑的Bug</a></span><span class="md-toc-item md-toc-h2" data-ref="c1728"><a class="md-toc-inner" href="#header-c1728">crash的收集</a></span><span class="md-toc-item md-toc-h1" data-ref="c1787"><a class="md-toc-inner" href="#header-c1787">什么是事件响应链</a></span><span class="md-toc-item md-toc-h2" data-ref="c1801"><a class="md-toc-inner" href="#header-c1801">响应者链（Responder Chain）</a></span><span class="md-toc-item md-toc-h3" data-ref="c1810"><a class="md-toc-inner" href="#header-c1810">响应者链有以下特点：</a></span><span class="md-toc-item md-toc-h1" data-ref="c1852"><a class="md-toc-inner" href="#header-c1852">请分析下SDWebImage的原理</a></span><span class="md-toc-item md-toc-h2" data-ref="c1865"><a class="md-toc-inner" href="#header-c1865">SDWebImage 加载图片的流程</a></span><span class="md-toc-item md-toc-h2" data-ref="c1927"><a class="md-toc-inner" href="#header-c1927">SDWebImage库的作用</a></span><span class="md-toc-item md-toc-h1" data-ref="c1972"><a class="md-toc-inner" href="#header-c1972">情景题</a></span><span class="md-toc-item md-toc-h1" data-ref="c2044"><a class="md-toc-inner" href="#header-c2044">真机测试</a></span><span class="md-toc-item md-toc-h1" data-ref="c2068"><a class="md-toc-inner" href="#header-c2068">APP发布的上架流程</a></span><span class="md-toc-item md-toc-h1" data-ref="c2086"><a class="md-toc-inner" href="#header-c2086">property属性的修饰符的作用</a></span><span class="md-toc-item md-toc-h1" data-ref="c2106"><a class="md-toc-inner" href="#header-c2106">内存的使用和优化的注意事项</a></span><span class="md-toc-item md-toc-h1" data-ref="c2147"><a class="md-toc-inner" href="#header-c2147">小问题</a></span><span class="md-toc-item md-toc-h2" data-ref="c2148"><a class="md-toc-inner" href="#header-c2148">static、self、super关键字的作用</a></span><span class="md-toc-item md-toc-h2" data-ref="c2157"><a class="md-toc-inner" href="#header-c2157">对象可以被copy的条件</a></span><span class="md-toc-item md-toc-h2" data-ref="c2164"><a class="md-toc-inner" href="#header-c2164">使用block有什么好处？</a></span><span class="md-toc-item md-toc-h2" data-ref="c2168"><a class="md-toc-inner" href="#header-c2168">Block的注意事项：</a></span><span class="md-toc-item md-toc-h2" data-ref="c2207"><a class="md-toc-inner" href="#header-c2207">动画：分为显示动画和隐式动画</a></span><span class="md-toc-item md-toc-h2" data-ref="c2220"><a class="md-toc-inner" href="#header-c2220">SSO 授权</a></span><span class="md-toc-item md-toc-h2" data-ref="c2240"><a class="md-toc-inner" href="#header-c2240">LBS地图，定位，导航</a></span><span class="md-toc-item md-toc-h2" data-ref="c2268"><a class="md-toc-inner" href="#header-c2268">应用跳转：是根据协议头跳转</a></span><span class="md-toc-item md-toc-h2" data-ref="c2276"><a class="md-toc-inner" href="#header-c2276">用@property声明的NSString（或NSArray，NSDictionary）经常使用copy关键字，为什么？</a></span><span class="md-toc-item md-toc-h2" data-ref="c2282"><a class="md-toc-inner" href="#header-c2282">分别写一个setter方法用于完成@property (nonatomic,retain)NSString <em>name和@property (nonatomic,copy) NSString *name</em></a></span><span class="md-toc-item md-toc-h2" data-ref="c2287"><a class="md-toc-inner" href="#header-c2287">常见的 Http 状态码有哪些？</a></span><span class="md-toc-item md-toc-h1" data-ref="c2292"><a class="md-toc-inner" href="#header-c2292">AFN的原理和封装</a></span><span class="md-toc-item md-toc-h1" data-ref="c2330"><a class="md-toc-inner" href="#header-c2330">二维码：</a></span><span class="md-toc-item md-toc-h1" data-ref="c2345"><a class="md-toc-inner" href="#header-c2345">项目遇到BUG</a></span></p></div><h1><a name='header-c6' class='md-header-anchor '></a>知识点树</h1><h2><a name='header-c7' class='md-header-anchor '></a>思维导图</h2><p><img src='http://upload-images.jianshu.io/upload_images/963857-2519fffa3ce15755.jpg?imageMogr2/auto-orient/strip%7CimageView2/2' alt='' /></p><hr /><p></p><h1><a name='header-c13' class='md-header-anchor '></a>OC的理解与特性</h1><h2><a name='header-c14' class='md-header-anchor '></a>动态特性</h2><ul><li>OC作为一门面向对象的语言，自然具有面向对象的语言特性：封装、继承、多态。它既具有静态语言的特性（如C++），又有动态语言的效率（动态绑定、动态加载等）。总体来讲，OC确实是一门不错的编程语言，</li><li>Objective-C具有相当多的动态特性，表现为三方面：动态类型（Dynamic typing）、动态绑定（Dynamic binding）和动态加载（Dynamic loading）。动态——必须到运行时（run time）才会做的一些事情。</li><li><mark>动态类型</mark>：即运行时再决定对象的类型，这种动态特性在日常的应用中非常常见，简单来说就是id类型。事实上，由于静态类型的固定性和可预知性，从而使用的更加广泛。静态类型是强类型，而动态类型属于弱类型，运行时决定接受者。</li><li><mark>动态绑定</mark>：基于动态类型，在某个实例对象被确定后，其类型便被确定了，该对象对应的属性和响应消息也被完全确定。</li><li><mark>动态加载</mark>：根据需求加载所需要的资源，最基本就是不同机型的适配，例如，在Retina设备上加载@2x的图片，而在老一些的普通苹设备上加载原图，让程序在运行时添加代码模块以及其他资源，用户可根据需要加载一些可执行代码和资源，而不是在启动时就加载所有组件，可执行代码可以含有和程序运行时整合的新类。 </li></ul><hr /><h1><a name='header-c32' class='md-header-anchor '></a>Runtime(运行时)</h1><h2><a name='header-c33' class='md-header-anchor '></a>基本解释</h2><ul><li>Runtime 是一套比较底层的纯C语言API 它是OC的幕后工作者 我们平时写的OC代码         <br/></li></ul><ul><li>在运行时都会编译器转为runtime的C语言代码 其中最主要的是消息机制OC的函数调用</li></ul><ul><li>成为消息发送 属于动态调用过程 在编译的时候并不能决定真正调用哪个函数事实证明</li></ul><ul><li>在编译阶段，OC可以调用任何函数，即使这个函数并未实现，只要申明过就不会报错</li></ul><ul><li>而C语言在编译阶段就会报错 只有在真正运行的时候才会根据函数的名称找到对应的函数来调用。</li></ul><h2><a name='header-c54' class='md-header-anchor '></a>简单实例</h2><p><code>obj doSometing</code></p><blockquote><p>其中obj是一个对象，makeText是一个函数名称。对于这样一个简单的调用。在编译时RunTime会将上述代码转化成:</p></blockquote><p><code>objc_msgSend(obj,@selector(doSomething);</code></p><blockquote><p>首先通过obj的isa指针找到obj对应的class。在Class中先去cache中 通过SEL查找对应函数method（猜测]cache中method列表是以]EL为key通过hash表来存储的，这样能提高函数查找速度），若 cache中未找到。再去methodList中查找，若methodlist中未找到，则取superClass中查找。若能找到，则将method加 入到cache中，以方便下次查找，并通过method中的函数指针跳转到对应的函数中 </p></blockquote><h2><a name='header-c65' class='md-header-anchor '></a>实际应用</h2><h3><a name='header-c66' class='md-header-anchor '></a>Json到Model的转化</h3><blockquote><p>在开发中相信最常用的就是接口数据需要转化成Model了（当然如果你是直接从Dict取值的话。。。），很多开发者也都使用著名的第三方库如JsonModel、Mantle或MJExtension等，如果只用而不      知其所以然，那真和“搬砖”没啥区别了，下面我们使用runtime去解析json来给Model赋值。</p></blockquote><p><em>原理描述：用runtime提供的函数遍历Model自身所有属性，如在json中有对应的值，则将其赋值。</em></p><ul><li>核心方法：在NSObject的分类中添加方法</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">1</span> &nbsp; <span class="cm-operator">-</span> (<span class="cm-variable">instancetype</span>)<span class="cm-variable">initWithDict</span>:(<span class="cm-variable">NSDictionary</span> <span class="cm-operator">*</span>)<span class="cm-variable">dict</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">2</span> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">3</span> &nbsp; &nbsp; &nbsp; <span class="cm-keyword">if</span> (<span class="cm-keyword">self</span> <span class="cm-operator">=</span> [<span class="cm-keyword">self</span> <span class="cm-variable">init</span>]) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">4</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//(1)获取类的属性及属性对应的类型</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">5</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSMutableArray</span> <span class="cm-operator">*</span> <span class="cm-variable">keys</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSMutableArray</span> <span class="cm-variable">array</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">6</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSMutableArray</span> <span class="cm-operator">*</span> <span class="cm-variable">attributes</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSMutableArray</span> <span class="cm-variable">array</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">7</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">/*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  * 例子</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">9 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  * name = value3 attribute = T@"NSString",C,N,V_value3</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * name = value4 attribute = T^i,N,V_value4</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">11 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">12</span> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable-3">unsigned</span> <span class="cm-variable-3">int</span> <span class="cm-variable">outCount</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">13</span> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">objc_property_t</span> <span class="cm-operator">*</span> <span class="cm-variable">properties</span> <span class="cm-operator">=</span> <span class="cm-variable">class_copyPropertyList</span>([<span class="cm-keyword">self</span> <span class="cm-variable">class</span>], <span class="cm-operator">&amp;</span><span class="cm-variable">outCount</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">14</span> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">outCount</span>; <span class="cm-variable">i</span> <span class="cm-operator">++</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">15</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">objc_property_t</span> <span class="cm-variable">property</span> <span class="cm-operator">=</span> <span class="cm-variable">properties</span>[<span class="cm-variable">i</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">16</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//通过property_getName函数获得属性的名字</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">17</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">NSString</span> <span class="cm-operator">*</span> <span class="cm-variable">propertyName</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSString</span> <span class="cm-variable">stringWithCString</span>:<span class="cm-variable">property_getName</span>(<span class="cm-variable">property</span>) <span class="cm-variable">encoding</span>:<span class="cm-variable">NSUTF8StringEncoding</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">18</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  [<span class="cm-variable">keys</span> <span class="cm-variable">addObject</span>:<span class="cm-variable">propertyName</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">19</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//通过property_getAttributes函数可以获得属性的名字和@encode编码</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">20</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">NSString</span> <span class="cm-operator">*</span> <span class="cm-variable">propertyAttribute</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSString</span> <span class="cm-variable">stringWithCString</span>:<span class="cm-variable">property_getAttributes</span>(<span class="cm-variable">property</span>) <span class="cm-variable">encoding</span>:<span class="cm-variable">NSUTF8StringEncoding</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">21</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  [<span class="cm-variable">attributes</span> <span class="cm-variable">addObject</span>:<span class="cm-variable">propertyAttribute</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">22</span> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">23</span> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//立即释放properties指向的内存</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">24</span> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">free</span>(<span class="cm-variable">properties</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">25</span> &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">26</span> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//(2)根据类型给属性赋值</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">27</span> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">for</span> (<span class="cm-variable">NSString</span> <span class="cm-operator">*</span> <span class="cm-variable">key</span> <span class="cm-keyword">in</span> <span class="cm-variable">keys</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">28</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ([<span class="cm-variable">dict</span> <span class="cm-variable">valueForKey</span>:<span class="cm-variable">key</span>] <span class="cm-operator">==</span> <span class="cm-keyword">nil</span>) <span class="cm-keyword">continue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">29</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  [<span class="cm-keyword">self</span> <span class="cm-variable">setValue</span>:[<span class="cm-variable">dict</span> <span class="cm-variable">valueForKey</span>:<span class="cm-variable">key</span>] <span class="cm-variable">forKey</span>:<span class="cm-variable">key</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">30</span> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">31</span> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">32</span> &nbsp; &nbsp;  <span class="cm-keyword">return</span> <span class="cm-keyword">self</span>;</span></pre></div></div></div></div></div></div></div></pre><h3><a name='header-c77' class='md-header-anchor '></a>快速归档</h3><blockquote><p>有时候我们要对一些信息进行归档，如用户信息类UserInfo，这将需要重写initWithCoder和encodeWithCoder方法，并对每个属性进行encode和decode操作。那么问题来了：当属性只有几个的时候可以轻松写完，如果有几十个属性呢？那不得写到天荒地老？。。。</p></blockquote><p><em>原理描述：用runtime提供的函数遍历Model自身所有属性，并对性encode和decode操作</em></p><ul><li>核心方法：在Model的基类中重写方法：</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-number">1</span> &nbsp; <span class="cm-operator">-</span> (<span class="cm-keyword">id</span>)<span class="cm-variable">initWithCoder</span>:(<span class="cm-variable">NSCoder</span> <span class="cm-operator">*</span>)<span class="cm-variable">aDecoder</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">2</span> &nbsp; &nbsp; &nbsp; <span class="cm-keyword">if</span> (<span class="cm-keyword">self</span> <span class="cm-operator">=</span> [<span class="cm-keyword">super</span> <span class="cm-variable">init</span>]) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">3</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable-3">unsigned</span> <span class="cm-variable-3">int</span> <span class="cm-variable">outCount</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">4</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">Ivar</span> <span class="cm-operator">*</span> <span class="cm-variable">ivars</span> <span class="cm-operator">=</span> <span class="cm-variable">class_copyIvarList</span>([<span class="cm-keyword">self</span> <span class="cm-variable">class</span>], <span class="cm-operator">&amp;</span><span class="cm-variable">outCount</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">5</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">outCount</span>; <span class="cm-variable">i</span> <span class="cm-operator">++</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">6</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">Ivar</span> <span class="cm-variable">ivar</span> <span class="cm-operator">=</span> <span class="cm-variable">ivars</span>[<span class="cm-variable">i</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">7</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSString</span> <span class="cm-operator">*</span> <span class="cm-variable">key</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSString</span> <span class="cm-variable">stringWithUTF8String</span>:<span class="cm-variable">ivar_getName</span>(<span class="cm-variable">ivar</span>)];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">8</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [<span class="cm-keyword">self</span> <span class="cm-variable">setValue</span>:[<span class="cm-variable">aDecoder</span> <span class="cm-variable">decodeObjectForKey</span>:<span class="cm-variable">key</span>] <span class="cm-variable">forKey</span>:<span class="cm-variable">key</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">9</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">10</span> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">11</span> &nbsp; &nbsp;  <span class="cm-keyword">return</span> <span class="cm-keyword">self</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">12</span>  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">13</span> &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">14</span>  <span class="cm-operator">-</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">encodeWithCoder</span>:(<span class="cm-variable">NSCoder</span> <span class="cm-operator">*</span>)<span class="cm-variable">aCoder</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">15</span> &nbsp; &nbsp;  <span class="cm-variable-3">unsigned</span> <span class="cm-variable-3">int</span> <span class="cm-variable">outCount</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">16</span> &nbsp; &nbsp;  <span class="cm-variable">Ivar</span> <span class="cm-operator">*</span> <span class="cm-variable">ivars</span> <span class="cm-operator">=</span> <span class="cm-variable">class_copyIvarList</span>([<span class="cm-keyword">self</span> <span class="cm-variable">class</span>], <span class="cm-operator">&amp;</span><span class="cm-variable">outCount</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">17</span> &nbsp; &nbsp;  <span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">outCount</span>; <span class="cm-variable">i</span> <span class="cm-operator">++</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">18</span> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">Ivar</span> <span class="cm-variable">ivar</span> <span class="cm-operator">=</span> <span class="cm-variable">ivars</span>[<span class="cm-variable">i</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">19</span> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">NSString</span> <span class="cm-operator">*</span> <span class="cm-variable">key</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSString</span> <span class="cm-variable">stringWithUTF8String</span>:<span class="cm-variable">ivar_getName</span>(<span class="cm-variable">ivar</span>)];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">20</span> &nbsp; &nbsp; &nbsp; &nbsp;  [<span class="cm-variable">aCoder</span> <span class="cm-variable">encodeObject</span>:[<span class="cm-keyword">self</span> <span class="cm-variable">valueForKey</span>:<span class="cm-variable">key</span>] <span class="cm-variable">forKey</span>:<span class="cm-variable">key</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">21</span> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">22</span>  }</span></pre></div></div></div></div></div></div></div></pre><h3><a name='header-c88' class='md-header-anchor '></a>访问私有变量</h3><blockquote><p>我们知道，OC中没有真正意义上的私有变量和方法，要让成员变量私有，要放在m文件中声明，不对外暴露。如果我们知道这个成员变量的名称，可以通过runtime获取成员变量，再通过getIvar来获取它的值。</p></blockquote><p><em>方法：</em></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-number">1.</span><span class="cm-variable">Ivar</span> <span class="cm-variable">ivar</span> <span class="cm-operator">=</span> <span class="cm-variable">class_getInstanceVariable</span>([<span class="cm-variable">Model</span> <span class="cm-variable">class</span>], <span class="cm-string">"_str1"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-number">2.</span><span class="cm-variable">NSString</span> <span class="cm-operator">*</span> <span class="cm-variable">str1</span> <span class="cm-operator">=</span> <span class="cm-variable">object_getIvar</span>(<span class="cm-variable">model</span>, <span class="cm-variable">ivar</span>);</span></pre></div></div></div></div></div></div></div></pre><h3><a name='header-c95' class='md-header-anchor '></a>给分类（Category）添加属性</h3><blockquote><p>遇到一个问题，写了一个分类，但原先类的属性不够用。添加一个属性，调用的时候崩溃了，说是找不到getter、setter方法。查了下文档发现，OC的分类允许给分类添加属性，但不会自动生成getter、setter方法。有没有解决方案呢？有，通过运行时建立关联引用。接下来以添加一个这样的属性为例：</p></blockquote><p><code>@property (nonatomic, copy) NSString *str;</code></p><blockquote><p>在匿名分类或者头文件中添加属性。区别是：匿名分类中添加的是私有属性，只在本类中可以使用，类的实例中不可以使用。头文件中添加的在类的实例中也可以使用。</p></blockquote><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//分类的头文件</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@interface</span> <span class="cm-variable">ClassName</span> (<span class="cm-variable">CategoryName</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//我要添加一个实例也可以访问的变量所以就写在这里了</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@property</span> (<span class="cm-keyword">nonatomic</span>, <span class="cm-variable">strong</span>) <span class="cm-variable">NSString</span> <span class="cm-operator">*</span><span class="cm-variable">str</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@end</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//匿名分类</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@interface</span> <span class="cm-variable">ClassName</span> ()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@end</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">3</span><span class="cm-variable">、在实现里面写要添加属性的getter、setter方法。</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@implementation</span> <span class="cm-variable">ClassName</span> (<span class="cm-variable">CategoryName</span>) </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>(<span class="cm-variable-3">void</span>)<span class="cm-variable">setStr</span>:(<span class="cm-variable">NSString</span> <span class="cm-operator">*</span>)<span class="cm-variable">str</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">objc_setAssociatedObject</span>(<span class="cm-keyword">self</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">strKey</span>, <span class="cm-variable">str</span>, <span class="cm-variable">OBJC_ASSOCIATION_COPY</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">}  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>(<span class="cm-variable">NSString</span> <span class="cm-operator">*</span>)<span class="cm-variable">str</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">objc_getAssociatedObject</span>(<span class="cm-keyword">self</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">strKey</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@end</span></span></pre></div></div></div></div></div></div></div></pre><blockquote><p>在setStr:方法中使用了一个objc_setAssociatedObject的方法，这个方法有四个参数，分别是：源对象，关联时的用来标记是哪一个属性的key（因为你可能要添加很多属性），关联的对象和一个关联策略。 </p><p>用来标记是哪一个属性的key常见有三种写法，但代码效果是一样的，如下：</p></blockquote><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//利用静态变量地址唯一不变的特性</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">1</span><span class="cm-variable">、static</span> <span class="cm-variable-3">void</span> <span class="cm-operator">*</span><span class="cm-variable">strKey</span> <span class="cm-operator">=</span> <span class="cm-operator">&amp;</span><span class="cm-variable">strKey</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">2</span><span class="cm-variable">、static</span> <span class="cm-variable">NSString</span> <span class="cm-operator">*</span><span class="cm-variable">strKey</span> <span class="cm-operator">=</span> <span class="cm-keyword">@</span><span class="cm-string">"strKey"</span>; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">3</span><span class="cm-variable">、static</span> <span class="cm-variable-3">char</span> <span class="cm-variable">strKey</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">关联策略是个枚举值，解释如下：</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">enum</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">OBJC_ASSOCIATION_ASSIGN</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-comment">//关联对象的属性是弱引用 </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>, <span class="cm-comment">//关联对象的属性是强引用并且关联对象不使用原子性</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">OBJC_ASSOCIATION_COPY_NONATOMIC</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>, <span class="cm-comment">//关联对象的属性是copy并且关联对象不使用原子性</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">OBJC_ASSOCIATION_RETAIN</span> <span class="cm-operator">=</span> <span class="cm-number">01401</span>, <span class="cm-comment">//关联对象的属性是copy并且关联对象使用原子性</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">OBJC_ASSOCIATION_COPY</span> <span class="cm-operator">=</span> <span class="cm-number">01403</span> <span class="cm-comment">//关联对象的属性是copy并且关联对象使用原子性</span></span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">4</span><span class="cm-variable">、完成后的整体代码如下：</span></span></pre><pre class=""><span style="padding-right: 0.1px;">.<span class="cm-variable">h文件</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//分类的头文件</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@interface</span> <span class="cm-variable">ClassName</span> (<span class="cm-variable">CategoryName</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@property</span> (<span class="cm-keyword">nonatomic</span>, <span class="cm-variable">strong</span>) <span class="cm-variable">NSString</span> <span class="cm-operator">*</span><span class="cm-variable">str</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@end</span></span></pre><pre class=""><span style="padding-right: 0.1px;">.<span class="cm-variable">m文件</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//实现文件</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-operator">*</span><span class="cm-variable">strKey</span> <span class="cm-operator">=</span> <span class="cm-operator">&amp;</span><span class="cm-variable">strKey</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@implementation</span> <span class="cm-variable">ClassName</span> (<span class="cm-variable">CategoryName</span>) </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>(<span class="cm-variable-3">void</span>)<span class="cm-variable">setStr</span>:(<span class="cm-variable">NSString</span> <span class="cm-operator">*</span>)<span class="cm-variable">str</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">objc_setAssociatedObject</span>(<span class="cm-keyword">self</span>, <span class="cm-operator">&amp;</span> <span class="cm-variable">strKey</span>, <span class="cm-variable">str</span>, <span class="cm-variable">OBJC_ASSOCIATION_COPY</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">}  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>(<span class="cm-variable">NSString</span> <span class="cm-operator">*</span>)<span class="cm-variable">str</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">objc_getAssociatedObject</span>(<span class="cm-keyword">self</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">strKey</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@end</span></span></pre></div></div></div></div></div></div></div></pre><h3><a name='header-c111' class='md-header-anchor '></a>Method swizzling(方法交换)</h3><blockquote><p>方法交换，顾名思义，就是将两个方法的实现交换。例如，将A方法和B方法交换，调用A方法的时候，就会执行B方法中的代码，反之亦然。</p></blockquote><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">话不多说，这是参考Mattt大神在NSHipster上的文章自己写的代码。</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">import</span> <span class="cm-string">"UIViewController+swizzling.h"</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">import</span> <span class="cm-operator">&lt;</span><span class="cm-variable">objc</span><span class="cm-operator">/</span><span class="cm-variable">runtime</span>.<span class="cm-variable">h</span><span class="cm-operator">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@implementation</span> <span class="cm-variable">UIViewController</span> (<span class="cm-variable">swizzling</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//load方法会在类第一次加载的时候被调用</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//调用的时间比较靠前，适合在这个方法里做方法交换</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">load</span>{</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">//方法交换应该被保证，在程序中只会执行一次</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">static</span> <span class="cm-variable">dispatch_once_t</span> <span class="cm-variable">onceToken</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">dispatch_once</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">onceToken</span>, <span class="cm-variable">^</span>{</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//获得viewCo\ntroller的生命周期方法的selector</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">SEL</span> <span class="cm-variable">systemSel</span> <span class="cm-operator">=</span> <span class="cm-keyword">@selector</span>(<span class="cm-variable">viewWillAppear</span>:);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//自己实现的将要被交换的方法的selector</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">SEL</span> <span class="cm-variable">swizzSel</span> <span class="cm-operator">=</span> <span class="cm-keyword">@selector</span>(<span class="cm-variable">swiz_viewWillAppear</span>:);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//两个方法的Method</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">Method</span> <span class="cm-variable">systemMethod</span> <span class="cm-operator">=</span> <span class="cm-variable">class_getInstanceMethod</span>([<span class="cm-keyword">self</span> <span class="cm-variable">class</span>], <span class="cm-variable">systemSel</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">Method</span> <span class="cm-variable">swizzMethod</span> <span class="cm-operator">=</span> <span class="cm-variable">class_getInstanceMethod</span>([<span class="cm-keyword">self</span> <span class="cm-variable">class</span>], <span class="cm-variable">swizzSel</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//首先动态添加方法，实现是被交换的方法，返回值表示添加成功还是失败</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">BOOL</span> <span class="cm-variable">isAdd</span> <span class="cm-operator">=</span> <span class="cm-variable">class_addMethod</span>(<span class="cm-keyword">self</span>, <span class="cm-variable">systemSel</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">method_getImplementation</span>(<span class="cm-variable">swizzMethod</span>), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">method_getTypeEncoding</span>(<span class="cm-variable">swizzMethod</span>));</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> (<span class="cm-variable">isAdd</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//如果成功，说明类中不存在这个方法的实现</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//将被交换方法的实现替换到这个并不存在的实现</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">class_replaceMethod</span>(<span class="cm-keyword">self</span>, <span class="cm-variable">swizzSel</span>, <span class="cm-variable">method_getImplementation</span>(<span class="cm-variable">systemMethod</span>), <span class="cm-variable">method_getTypeEncoding</span>(<span class="cm-variable">systemMethod</span>));</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }<span class="cm-keyword">else</span>{</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//否则，交换两个方法的实现</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">method_exchangeImplementations</span>(<span class="cm-variable">systemMethod</span>, <span class="cm-variable">swizzMethod</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">});</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">swiz_viewWillAppear</span>:(<span class="cm-keyword">BOOL</span>)<span class="cm-variable">animated</span>{</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">//这时候调用自己，看起来像是死循环</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">//但是其实自己的实现已经被替换了</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  [<span class="cm-keyword">self</span> <span class="cm-variable">swiz_viewWillAppear</span>:<span class="cm-variable">animated</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"swizzle"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@end</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">在一个自己定义的viewController中重写viewWillAppear</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">viewWillAppear</span>:(<span class="cm-keyword">BOOL</span>)<span class="cm-variable">animated</span>{</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  [<span class="cm-keyword">super</span> <span class="cm-variable">viewWillAppear</span>:<span class="cm-variable">animated</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"viewWillAppear"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//Run起来看看输出吧！</span></span></pre></div></div></div></div></div></div></div></pre><p><strong>我的理解:</strong></p><ul><li>Swizzling应该写在+load方法中，因为+load是在类被初始化时候就被调用的。+initialize是在收到消息之后才调用，如果应用不发送消息给它，它就永远不可能执行。</li></ul><ul><li>Swizzling应该被写在dispatch_once中，保证只被执行一次和线程安全。</li><li>如果类中已经有了可替换的方法，那么就调用method_exchangeImplementations交换，否则调用class_addMethod和class_replaceMethod来完成替换。</li><li>xxx_viewWillAppear:方法的看似会引发死循环，但其实不会。在Swizzling的过程中xxx_viewWillAppear:已经被重新指定到UIViewController类的-viewWillAppear:中。不过如果我们调用的是viewWillAppear:反而会产生无限循环，因为这个方法的实现在运行时已经被重新指定为xxx_viewWillAppear:了。</li><li>方法交换对于我来说更像是实现一种思想的最佳技术：AOP面向切面编程。</li><li>既然是切面，就一定不要忘记，交换完再调回自己。</li><li>一定要保证只交换一次，否则就会很乱。</li><li>最后，据说这个技术很危险，谨慎使用。</li><li>防止数组越界 使用交换方法 越界时动态使用方法 但是谨慎使用</li></ul><h3><a name='header-c147' class='md-header-anchor '></a>KVO的底层实现</h3><blockquote><p>KVO是基于runtime机制实现的／small－talk</p></blockquote><ol><li>当某个类的属性对象第一次被观察时，系统就会在运行期间动态地创建该类的一个派生类，在这个派生类中重写基类的任何被观察属性的setter方法。派生类在被重写的setter方法内实现真正的通知机制</li><li>如果原类为Person，那么生成的派生类名为NSKVONotifying_Person</li><li>我们知道，每一个类中都有一个isa指针指向当前类，所有系统就是在当一个类的对象第一次被观察的时候，系统就会偷偷将isa指针指向动态生成的派生类，从而在被监听属性赋值时被执行的是派生类的setter方法</li><li>键值观察通知依赖于NSObject 的两个方法: willChangeValueForKey: 和 didChangevlueForKey:；在一个被观察属性发生改变之前， willChangeValueForKey: 一定会被调用，这就 会记录旧的值。而当改变发生后，didChangeValueForKey: 会被调用，继而 observeValueForKey:ofObject:change:context: 也会被调用。</li><li>补充：KVO的这套实现机制中苹果还偷偷重写了class方法，让我们误认为还是使用的当前类，从而达到隐藏生成的派生类</li></ol><hr /><h1><a name='header-c168' class='md-header-anchor '></a>Runloop(运行循环)</h1><h2><a name='header-c169' class='md-header-anchor '></a>基本解释</h2><h3><a name='header-c170' class='md-header-anchor '></a>作用(作用重大)</h3><ol><li>保持程序的持续运行--内部就是do-while循环，在这个循环内部不断地处理各种任务
  （比如Source、Timer、Observer）</li><li>处理app中的各种事件（比如触摸事件、定时器事件【NSTimer】、selector事件
  【选择器·performSelector···】）</li><li>节省CPU资源，提高程序性能，有事情就做事情，没事情就休息</li></ol><h3><a name='header-c183' class='md-header-anchor '></a>重要说明</h3><blockquote><p>Runloop是程序一直存在并不断处理事件的原因</p><p>main函数中的Runloop</p><p>a. 在UIApplication函数内部就启动了一个Runloop 该函数返回一个int类型的值</p><p>b. 默认启动的Runloop是跟主线程相关联的</p></blockquote><h3><a name='header-c193' class='md-header-anchor '></a>Runloop对象</h3><blockquote><p>在iOS开发中有两套api来访问Runloop</p><p>a. foundation框架【NSRunloop】</p><p>b. core foundation框架【CFRunloopRef】</p><p>c. NSRunLoop和CFRunLoopRef都代表着RunLoop对象,它们是等价的，可以互相转换</p><p>d. NSRunLoop是基于CFRunLoopRef的一层OC包装，所以要了解RunLoop内部结构，需要多研究</p><p>CFRunLoopRef层面的API（Core Foundation层面）</p></blockquote><h3><a name='header-c207' class='md-header-anchor '></a>Runloop与线程</h3><ol><li>Runloop和线程的关系：一个Runloop对应着一条唯一的线程，一条线程最多有一个Runloop；开启一个Runloop能让子线程不死</li><li>Runloop的创建：主线程Runloop已经创建好了，子线程的runloop需要手动创建并开启</li><li>Runloop的生命周期：在第一次获取时创建，在线程结束时销毁</li></ol><h3><a name='header-c218' class='md-header-anchor '></a>获得Runloop对象</h3><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">1.</span><span class="cm-variable">获得当前Runloop对象</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//01 NSRunloop</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-variable">NSRunLoop</span> <span class="cm-operator">*</span> <span class="cm-variable">runloop1</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSRunLoop</span> <span class="cm-variable">currentRunLoop</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//02 CFRunLoopRef</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CFRunLoopRef</span> <span class="cm-variable">runloop2</span> <span class="cm-operator">=</span> &nbsp; <span class="cm-variable">CFRunLoopGetCurrent</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-number">2.</span><span class="cm-variable">拿到当前应用程序的主Runloop（主线程对应的Runloop）</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//01 NSRunloop</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-variable">NSRunLoop</span> <span class="cm-operator">*</span> <span class="cm-variable">runloop1</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSRunLoop</span> <span class="cm-variable">mainRunLoop</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//02 CFRunLoopRef</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-variable">CFRunLoopRef</span> <span class="cm-variable">runloop2</span> <span class="cm-operator">=</span> &nbsp; <span class="cm-variable">CFRunLoopGetMain</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*3.注意点：开一个子线程创建runloop,不是通过alloc init方法创建，而是直接通过调用</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">currentRunLoop方法来创建，它本身是一个懒加载的。如果不存在那么会自动创建一个该线程</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">对应的runloop对象返回</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">4.在子线程中，如果不主动获取Runloop的话，那么子线程内部是不会创建Runloop的。可以下载</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">CFRunloopRef的源码，搜索_CFRunloopGet0,查看代码。</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">5.Runloop对象是利用字典来进行存储，而且key是对应的线程Value为该线程对应的Runloop。</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">*/</span></span></pre></div></div></div></div></div></div></div></pre><h2><a name='header-c220' class='md-header-anchor '></a>基本应用</h2><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">1）开启NSTimer，控制定时器在特定模式下执行</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">2）可以让某些事件（行为、任务）在特定模式下执行，如ImageView显示：控制方法在特定的模式下可用</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">3）PerformSelector：控制线程执行不同的任务</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">4）常驻线程：让一个子线程不进入消亡状态，等待其他线程发来消息，处理其他事件</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">5）可以添加Observer监听RunLoop的状态，比如监听点击事件的处理（在所有点击事件之前做一些事情</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">6）自动释放池（可通过Observer监听RunLoop的状态）</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">第一次创建：进入runloop的时候</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">最后一次释放：runloop退出的时候</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">其它创建和释放：当runloop即将休眠的时候会把之前的自动释放池释放，然后重新创建一个新的释放池</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">常驻线程实现:</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">主线程对应的runloop默认已经创建好了,但是子线程对应的runloop需要手动创建</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">子线程对应的runloop还需要手动的开启，否则该runloop一创建出来就退出；在开启前要先添加事件，否则也会退出。</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">保证mode里面有事件,不让runloop立刻退出</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">可以往runloop中添加source和timer,但是添加observer是没有作用的</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">NSTimer *timer = [NSTimer timerWithTimeInterval:2.0 target:self selector:@selector(timer) userInfo:nil repeats:YES];</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">[[NSRunLoop currentRunLoop] addTimer:timer forMode:NSDefaultRunLoopMode];</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//创建子线程对应的runloop并添加基于port的source</span></span></pre><pre class=""><span style="padding-right: 0.1px;">[[<span class="cm-variable">NSRunLoop</span> <span class="cm-variable">currentRunLoop</span>]<span class="cm-variable">addPort</span>:[<span class="cm-variable">NSMachPort</span> <span class="cm-variable">port</span>] <span class="cm-variable">forMode</span>:<span class="cm-variable">NSDefaultRunLoopMode</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//开启runloop,运行在默认模式下面（添加timer或是port都要开始runloop）</span></span></pre><pre class=""><span style="padding-right: 0.1px;">[[<span class="cm-variable">NSRunLoop</span> <span class="cm-variable">currentRunLoop</span>]<span class="cm-variable">run</span>];</span></pre></div></div></div></div></div></div></div></pre><blockquote><p>请简单说明runloop中几个类之间的相互关系（runloop &amp; source &amp; timer &amp;observer &amp;mode）</p></blockquote><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">a</span>.<span class="cm-variable">CFRunloopRef</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">b</span>.<span class="cm-variable">CFRunloopModeRef【Runloop的运行模式】</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">c</span>.<span class="cm-variable">CFRunloopSourceRef【Runloop要处理的事件源】</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">d</span>.<span class="cm-variable">CFRunloopTimerRef【Timer事件】</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">e</span>.<span class="cm-variable">CFRunloopObserverRef【Runloop的观察者</span>(<span class="cm-variable">监听者</span>)<span class="cm-variable">】</span></span></pre></div></div></div></div></div></div></div></pre><ol><li><p>runloop启动之后会选择一种运行模式，在执行执行会先检查运行模式内部是否有source和timers,如果一个sourc或者是一个timer都没有那么runlooop启动之后就立刻退出了。</p></li><li><p>runlooop的source有两种分类方法 </p><ul><li>按照以前的分类方法可以分为: 基于端口的  自定义的  performSelector事件 </li><li>按照函数调用栈来划分:  source0  soucrce1</li></ul></li><li><p>observer，可以用来监听当前runloop运行状态的改变，注意（Core foundation框架）</p></li><li><p>NSTimer必须添加到runloop中才会工作，且其工作收到runloop运行模式的影响。defultMode   UItrackingMode</p></li></ol><blockquote><p>什么时候使用run loop</p></blockquote><ul><li>仅当在为你的程序创建辅助线程的时候，你才需要显式运行一个run loop。Run loop是程序主线程基础设施的关键部分。所以，Cocoa和Carbon程序提供了代码运行主程序的循环并自动启动run loop。IOS程序中UIApplication的run方法（或Mac OS X中的NSApplication）作为程序启动步骤的一部分，它在程序正常启动的时候就会启动程序的主循环。类似的，RunApplicationEventLoop函数为Carbon程序启动主循环。如果你使用xcode提供的模板创建你的程序，那你永远不需要自己去显式的调用这些例程。</li></ul><ul><li><p>对于辅助线程，你需要判断一个run loop是否是必须的。如果是必须的，那么你要自己配置并启动它。你不需要在任何情况下都去启动一个线程的run loop。比如，你使用线程来处理一个预先定义的长时间运行的任务时，你应该避免启动run loop。Run loop在你要和线程有更多的交互时才需要，比如以下情况：</p><p>使用端口或自定义输入源来和其他线程通信</p><p>使用线程的定时器</p><p>Cocoa中使用任何performSelector…的方法</p><p>使线程周期性工作</p></li></ul><hr /><h1><a name='header-c266' class='md-header-anchor '></a>位移枚举</h1><h2><a name='header-c267' class='md-header-anchor '></a>基本理解</h2><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">typedef</span> <span class="cm-variable">NS_OPTIONS</span>(<span class="cm-variable">NSUInteger</span>, <span class="cm-variable">kActionType</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">kActionTypeTop</span> &nbsp;  <span class="cm-operator">=</span> &nbsp;  <span class="cm-number">1</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-number">0</span>, <span class="cm-comment">// 1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">kActionTypeBottom</span> <span class="cm-operator">=</span> &nbsp;  <span class="cm-number">1</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-number">1</span>, <span class="cm-comment">// 2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">kActionTypeLeft</span> &nbsp; <span class="cm-operator">=</span> &nbsp;  <span class="cm-number">1</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-number">2</span>, <span class="cm-comment">// 4</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">kActionTypeRight</span>  <span class="cm-operator">=</span> &nbsp;  <span class="cm-number">1</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-number">3</span>, <span class="cm-comment">// 8</span></span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@interface</span> <span class="cm-variable">ViewController</span> ()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@end</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@implementation</span> <span class="cm-variable">ViewController</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>(<span class="cm-variable-3">void</span>)<span class="cm-variable">touchesBegan</span>:(<span class="cm-variable">NSSet</span><span class="cm-operator">&lt;</span><span class="cm-variable">UITouch</span> <span class="cm-operator">*&gt;</span> <span class="cm-operator">*</span>)<span class="cm-variable">touches</span> <span class="cm-variable">withEvent</span>:(<span class="cm-variable">UIEvent</span> <span class="cm-operator">*</span>)<span class="cm-variable">event</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">[<span class="cm-keyword">self</span> <span class="cm-variable">demo</span>:<span class="cm-variable">kActionTypeBottom</span> <span class="cm-operator">|</span> <span class="cm-variable">kActionTypeRight</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"++++++++++"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">[<span class="cm-keyword">self</span> <span class="cm-variable">demo</span>:<span class="cm-variable">kActionTypeTop</span> <span class="cm-operator">|</span> <span class="cm-variable">kActionTypeLeft</span> <span class="cm-operator">|</span> <span class="cm-variable">kActionTypeRight</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// 位移枚举在传入参数时,是使用 或运算 的方式,</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// 比如传进来的值是 10,也就是 1010 ;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//1010;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//0010;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">让 10 与上 2 得 2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">让 10 与上 8 得 8</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">所以只要二进制位上有值, 就能获得对应的值</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//传多个参数 3个</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//| (或运算符) &nbsp; 0|1 = 1 0|0 = 0 1|1 = 1  只要有1那么结果就是1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//&amp; (与运算符) &nbsp; 0&amp;1 = 0 0&amp;0 = 0 1&amp;1 = 1  只要有0那么结果就是0</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>(<span class="cm-variable-3">void</span>)<span class="cm-variable">demo</span>:(<span class="cm-variable">kActionType</span>)<span class="cm-variable">type</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"%zd"</span>,<span class="cm-variable">type</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">type</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">kActionTypeTop</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"向上---%zd"</span>,<span class="cm-variable">type</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">kActionTypeTop</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// &nbsp;  1010;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// &nbsp;  0010;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">type</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">kActionTypeBottom</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"向下---%zd"</span>,<span class="cm-variable">type</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">kActionTypeBottom</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">type</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">kActionTypeRight</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"向右---%zd"</span>,<span class="cm-variable">type</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">kActionTypeRight</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">type</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">kActionTypeLeft</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"向左---%zd"</span>,<span class="cm-variable">type</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">kActionTypeLeft</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">控制台输出:</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">10</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">向下---2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">向右---8</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">++++++++++</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">13</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">向上---1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">向右---8</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">向左---4</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@end</span></span></pre></div></div></div></div></div></div></div></pre><hr /><h1><a name='header-c270' class='md-header-anchor '></a>MRC／ARC(内存管理)</h1><h2><a name='header-c271' class='md-header-anchor '></a>简述基本原则</h2><ul><li>之前：OC内存管理遵循“谁创建，谁释放，谁引用，谁管理”的机制，当创建或引用一个对象的时候，需要向她发送alloc、copy、retain消息，当释放该对象时需要发送release消息，当对象引用计数为0时，系统将释放该对象，这是OC的手动管理机制（MRC）。</li><li>目前：iOS 5.0之后引用自动管理机制——自动引用计数（ARC），管理机制与手动机制一样，只是不再需要调用retain、release、autorelease；它编译时的特性，当你使用ARC时，在适当位置插入release和autorelease；它引用strong和weak关键字，strong修饰的指针变量指向对象时，当指针指向新值或者指针不复存在，相关联的对象就会自动释放，而weak修饰的指针变量指向对象，当对象的拥有者指向新值或者不存在时weak修饰的指针会自动置为nil。</li><li>如果使用alloc、copy(mutableCopy)或者retian一个对象时,你就有义务,向它发送一条release或者autorelease消息。其他方法创建的对象,不需要由你来管理内存。</li><li>向一个对象发送一条autorelease消息,这个对象并不会立即销毁, 而是将这个对象放入了自动释放池,待池子释放时,它会向池中每一个对象发送 一条release消息,以此来释放对象.</li><li>向一个对象发送release消息,并不意味着这个对象被销毁了,而是当这个对象的引用计数为0时,系统才会调用dealloc方法,释放该对象和对象本身它所拥有的实例。</li></ul><h2><a name='header-c288' class='md-header-anchor '></a>其他注意事项</h2><ul><li>如果一个对象有一个_strong类型的指针指向着，找个对象就不会被释放。如果一个指针指向超出了它的作用域，就会被指向nil。如果一个指针被指向nil，那么它原来指向的对象就被释放了。当一个视图控制器被释放时，它内部的全局指针会被指向nil。用法“：不管全局变量还是局部变量用strong描述就行。</li><li>局部变量：出了作用域，指针会被置为nil。</li><li>方法内部创建对象，外部使用需要添加<em>autorelease;</em></li><li><em>连线的时候，用</em>weak描述。</li><li>代理使用unsafe_unretained就相当于assign；</li><li>block中为了避免循环引用问题，使用_weak描述；</li><li>声明属性时，不要以new开头。如果非要以new开头命名属性的名字，需要自己定制get方法名，如</li></ul><p><code>@property(getter=theString) NSString * newString;</code></p><ul><li>如果要使用自动释放池，用@autoreleasepool{}</li></ul><ul><li>ARC只能管理Foundation框架的变量，如果程序中把Foundation中的变量强制换成Core Foundation中的变量需要交换管理权；</li></ul><ul><li>在非ARC工程中采用ARC去编译某些类：-fobjc-arc。在ARC下的工程采用非ARC去编译某些类：-fno-fobjc-arc。</li></ul><hr /><h1><a name='header-c326' class='md-header-anchor '></a>MVC/MVVM</h1><h2><a name='header-c327' class='md-header-anchor '></a>如何理解MVC设计模式</h2><blockquote><p>MVC是一种架构模式，M表示MOdel，V表示视图View，C表示控制器Controller</p></blockquote><ul><li>Model负责存储、定义、操作数据；</li></ul><ul><li>View用来展示书给用户，和用户进行操作交互；</li></ul><ul><li>Controller是Model和View的协调者，</li></ul><blockquote><p>Controller把Model中的数据拿过来给View用。Controller可以直接与Model和View进行通信，而View不能和Controller直接通信。View与Controller通信需要利用代理协议的方式，当有数据更新时，MOdel也要与Controller进行通信，这个时候就要用Notification和KVO，这个方式就像一个广播一样，MOdel发信号，Controller设置监听接受信号，当有数据更新时就发信号给Controller，Model和View不能直接进行通信，这样会违背MVC设计模式。</p></blockquote><h2><a name='header-c346' class='md-header-anchor '></a>如何理解MVVM设计模式</h2><ul><li><mark>ViewModel</mark>层，就是View和Model层的粘合剂，他是一个放置用户输入验证逻辑，视图显示逻辑，发起网络请求和其他各种各样的代码的极好的地方。说白了，就是把原来ViewController层的业务逻辑和页面逻辑等剥离出来放到ViewModel层。</li></ul><ul><li><mark>View</mark>层，就是ViewController层，他的任务就是从ViewModel层获取数据，然后显示。</li></ul><hr /><h1><a name='header-c356' class='md-header-anchor '></a>iOS常见加密方法</h1><blockquote><p><a href='https://github.com/PengfeiWang666/Security'>本文中所有代码演示均有GitHub源码，点击下载</a></p></blockquote><ul><li>普通加密方法是讲密码进行加密后保存到用户偏好设置中</li><li>钥匙串是以明文形式保存，但是不知道存放的具体位置</li></ul><h2><a name='header-c367' class='md-header-anchor '></a>base64加密</h2><ul><li><p>base64 编码是现代密码学的基础</p></li><li><p>基本原理：</p><ul><li>原本是 8个bit 一组表示数据,改为 6个bit一组表示数据,不足的部分补零,每 两个0 用 一个 = 表示</li><li>用base64 编码之后,数据长度会变大,增加了大约 1/3 左右.(8-6)/6</li></ul></li><li><p>可进行反向解密</p></li><li><p>Xcode7.0 之后出现的</p></li><li><p>编码有个非常显著的特点,末尾有个 <code>=</code> 号</p></li></ul><h3><a name='header-c391' class='md-header-anchor '></a>将文件进行加密</h3><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 获取需要加密文件的二进制数据</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSData</span> <span class="cm-operator">*</span><span class="cm-variable">data</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSData</span> <span class="cm-variable">dataWithContentsOfFile</span>:<span class="cm-keyword">@</span><span class="cm-string">"/Users/wangpengfei/Desktop/photo/IMG_5551.jpg"</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 或 base64EncodedStringWithOptions</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSData</span> <span class="cm-operator">*</span><span class="cm-variable">base64Data</span> <span class="cm-operator">=</span> [<span class="cm-variable">data</span> <span class="cm-variable">base64EncodedDataWithOptions</span>:<span class="cm-number">0</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 将加密后的文件存储到桌面</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  [<span class="cm-variable">base64Data</span> <span class="cm-variable">writeToFile</span>:<span class="cm-keyword">@</span><span class="cm-string">"/Users/wangpengfei/Desktop/123"</span> <span class="cm-variable">atomically</span>:<span class="cm-atom">YES</span>];</span></pre></div></div></div></div></div></div></div></pre><h3><a name='header-c393' class='md-header-anchor '></a>将文件进行解密</h3><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 获得加密后的二进制数据</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSData</span> <span class="cm-operator">*</span><span class="cm-variable">base64Data</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSData</span> <span class="cm-variable">dataWithContentsOfFile</span>:<span class="cm-keyword">@</span><span class="cm-string">"/Users/wangpengfei/Desktop/123"</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 解密 base64 数据</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSData</span> <span class="cm-operator">*</span><span class="cm-variable">baseData</span> <span class="cm-operator">=</span> [[<span class="cm-variable">NSData</span> <span class="cm-variable">alloc</span>] <span class="cm-variable">initWithBase64EncodedData</span>:<span class="cm-variable">base64Data</span> <span class="cm-variable">options</span>:<span class="cm-number">0</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 写入桌面</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  [<span class="cm-variable">baseData</span> <span class="cm-variable">writeToFile</span>:<span class="cm-keyword">@</span><span class="cm-string">"/Users/wangpengfei/Desktop/IMG_5551.jpg"</span> <span class="cm-variable">atomically</span>:<span class="cm-atom">YES</span>];</span></pre></div></div></div></div></div></div></div></pre><h3><a name='header-c395' class='md-header-anchor '></a>利用终端命令进行base64运算:</h3><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 将文件 meinv.jpg 进行 base64运算之后存储为 meinv.txt</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">base64</span> <span class="cm-variable">meinv</span>.<span class="cm-variable">jpg</span> <span class="cm-operator">-</span><span class="cm-variable">o</span> <span class="cm-variable">meinv</span>.<span class="cm-variable">txt</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 讲meinv.txt 解码生成 meinv.png</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">base64</span> <span class="cm-operator">-</span><span class="cm-variable">D</span> <span class="cm-variable">meinv</span>.<span class="cm-variable">txt</span> <span class="cm-operator">-</span><span class="cm-variable">o</span> <span class="cm-variable">meinv</span>.<span class="cm-variable">png</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 将字符串 "hello" 进行 base 64 编码 结果:aGVsbG8=cho "hello" | base64</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 将 base64编码之后的结果 aGVsbG8= 反编码为字符串</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">echo</span> <span class="cm-variable">aGVsbG8</span><span class="cm-operator">=</span> <span class="cm-operator">|</span> <span class="cm-variable">base64</span> <span class="cm-operator">-</span><span class="cm-variable">D</span></span></pre></div></div></div></div></div></div></div></pre><h2><a name='header-c397' class='md-header-anchor '></a>POST加密</h2><h3><a name='header-c398' class='md-header-anchor '></a>A. 搭建UI框架</h3><ul><li><p>Login.storyboard</p><ul><li>两个UItextFiled : 分别输入用户名和密码</li><li>UIButton : 登录按钮</li></ul></li><li><p>Main.storyboard</p><ul><li>直接拖一个navigationController-&gt;tableViewController</li><li>navigationItem + 注销按钮</li></ul></li></ul><h3><a name='header-c420' class='md-header-anchor '></a>B. 实现基本加密</h3><ul><li><p>抽取出读取数据的方法</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">-</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">readLocalUserInfo</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// 1. 实例化偏好设置对象</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">NSUserDefaults</span> <span class="cm-operator">*</span><span class="cm-variable">userDefaults</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSUserDefaults</span> <span class="cm-variable">standardUserDefaults</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// 2. 取出数据进行赋值</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">self</span>.<span class="cm-variable">userName</span>.<span class="cm-variable">text</span> <span class="cm-operator">=</span> [<span class="cm-variable">userDefaults</span> <span class="cm-variable">objectForKey</span>:<span class="cm-variable">kUserNameKey</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// 此时读取的是加密后的密码</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">self</span>.<span class="cm-variable">password</span>.<span class="cm-variable">text</span> <span class="cm-operator">=</span> [<span class="cm-variable">userDefaults</span> <span class="cm-variable">objectForKey</span>:<span class="cm-variable">kPasswordKey</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre></li><li><p>抽取出存储数据的方法</p><p>​</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">&nbsp; <span class="cm-operator">-</span>&nbsp;(<span class="cm-variable-3">void</span>)<span class="cm-variable">saveLocalUserInfo</span>&nbsp;{</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;1.&nbsp;实例化偏好设置对象</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; <span class="cm-variable">NSUserDefaults</span>&nbsp;<span class="cm-operator">*</span><span class="cm-variable">userDefaults</span>&nbsp;<span class="cm-operator">=</span>&nbsp;[<span class="cm-variable">NSUserDefaults</span>&nbsp;<span class="cm-variable">standardUserDefaults</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;2.&nbsp;存储用户名</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; [<span class="cm-variable">userDefaults</span>&nbsp;<span class="cm-variable">setObject</span>:<span class="cm-keyword">self</span>.<span class="cm-variable">userName</span>.<span class="cm-variable">text</span>&nbsp;<span class="cm-variable">forKey</span>:<span class="cm-variable">kUserNameKey</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;3.&nbsp;将密码进行base64&nbsp;加密</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;将密码转化为二进制数据</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; <span class="cm-variable">NSData</span>&nbsp;<span class="cm-operator">*</span><span class="cm-variable">data</span>&nbsp;<span class="cm-operator">=</span>&nbsp;[<span class="cm-keyword">self</span>.<span class="cm-variable">password</span>.<span class="cm-variable">text</span>&nbsp;<span class="cm-variable">dataUsingEncoding</span>:<span class="cm-variable">NSUTF8StringEncoding</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;进行加密</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; <span class="cm-variable">NSString</span>&nbsp;<span class="cm-operator">*</span><span class="cm-variable">base64Str</span>&nbsp;<span class="cm-operator">=</span>&nbsp;[<span class="cm-variable">data</span>&nbsp;<span class="cm-variable">base64EncodedStringWithOptions</span>:<span class="cm-number">0</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;4.&nbsp;将加密后的密码存储到偏好设置</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; [<span class="cm-variable">userDefaults</span>&nbsp;<span class="cm-variable">setObject</span>:<span class="cm-variable">base64Str</span>&nbsp;<span class="cm-variable">forKey</span>:<span class="cm-variable">kPasswordKey</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;5.&nbsp;为了保证线程的一致性，无论是存储还是读取数据，都要进行同步</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; [<span class="cm-variable">userDefaults</span>&nbsp;<span class="cm-variable">synchronize</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p>​</p></li><li><p>在点击事件中进行登录操作</p><p>​</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">&nbsp; <span class="cm-operator">-</span>&nbsp;(<span class="cm-variable">IBAction</span>)<span class="cm-variable">btnLoginDidClick</span>:(<span class="cm-variable">UIButton</span>&nbsp;<span class="cm-operator">*</span>)<span class="cm-variable">sender</span>&nbsp;{</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;如果两个文本框均不为空，则进行登录操作</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; <span class="cm-keyword">if</span>&nbsp;(<span class="cm-keyword">self</span>.<span class="cm-variable">userName</span>.<span class="cm-variable">text</span>.<span class="cm-variable">length</span>&nbsp;<span class="cm-operator">&amp;&amp;</span>&nbsp;<span class="cm-keyword">self</span>.<span class="cm-variable">password</span>.<span class="cm-variable">text</span>.<span class="cm-variable">length</span>)&nbsp;{</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;1.&nbsp;创建请求</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSString</span>&nbsp;<span class="cm-operator">*</span><span class="cm-variable">urlString</span>&nbsp;<span class="cm-operator">=</span>&nbsp;<span class="cm-keyword">@</span><span class="cm-string">"http://localhost/login/login.php"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSURL</span>&nbsp;<span class="cm-operator">*</span><span class="cm-variable">url</span>&nbsp;<span class="cm-operator">=</span>&nbsp;[<span class="cm-variable">NSURL</span>&nbsp;<span class="cm-variable">URLWithString</span>:<span class="cm-variable">urlString</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;POST&nbsp;请求需要手动设置请求方法，因此为可变请求</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSMutableURLRequest</span>&nbsp;<span class="cm-operator">*</span><span class="cm-variable">request</span>&nbsp;<span class="cm-operator">=</span>&nbsp;[<span class="cm-variable">NSMutableURLRequest</span>&nbsp;<span class="cm-variable">requestWithURL</span>:<span class="cm-variable">url</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;设置请求方法</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">request</span>.<span class="cm-variable">HTTPMethod</span>&nbsp;<span class="cm-operator">=</span>&nbsp;<span class="cm-keyword">@</span><span class="cm-string">"POST"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;设置请求参数</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSString</span>&nbsp;<span class="cm-operator">*</span><span class="cm-variable">body</span>&nbsp;<span class="cm-operator">=</span>&nbsp;[<span class="cm-variable">NSString</span>&nbsp;<span class="cm-variable">stringWithFormat</span>:<span class="cm-keyword">@</span><span class="cm-string">"username=%@&amp;password=%@"</span>,&nbsp;<span class="cm-keyword">self</span>.<span class="cm-variable">userName</span>.<span class="cm-variable">text</span>,&nbsp;<span class="cm-keyword">self</span>.<span class="cm-variable">password</span>.<span class="cm-variable">text</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;将字符串转为二进制数据</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSData</span>&nbsp;<span class="cm-operator">*</span><span class="cm-variable">bodyData</span>&nbsp;<span class="cm-operator">=</span>&nbsp;[<span class="cm-variable">body</span>&nbsp;<span class="cm-variable">dataUsingEncoding</span>:<span class="cm-variable">NSUTF8StringEncoding</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;设置请求主体(二进制数据)</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">request</span>.<span class="cm-variable">HTTPBody</span>&nbsp;<span class="cm-operator">=</span>&nbsp;<span class="cm-variable">bodyData</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;2.&nbsp;发送请求</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [[[<span class="cm-variable">NSURLSession</span>&nbsp;<span class="cm-variable">sharedSession</span>]&nbsp;<span class="cm-variable">dataTaskWithRequest</span>:<span class="cm-variable">request</span>&nbsp;<span class="cm-variable">completionHandler</span>:<span class="cm-variable">^</span>(<span class="cm-variable">NSData</span>&nbsp;<span class="cm-operator">*</span>&nbsp;<span class="cm-variable">_Nullable</span>&nbsp;<span class="cm-variable">data</span>,&nbsp;<span class="cm-variable">NSURLResponse</span>&nbsp;<span class="cm-operator">*</span>&nbsp;<span class="cm-variable">_Nullable</span>&nbsp;<span class="cm-variable">response</span>,&nbsp;<span class="cm-variable">NSError</span>&nbsp;<span class="cm-operator">*</span>&nbsp;<span class="cm-variable">_Nullable</span>&nbsp;<span class="cm-variable">error</span>)&nbsp;{</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;打印请求结果</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"data:%@"</span>,&nbsp;[[<span class="cm-variable">NSString</span>&nbsp;<span class="cm-variable">alloc</span>]&nbsp;<span class="cm-variable">initWithData</span>:<span class="cm-variable">data</span>&nbsp;<span class="cm-variable">encoding</span>:<span class="cm-variable">NSUTF8StringEncoding</span>]);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//&nbsp;判断是否登录成功</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">if</span>&nbsp;(<span class="cm-variable">data</span>&nbsp;<span class="cm-operator">&amp;&amp;</span>&nbsp;<span class="cm-operator">!</span><span class="cm-variable">error</span>)&nbsp;{</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"网络请求成功!"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSDictionary</span>&nbsp;<span class="cm-operator">*</span><span class="cm-variable">dict</span>&nbsp;<span class="cm-operator">=</span>&nbsp;[<span class="cm-variable">NSJSONSerialization</span>&nbsp;<span class="cm-variable">JSONObjectWithData</span>:<span class="cm-variable">data</span>&nbsp;<span class="cm-variable">options</span>:<span class="cm-number">0</span>&nbsp;<span class="cm-variable">error</span>:<span class="cm-keyword">nil</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">if</span>&nbsp;(<span class="cm-variable">dict</span>[<span class="cm-keyword">@</span><span class="cm-string">"userID"</span>])&nbsp;{</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [<span class="cm-keyword">self</span>&nbsp;<span class="cm-variable">saveLocalUserInfo</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//跳转到app主界面，在主线程中发送通知</span></span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">dispatch_async</span>(<span class="cm-variable">dispatch_get_main_queue</span>(),&nbsp;<span class="cm-variable">^</span>{</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [[<span class="cm-variable">NSNotificationCenter</span>&nbsp;<span class="cm-variable">defaultCenter</span>]&nbsp;<span class="cm-variable">postNotificationName</span>:<span class="cm-keyword">@</span><span class="cm-string">"loginSuccess"</span>&nbsp;<span class="cm-variable">object</span>:<span class="cm-keyword">nil</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp;<span class="cm-keyword">else</span>&nbsp;{</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"网络请求失败!"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }]&nbsp;<span class="cm-variable">resume</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; }&nbsp;<span class="cm-keyword">else</span>&nbsp;{</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"用户名或密码不能为空!"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;">&nbsp; }</span></pre></div></div></div></div></div></div></div></pre></li></ul><h3><a name='header-c440' class='md-header-anchor '></a>C. 实现页面间跳转</h3><ul><li><p>在<code>AppDelegate.m</code>文件中<code>利用通知</code>设置页面的跳转</p><ul><li><p>切换的主方法</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-keyword">BOOL</span>)<span class="cm-variable">application</span>:(<span class="cm-variable">UIApplication</span> <span class="cm-operator">*</span>)<span class="cm-variable">application</span> <span class="cm-variable">didFinishLaunchingWithOptions</span>:(<span class="cm-variable">NSDictionary</span> <span class="cm-operator">*</span>)<span class="cm-variable">launchOptions</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 1. 注册登录成功的通知观察者</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  [[<span class="cm-variable">NSNotificationCenter</span> <span class="cm-variable">defaultCenter</span>] <span class="cm-variable">addObserver</span>:<span class="cm-keyword">self</span> <span class="cm-variable">selector</span>:<span class="cm-keyword">@selector</span>(<span class="cm-variable">loginSuccess</span>) <span class="cm-variable">name</span>:<span class="cm-keyword">@</span><span class="cm-string">"loginSuccess"</span> <span class="cm-variable">object</span>:<span class="cm-keyword">nil</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 2. 注册登录成功的通知观察者</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  [[<span class="cm-variable">NSNotificationCenter</span> <span class="cm-variable">defaultCenter</span>] <span class="cm-variable">addObserver</span>:<span class="cm-keyword">self</span> <span class="cm-variable">selector</span>:<span class="cm-keyword">@selector</span>(<span class="cm-variable">logoutSuccess</span>) <span class="cm-variable">name</span>:<span class="cm-keyword">@</span><span class="cm-string">"logoutSuccess"</span> <span class="cm-variable">object</span>:<span class="cm-keyword">nil</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 每次app打开后，应该展示给用户哪个界面</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 3. 利用偏好设置中用户保存的信息来判断用户的登录状态</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSString</span> <span class="cm-operator">*</span><span class="cm-variable">userName</span> <span class="cm-operator">=</span> [[<span class="cm-variable">NSUserDefaults</span> <span class="cm-variable">standardUserDefaults</span>] <span class="cm-variable">objectForKey</span>:<span class="cm-variable">kUserNameKey</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSString</span> <span class="cm-operator">*</span><span class="cm-variable">password</span> <span class="cm-operator">=</span> [[<span class="cm-variable">NSUserDefaults</span> <span class="cm-variable">standardUserDefaults</span>] <span class="cm-variable">objectForKey</span>:<span class="cm-variable">kPasswordKey</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> (<span class="cm-variable">userName</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">password</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// 显示app 主界面</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  [<span class="cm-keyword">self</span> <span class="cm-variable">loginSuccess</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  [<span class="cm-keyword">self</span> <span class="cm-variable">logoutSuccess</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-atom">YES</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre></li><li><p>登录成功</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">loginSuccess</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"登录成功!"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 获取主界面</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">UIStoryboard</span> <span class="cm-operator">*</span><span class="cm-variable">mainSb</span> <span class="cm-operator">=</span> [<span class="cm-variable">UIStoryboard</span> <span class="cm-variable">storyboardWithName</span>:<span class="cm-keyword">@</span><span class="cm-string">"Main"</span> <span class="cm-variable">bundle</span>:<span class="cm-keyword">nil</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 切换控制器</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">self</span>.<span class="cm-variable">window</span>.<span class="cm-variable">rootViewController</span> <span class="cm-operator">=</span> <span class="cm-variable">mainSb</span>.<span class="cm-variable">instantiateInitialViewController</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre></li><li><p>注销成功</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">logoutSuccess</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"注销成功!"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 获取登录界面</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">UIStoryboard</span> <span class="cm-operator">*</span><span class="cm-variable">loginSb</span> <span class="cm-operator">=</span> [<span class="cm-variable">UIStoryboard</span> <span class="cm-variable">storyboardWithName</span>:<span class="cm-keyword">@</span><span class="cm-string">"Login"</span> <span class="cm-variable">bundle</span>:<span class="cm-keyword">nil</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 切换控制器</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">self</span>.<span class="cm-variable">window</span>.<span class="cm-variable">rootViewController</span> <span class="cm-operator">=</span> <span class="cm-variable">loginSb</span>.<span class="cm-variable">instantiateInitialViewController</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre></li></ul></li><li><p>在<code>Main.storyboard</code>关联的控制器中设置注销按钮的点击事件</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 1. 清除本地信息</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  [[<span class="cm-variable">NSUserDefaults</span> <span class="cm-variable">standardUserDefaults</span>] <span class="cm-variable">removeObjectForKey</span>:<span class="cm-variable">kUserNameKey</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  [[<span class="cm-variable">NSUserDefaults</span> <span class="cm-variable">standardUserDefaults</span>] <span class="cm-variable">removeObjectForKey</span>:<span class="cm-variable">kPasswordKey</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 同步信息</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  [[<span class="cm-variable">NSUserDefaults</span> <span class="cm-variable">standardUserDefaults</span>] <span class="cm-variable">synchronize</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 2. 发送信息，切换控制器</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  [[<span class="cm-variable">NSNotificationCenter</span> <span class="cm-variable">defaultCenter</span>] <span class="cm-variable">postNotificationName</span>:<span class="cm-keyword">@</span><span class="cm-string">"logoutSuccess"</span> <span class="cm-variable">object</span>:<span class="cm-keyword">nil</span>];</span></pre></div></div></div></div></div></div></div></pre></li></ul><h2><a name='header-c462' class='md-header-anchor '></a>Token值介绍</h2><ul><li><p>token 值: <code>登录令牌</code>.利用 token 值来判断用户的登录状态.类似于 MD5 加密之后的长字符串.</p></li><li><p>用户登录成功之后,<code>在后端(服务器端)会根据用户信息生成一个唯一的值</code>.这个值就是 token 值.</p></li><li><p><code>基本使用</code>:</p><ul><li>在服务器端(数据库)会保存这个 token 值,以后利用这个 token 值来检索对应的用户信息,并且判断用户的登录状态.</li><li>用户登录成功之后,服务器会将生成的 token 值返回给 客户端,在客户端也会保存这个 token 值.(一般可以保存在 cookie 中,也可以自己手动确定保存位置(比如偏好设置.)).</li><li>以后客户端在发送新的网络请求的时候,会默认自动附带这个 token 值(作为一个参数传递给服务器.).服务器拿到客户端传递的 token 值跟保存在 数据库中的 token 值做对比,以此来判断用户身份和登录状态.</li></ul></li><li><p><code>判断登录状态</code>:</p><ul><li>如果客户端没有这个 token 值,意味着没有登录成功过,提示用户登录.</li><li>如果客户端有 token 值,一般会认为登录成功.不需要用户再次登录(输入账号和密码信息).</li></ul></li><li><p><code>token 值扩展</code>:</p><ul><li><p>token 值有失效时间:</p><ul><li>一般的 app ,token值得失效时间都在 1 年以上.</li><li>特殊的 app :银行类 app /支付类 app :token值失效时间 15 分钟左右.</li></ul></li><li><p>一旦用户信息改变(密码改变),会在服务器生成新的 token 值,原来的 token值就会失效.需要再次输入账号和密码,以得到生成的新的 token 值.</p></li><li><p><code>唯一性判断</code>: 每次登录,都会生成一个新的token值.原来的 token 值就会失效.利用时间来判断登录的差异性.</p></li></ul></li></ul><h2><a name='header-c513' class='md-header-anchor '></a>MD5加密--(信息-摘要算法) 哈希算法之一</h2><blockquote><p>把一个任意长度的字节串变换成一定长度的十六进制的大整数.</p><p>注意,字符串的转换过程是<code>不可逆</code>的,不能通过加密结果,反向推导出原始内容</p></blockquote><h3><a name='header-c519' class='md-header-anchor '></a>基本介绍</h3><ul><li><p>需要导入第三方框架: NSString+Hash</p></li><li><p>MD5特点:</p><ul><li>压缩性 : 任意长度的数据,算出的 MD5 值<code>长度都是固定的</code>.</li><li>容易计算 : 从原数据计算出 MD5 值很容易.</li><li><code>抗修改性</code> : 对原数据进行任何改动,哪怕只修改一个字节,所得到的 MD5 值都有很大区别.</li><li>弱抗碰撞 : 已知原数据和其 MD5 值,<code>想找到一个具有相同 MD5 值的数据(即伪造数据)是非常困难的.</code></li><li>5.强抗碰撞: 想找到两个不同数据,使他们具有相同的 MD5 值,是非常困难的</li></ul></li><li><p>MD5 应用:</p><ul><li><p><code>一致性验证</code>:MD5将整个文件当做一个大文本信息,通过不可逆的字符串变换算法,产生一个唯一的MD5信息摘要.就像每个人都有自己独一无二的指纹,MD5对任何文件产生一个独一无二的<code>数字指纹</code>.</p><p>利用 MD5 来进行文件校验,被大量应用在软件下载站,论坛数据库,系统文件安全等方面(是否认为添加木马，篡改文件内容等).百度‘MD5’第一个网站进去，利用<code>数据库伪解密</code>,即反查询</p></li><li><p>数字签名;</p></li><li><p>安全访问认证;</p></li></ul></li></ul><h3><a name='header-c558' class='md-header-anchor '></a>使用方法</h3><ul><li><p>利用 MD5 对字符串进行加密</p><pre class='md-fences mock-cm' style='display:block;position:relative'>  NSString *password = @&quot;WangPengfei&quot;;

  password = [password md5String];

  NSLog(@&quot;password1:%@&quot;, password);</pre></li></ul><pre class='md-fences mock-cm' style='display:block;position:relative'>
- 加盐:可以保证 MD5加密之后更加安全
</pre><pre class='md-fences mock-cm' style='display:block;position:relative'>NSString *salt = @&quot;234567890-!@#$%^&amp;*()_+QWERTYUIOP{ASDFGHJKL:XCVBNM&lt;&gt;&quot;;</pre><pre class='md-fences mock-cm' style='display:block;position:relative'>[password stringByAppendingString:salt];</pre><pre class='md-fences mock-cm' style='display:block;position:relative'>password = [password md5String];</pre><pre class='md-fences mock-cm' style='display:block;position:relative'>NSLog(@&quot;password2:%@&quot;, password);</pre><p></p><pre class='md-fences mock-cm' style='display:block;position:relative'>
  &gt; 每一个公司都有自己的“盐值”，盐值越复杂，越安全

## 时间戳密码

### 基本介绍

- 动态密码：相同的密码明文+相同的加密算法--&gt;因为每次登陆时间都不同,所以每次计算出的结果也都不相同.可以充分保证密码的安全性.
- 服务器会计算两个时间值,当期时间和前一分钟的时间(比如:第59S发送的网络请求,一秒钟后服务器收到并作出响应,这时服务器当前时间比客户端发送时间晚一分钟，仍然能够判断准确的值)

### 使用步骤

- 获取MD5 首次加密的密码

  ```objective-c
    // 1. 当前密码
    NSString *password = @&quot;zhang&quot;;

    // 2. hmacKey值，是对“WangPengfei” 进行 MD5加密之后的值（动态生成的）
    NSString *hmacKey = @&quot;d3bba33b51acaa0a272de7a2f6dfa233&quot;;
</pre><ul><li><p>加密过程</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 1. 第一次加密：第一次 HMAC 运算</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">password</span> <span class="cm-operator">=</span> [<span class="cm-variable">password</span> <span class="cm-variable">hmacMD5StringWithKey</span>:<span class="cm-variable">hmacKey</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 2.1 获得当前的时间</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">NSDate</span> <span class="cm-operator">*</span><span class="cm-variable">date</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSDate</span> <span class="cm-variable">date</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 2.2 获得当前时间的字符串</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 实例化时间格式器</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">NSDateFormatter</span> <span class="cm-operator">*</span><span class="cm-variable">formatter</span> <span class="cm-operator">=</span> [[<span class="cm-variable">NSDateFormatter</span> <span class="cm-variable">alloc</span>] <span class="cm-variable">init</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 设置时间格式</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">formatter</span>.<span class="cm-variable">dateFormat</span> <span class="cm-operator">=</span> <span class="cm-keyword">@</span><span class="cm-string">"yyyy-MM-dd HH:mm"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 获取当前时间（要和服务器保持一致）</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">NSString</span> <span class="cm-operator">*</span><span class="cm-variable">dateStr</span> <span class="cm-operator">=</span> [<span class="cm-variable">formatter</span> <span class="cm-variable">stringFromDate</span>:<span class="cm-variable">date</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 3. 将第一次加密后的密码与当前时间的字符串拼接在一起</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">password</span> <span class="cm-operator">=</span> [<span class="cm-variable">password</span> <span class="cm-variable">stringByAppendingString</span>:<span class="cm-variable">dateStr</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 4. 进行第二次 HMAC 加密</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">password</span> <span class="cm-operator">=</span> [<span class="cm-variable">password</span> <span class="cm-variable">hmacMD5StringWithKey</span>:<span class="cm-variable">hmacKey</span>];</span></pre></div></div></div></div></div></div></div></pre></li><li><p>访问 loginhmac.php 接口,发送请求</p><ul><li><p>创建请求</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSURL</span> <span class="cm-operator">*</span><span class="cm-variable">url</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSURL</span> <span class="cm-variable">URLWithString</span>:<span class="cm-keyword">@</span><span class="cm-string">"http://localhost/login/loginhmac.php"</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// POST 要手动设置方法，因此为可变</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSMutableURLRequest</span> <span class="cm-operator">*</span><span class="cm-variable">request</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSMutableURLRequest</span> <span class="cm-variable">requestWithURL</span>:<span class="cm-variable">url</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// 设置请求方法</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">request</span>.<span class="cm-variable">HTTPMethod</span> <span class="cm-operator">=</span> <span class="cm-keyword">@</span><span class="cm-string">"POST"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// 设置请求体内容</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSString</span> <span class="cm-operator">*</span><span class="cm-variable">body</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSString</span> <span class="cm-variable">stringWithFormat</span>:<span class="cm-keyword">@</span><span class="cm-string">"username=zhangsan&amp;password=%@"</span>, <span class="cm-variable">password</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">request</span>.<span class="cm-variable">HTTPBody</span> <span class="cm-operator">=</span> [<span class="cm-variable">body</span> <span class="cm-variable">dataUsingEncoding</span>:<span class="cm-variable">NSUTF8StringEncoding</span>];</span></pre></div></div></div></div></div></div></div></pre></li><li><p>发送请求</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">[[[<span class="cm-variable">NSURLSession</span> <span class="cm-variable">sharedSession</span>] <span class="cm-variable">dataTaskWithRequest</span>:<span class="cm-variable">request</span> <span class="cm-variable">completionHandler</span>:<span class="cm-variable">^</span>(<span class="cm-variable">NSData</span> <span class="cm-operator">*</span> <span class="cm-variable">_Nullable</span> <span class="cm-variable">data</span>, <span class="cm-variable">NSURLResponse</span> <span class="cm-operator">*</span> <span class="cm-variable">_Nullable</span> <span class="cm-variable">response</span>, <span class="cm-variable">NSError</span> <span class="cm-operator">*</span> <span class="cm-variable">_Nullable</span> <span class="cm-variable">error</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"%@"</span>, [[<span class="cm-variable">NSString</span> <span class="cm-variable">alloc</span>] <span class="cm-variable">initWithData</span>:<span class="cm-variable">data</span> <span class="cm-variable">encoding</span>:<span class="cm-variable">NSUTF8StringEncoding</span>]);</span></pre><pre class=""><span style="padding-right: 0.1px;">}] <span class="cm-variable">resume</span>];</span></pre></div></div></div></div></div></div></div></pre></li></ul></li></ul><h2><a name='header-c592' class='md-header-anchor '></a>钥匙串访问</h2><h3><a name='header-c593' class='md-header-anchor '></a>基本介绍</h3><ul><li>苹果在 iOS 7.0.3版本以后公布钥匙串访问的SDK.钥匙串访问接口是纯C语言的.</li><li>钥匙串使用 AES 256加密算法,能够保证用户密码的安全.</li><li>钥匙串访问的第三方框架<code>SSKeychain</code>,是对C语言框架的封装.注意:不需要看源码.</li><li>钥匙串访问的密码保存在哪里?只有苹果才知道.这样进一步保障了用户的密码安全.</li></ul><h3><a name='header-c607' class='md-header-anchor '></a>简单使用</h3><ul><li><p>参数介绍</p><ul><li>Password :需要存储的密码信息.</li><li>Service :用来标识 app ,app的唯一标识符.</li><li>account :账户信息,当前密码所对应的账号.</li></ul></li><li><p>利用钥匙串进行加密</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 获取应用程序唯一标识.</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">NSString</span> <span class="cm-operator">*</span><span class="cm-variable">bundleId</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSBundle</span> <span class="cm-variable">mainBundle</span>].<span class="cm-variable">bundleIdentifier</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 利用第三方框架,将用户密码保存在钥匙串</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  [<span class="cm-variable">SSKeychain</span> <span class="cm-variable">setPassword</span>:<span class="cm-keyword">self</span>.<span class="cm-variable">pwdText</span>.<span class="cm-variable">text</span> <span class="cm-variable">forService</span>:<span class="cm-variable">bundleId</span> <span class="cm-variable">account</span>:<span class="cm-keyword">@</span><span class="cm-string">"wpf"</span>];</span></pre></div></div></div></div></div></div></div></pre></li><li><p>从钥匙串加载密码</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">self</span>.<span class="cm-variable">pwdText</span>.<span class="cm-variable">text</span> <span class="cm-operator">=</span> [<span class="cm-variable">SSKeychain</span> <span class="cm-variable">passwordForService</span>:<span class="cm-variable">bundleId</span> <span class="cm-variable">account</span>:<span class="cm-keyword">@</span><span class="cm-string">"wpf"</span>];</span></pre></div></div></div></div></div></div></div></pre></li></ul><h2><a name='header-c630' class='md-header-anchor '></a>指纹识别</h2><h3><a name='header-c631' class='md-header-anchor '></a>简单介绍</h3><ul><li>指纹识别功能是 iphone 5S之后推出的.SDK是 iOS 8.0 推出!</li><li>推出指纹识别功能的目的,是为了简化移动支付环节,占领移动支付市场.</li></ul><h3><a name='header-c639' class='md-header-anchor '></a>使用步骤</h3><ul><li><p>导入框架</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-meta">#import &lt;LocalAuthentication/LocalAuthentication.h&gt;</span></span></pre></div></div></div></div></div></div></div></pre></li><li><p>获得当前系统版本号</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable-3">float</span> <span class="cm-variable">version</span> <span class="cm-operator">=</span> [<span class="cm-variable">UIDevice</span> <span class="cm-variable">currentDevice</span>].<span class="cm-variable">systemVersion</span>.<span class="cm-variable">floatValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> (<span class="cm-variable">version</span> <span class="cm-operator">&lt;</span> <span class="cm-number">8.0</span> ) <span class="cm-comment">// 判断当前系统版本 {</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"系统版本太低,请升级至最新系统"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">return</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div></div></div></pre></li><li><p>实例化指纹识别对象,判断当前设备是否支持指纹识别功能(是否带有TouchID)</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 1&gt; 实例化指纹识别对象</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">LAContext</span> <span class="cm-operator">*</span><span class="cm-variable">laCtx</span> <span class="cm-operator">=</span> [[<span class="cm-variable">LAContext</span> <span class="cm-variable">alloc</span>] <span class="cm-variable">init</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// 2&gt; 判断当前设备是否支持指纹识别功能.</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> (<span class="cm-operator">!</span>[<span class="cm-variable">laCtx</span> <span class="cm-variable">canEvaluatePolicy</span>:<span class="cm-variable">LAPolicyDeviceOwnerAuthenticationWithBiometrics</span> <span class="cm-variable">error</span>:<span class="cm-atom">NULL</span>]) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// 如果设备不支持指纹识别功能</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"该设备不支持指纹识别功能"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">return</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  };</span></pre></div></div></div></div></div></div></div></pre></li><li><p>指纹登陆(默认是异步方法)</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"> [<span class="cm-variable">laCtx</span> <span class="cm-variable">evaluatePolicy</span>:<span class="cm-variable">LAPolicyDeviceOwnerAuthenticationWithBiometrics</span> <span class="cm-variable">localizedReason</span>:<span class="cm-keyword">@</span><span class="cm-string">"指纹登陆"</span> <span class="cm-variable">reply</span>:<span class="cm-variable">^</span>(<span class="cm-keyword">BOOL</span> <span class="cm-variable">success</span>, <span class="cm-variable">NSError</span> <span class="cm-operator">*</span><span class="cm-variable">error</span>) { &nbsp; &nbsp;  <span class="cm-comment">// 如果成功,表示指纹输入正确. &nbsp; &nbsp;  </span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> (<span class="cm-variable">success</span>) </span></pre><pre class=""><span style="padding-right: 0.1px;">  { &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"指纹识别成功!"</span>); &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  } <span class="cm-keyword">else</span> { &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"指纹识别错误,请再次尝试"</span>); &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;">  } </span></pre><pre class=""><span style="padding-right: 0.1px;">  }];</span></pre></div></div></div></div></div></div></div></pre></li></ul><h2><a name='header-c657' class='md-header-anchor '></a>AES/RSA</h2><h3><a name='header-c658' class='md-header-anchor '></a>简单介绍</h3><ul><li>AES加密也叫对称加密：A用密码对数据进行AES加密后，B用同样的密码对密文进行AES解密。</li></ul><ul><li>在服务器与终端设备进行HTTP通讯时，常常会被网络抓包、反编译（Android APK反编译工具）等技术得到HTTP通讯接口地址和参数。为了确保信息的安全，我们采用AES+RSA组合的方式进行接口参数加密和解密。</li><li>关于RSA加密机制：公钥用于对数据进行加密，私钥对数据进行解密，两者不可逆。公钥和私钥是同时生成的，一一对应。比如：A拥有公钥，B拥有公钥和私钥。A将数据通过公钥进行加密后，发送密文给B，B可以通过私钥和公钥进行解密。</li><li>AES加密也叫对称加密：A用密码对数据进行AES加密后，B用同样的密码对密文进行AES解密。</li></ul><p><strong>AES 对称加密  秘钥加密 秘钥解密  效率高 不安全</strong>
<strong>RSA非对称加密  效率低 安全</strong></p><ul><li>A想要从B获取数据 A生成公钥和私钥    公钥与私钥是唯一对应的  将其中一方传给B 列如私钥 B拿到私钥对文件加密 生成密文 回传给A</li><li>A根据公钥解密数据  第三方最多只能拿到密文和私钥 无法解密</li><li>发送大文件将对称加密的秘钥 采用非对称加密  拿不到对称加密的秘钥就是安全的   即使用对称加密原文 用非对称加密加密对称加密的秘钥</li></ul><h3><a name='header-c686' class='md-header-anchor '></a>使用步骤</h3><blockquote><p>简书：<a href='http://www.jianshu.com/p/74a796ec5038'>iOS中使用RSA加密</a></p></blockquote><hr /><h1><a name='header-c691' class='md-header-anchor '></a>网络协议</h1><h2><a name='header-c692' class='md-header-anchor '></a>TCP和UDP的区别于联系</h2><ul><li>TCP为传输控制层协议，为面向连接、可靠的、点到点的通信；</li><li>UDP为用户数据报协议，非连接的不可靠的点到多点的通信；</li><li>TCP侧重可靠传输，UDP侧重快速传输。</li></ul><h2><a name='header-c703' class='md-header-anchor '></a>TCP连接的三次握手</h2><ul><li>第一次握手：客户端发送syn包（syn=j）到服务器，并进入SYN_SEND状态，等待服务器确认；</li><li>第二次握手：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包，即SYN+ACK包，此时服务器进入SYN+RECV状态；</li><li>第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK（ack=k+1），此发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次状态。</li></ul><h2><a name='header-c714' class='md-header-anchor '></a>SOCKET原理</h2><h3><a name='header-c715' class='md-header-anchor '></a>套接字（socket）概念</h3><pre class='md-fences mock-cm' style='display:block;position:relative'>套接字（socket）是通信的基石，是支持TCP/IP协议的网络通信的基本操作单元。它是网络通信过程中端点的抽象表示，包含进行网络通信必须的五种信息：连接使用的协议，本地主机的IP地址，本地进程的协议端口，远地主机的IP地址，远地进程的协议端口。

应用层通过传输层进行数据通信时，TCP会遇到同时为多个应用程序进程提供并发服务的问题。多个TCP连接或多个应用程序进程可能需要通过同一个 TCP协议端口传输数据。为了区别不同的应用程序进程和连接，许多计算机操作系统为应用程序与TCP／IP协议交互提供了套接字(Socket)接口。应 用层可以和传输层通过Socket接口，区分来自不同应用程序进程或网络连接的通信，实现数据传输的并发服务。</pre><h3><a name='header-c717' class='md-header-anchor '></a>建立socket连接</h3><pre class='md-fences mock-cm' style='display:block;position:relative'>建立Socket连接至少需要一对套接字，其中一个运行于客户端，称为ClientSocket，另一个运行于服务器端，称为ServerSocket。

套接字之间的连接过程分为三个步骤：服务器监听，客户端请求，连接确认。

服务器监听：服务器端套接字并不定位具体的客户端套接字，而是处于等待连接的状态，实时监控网络状态，等待客户端的连接请求。

客户端请求：指客户端的套接字提出连接请求，要连接的目标是服务器端的套接字。为此，客户端的套接字必须首先描述它要连接的服务器的套接字，指出服务器端套接字的地址和端口号，然后就向服务器端套接字提出连接请求。

连 接确认：当服务器端套接字监听到或者说接收到客户端套接字的连接请求时，就响应客户端套接字的请求，建立一个新的线程，把服务器端套接字的描述发给客户 端，一旦客户端确认了此描述，双方就正式建立连接。而服务器端套接字继续处于监听状态，继续接收其他客户端套接字的连接请求。
</pre><h3><a name='header-c719' class='md-header-anchor '></a>SOCKET连接与TCP连接</h3><pre class='md-fences mock-cm' style='display:block;position:relative'>创建Socket连接时，可以指定使用的传输层协议，Socket可以支持不同的传输层协议（TCP或UDP），当使用TCP协议进行连接时，该Socket连接就是一个TCP连接。</pre><h3><a name='header-c721' class='md-header-anchor '></a>Socket连接与HTTP连接</h3><pre class='md-fences mock-cm' style='display:block;position:relative'>由 于通常情况下Socket连接就是TCP连接，因此Socket连接一旦建立，通信双方即可开始相互发送数据内容，直到双方连接断开。但在实际网络应用 中，客户端到服务器之间的通信往往需要穿越多个中间节点，例如路由器、网关、防火墙等，大部分防火墙默认会关闭长时间处于非活跃状态的连接而导致 Socket 连接断连，因此需要通过轮询告诉网络，该连接处于活跃状态。

而HTTP连接使用的是“请求—响应”的方式，不仅在请求时需要先建立连接，而且需要客户端向服务器发出请求后，服务器端才能回复数据。

很 多情况下，需要服务器端主动向客户端推送数据，保持客户端与服务器数据的实时与同步。此时若双方建立的是Socket连接，服务器就可以直接将数据传送给 客户端；若双方建立的是HTTP连接，则服务器需要等到客户端发送一次请求后才能将数据传回给客户端，因此，客户端定时向服务器端发送连接请求，不仅可以 保持在线，同时也是在“询问”服务器是否有新的数据，如果有就将数据传给客户端。</pre><p><strong>下面这篇<a href='http://my.oschina.net/joanfen/blog/287238'>文章</a>是AsyncSocket的使用教程，大家可以看看</strong></p><h3><a name='header-c725' class='md-header-anchor '></a>Scoket连接和HTTP连接的区别：</h3><ul><li>HTTP协议是基于TCP连接的，是应用层协议，主要解决如何包装数据。Socket是对TCP/IP协议的封装，Socket本身并不是协议，而是一个调用接口（API），通过Socket，我们才能使用TCP/IP协议。</li><li>HTTP连接：短连接，客户端向服务器发送一次请求，服务器响应后连接断开，节省资源。服务器不能主动给客户端响应（除非采用HTTP长连接技术），iPhone主要使用类NSURLConnection。</li><li>Socket连接：长连接，客户端跟服务器端直接使用Socket进行连接，没有规定连接后断开，因此客户端和服务器段保持连接通道，双方可以主动发送数据，一般多用于游戏.Socket默认连接超时时间是30秒，默认大小是8K（理解为一个数据包大小）。</li></ul><h2><a name='header-c736' class='md-header-anchor '></a>HTTP协议的特点，关于HTTP请求GET和POST的区别</h2><p><code>GET和POST的区别</code>：</p><ul><li><p>HTTP超文本传输协议，是短连接，是客户端主动发送请求，服务器做出响应，服务器响应之后，链接断开。HTTP是一个属于应用层面向对象的协议，HTTP有两类报文：请求报文和响应报文。</p></li><li><p>HTTP请求报文：一个HTTP请求报文由请求行、请求头部、空行和请求数据4部分组成。</p></li><li><p>HTTP响应报文：由三部分组成：状态行、消息报头、响应正文。</p></li><li><p>GET请求：参数在地址后拼接，没有请求数据，不安全（因为所有参数都拼接在地址后面），不适合传输大量数据（长度有限制，为1024个字节）。</p><pre class='md-fences mock-cm' style='display:block;position:relative'>  GET提交、请求的数据会附在URL之后，即把数据放置在HTTP协议头&lt;requestline&gt;中。
  以？分割URL和传输数据，多个参数用&amp;连接。如果数据是英文字母或数字，原样发送，
  如果是空格，转换为+，如果是中文/其他字符，则直接把字符串用BASE64加密。</pre></li><li><p>POST请求：参数在请求数据区放着，相对GET请求更安全，并且数据大小没有限制。把提交的数据放置在HTTP包的包体``中.</p></li><li><p>GET提交的数据会在地址栏显示出来，而POST提交，地址栏不会改变。</p></li></ul><p><code>传输数据的大小：</code></p><ul><li>GET提交时，传输数据就会受到URL长度限制，POST由于不是通过URL传值，理论上书不受限。</li></ul><p><code>安全性：</code></p><ul><li>POST的安全性要比GET的安全性高；</li><li>通过GET提交数据，用户名和密码将明文出现在URL上，比如登陆界面有可能被浏览器缓存。</li><li>HTTPS：安全超文本传输协议（<code>Secure Hypertext Transfer Protocol</code>），它是一个安全通信通道，基于HTTP开发，用于客户计算机和服务器之间交换信息，使用安全套结字层（<code>SSI</code>）进行信息交换，即HTTP的安全版。</li></ul><hr /><h1><a name='header-c778' class='md-header-anchor '></a>多线程</h1><h2><a name='header-c779' class='md-header-anchor '></a>线程与进程的区别和联系?</h2><ul><li>一个程序至少要有进城,一个进程至少要有一个线程.</li><li>进程:资源分配的最小独立单元,进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动,进程是系统进行资源分配和调度的一个独立单位.</li><li>线程:进程下的一个分支,是进程的实体,是CPU调度和分派的基本单元,它是比进程更小的能独立运行的基本单位,线程自己基本不拥有系统资源,只拥有一点在运行中必不可少的资源(程序计数器、一组寄存器、栈)，但是它可与同属一个进程的其他线程共享进程所拥有的全部资源。</li><li>进程和线程都是由操作系统所体会的程序运行的基本单元，系统利用该基本单元实现系统对应用的并发性。 </li><li>进程和线程的主要差别在于它们是不同的操作系统资源管理方式。进程有独立的地址空间，一个进程崩溃后，在保护模式下不会对其它进程产生影响，而线程只是一个进程中的不同执行路径。线程有自己的堆栈和局部变量，但线程之间没有单独的地址空间，一个线程死掉就等于整个进程死掉，所以多进程的程序要比多线程的程序健壮，但在进程切换时，耗费资源较大，效率要差一些。</li><li>但对于一些要求同时进行并且又要共享某些变量的并发操作，只能用线程，不能用进程。</li></ul><h2><a name='header-c799' class='md-header-anchor '></a>多线程编程</h2><ul><li><code>NSThread</code>:当需要进行一些耗时操作时会把耗时的操作放到线程中。线程同步：多个线程同时访问一个数据会出问题，NSlock、线程同步块、@synchronized(self){}。</li><li><code>NSOperationQueue操作队列</code>（不需考虑线程同步问题）。编程的重点都放在main里面，<code>NSInvocationOperation</code>、<code>BSBlockOperation</code>、自定义Operation。创建一个操作绑定相应的方法，当把操作添加到操作队列中时，操作绑定的方法就会自动执行了，当把操作添加到操作队列中时，默认会调用main方法。</li><li>GCD（<code>`Grand Central Dispatch</code>）宏大的中央调度，串行队列、并发队列、主线程队列；</li><li>同步和异步：同步指第一个任务不执行完，不会开始第二个，异步是不管第一个有没有执行完，都开始第二个。</li><li>串行和并行：串行是多个任务按一定顺序执行，并行是多个任务同时执行；</li><li>代码是在分线程执行，在主线程嘟列中刷新UI。</li></ul><p><em>* 多线程编程是防止主线程堵塞、增加运行效率的最佳方法。</em>*</p><ul><li>Apple提供了NSOperation这个类，提供了一个优秀的多线程编程方法；</li><li>一个NSOperationQueue操作队列，相当于一个线程管理器，而非一个线程，因为你可以设置这个线程管理器内可以并行运行的线程数量等。</li><li>多线程是一个比较轻量级的方法来实现单个应用程序内多个代码执行路径。</li><li>iPhoneOS下的主线程的堆栈大小是1M。第二个线程开始就是512KB，并且该值不能通过编译器开关或线程API函数来更改，只有主线程有直接修改UI的能力。</li></ul><h2><a name='header-c834' class='md-header-anchor '></a>定时器与线程的区别;</h2><ul><li>定时器;可以执行多次，默认在主线程中。</li><li>线程：只能执行一次。</li></ul><h2><a name='header-c842' class='md-header-anchor '></a>平常常用的多线程处理方式及优缺点</h2><p>iOS有四种多线程编程的技术，分别是：NSThread，Cocoa NSOperation，GCD（全称：Grand Central Dispatch）,pthread。</p><h3><a name='header-c845' class='md-header-anchor '></a>四种方式的优缺点介绍:</h3><ol><li>NSThread<strong>优点：NSThread 比其他两个轻量级</strong>。<strong>缺点：</strong>需要自己管理线程的生命周期，线程同步。线程同步对数据的加锁会有一定的系统开销。</li><li>Cocoa  NSOperation<strong>优点:</strong>不需要关心线程管理， 数据同步的事情，可以把精力放在自己需要执行的操作上。Cocoa operation相关的类是NSOperation, NSOperationQueue.NSOperation是个抽象类,使用它必须用它的子类，可以实现它或者使用它定义好的两个子类: NSInvocationOperation和NSBlockOperation.创建NSOperation子类的对象，把对象添加到NSOperationQueue队列里执行。</li><li><strong>GCD</strong>(全优点)Grand Central dispatch(GCD)是Apple开发的一个多核编程的解决方案。在iOS4.0开始之后才能使用。GCD是一个替代NSThread, NSOperationQueue,NSInvocationOperation等技术的很高效强大的技术。</li><li>pthread是一套通用的多线程API，适用于Linux\Windows\Unix,跨平台，可移植，使用C语言，生命周期需要程序员管理，IOS开发中使用很少。</li></ol><h2><a name='header-c859' class='md-header-anchor '></a>GCD线程死锁</h2><p>GCD 确实好用 ，很强大，相比NSOpretion 无法提供 取消任务的功能。
如此强大的工具用不好可能会出现线程死锁。 如下代码：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">viewDidLoad</span>{ </span></pre><pre class=""><span style="padding-right: 0.1px;">[<span class="cm-keyword">super</span> <span class="cm-variable">viewDidLoad</span>]; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"=================4"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">dispatch_sync</span>(<span class="cm-variable">dispatch_get_main_queue</span>(), </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">^</span>{ <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"=================5"</span>); }); </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"=================6"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p><strong>GCD Queue 分为三种：</strong></p><ol><li>The main queue  ：主队列，主线程就是在个队列中。</li><li>Global queues ： 全局并发队列。</li><li>用户队列:是用函数 dispatch_queue_create创建的自定义队列</li></ol><p><strong>dispatch_sync 和  dispatch_async 区别：</strong></p><ul><li>dispatch_async(queue,block)  async 异步队列，dispatch_async</li></ul><p>​      函数会立即返回, block会在后台异步执行。</p><ul><li>dispatch_sync(queue,block)   sync 同步队列，dispatch_sync</li></ul><p>​     函数不会立即返回，及阻塞当前线程,等待 block同步执行完成。</p><blockquote><p>分析上面代码:</p><p>viewDidLoad 在主线程中， 及在dispatch_get_main_queue() 中，执行到sync 时 向dispatch_get_main_queue()插入 同步 threed。sync 会等到 后面block 执行完成才返回， sync 又再 dispatch_get_main_queue() 队列中，它是串行队列，sync 是后加入的，前一个是主线程，所以 sync 想执行 block 必须等待主线程执行完成，主线程等待 sync 返回，去执行后续内容。照成死锁，sync 等待mainThread 执行完成， mianThread 等待sync 函数返回。下面例子：</p></blockquote><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">viewDidLoad</span>{ </span></pre><pre class=""><span style="padding-right: 0.1px;">[<span class="cm-keyword">super</span> <span class="cm-variable">viewDidLoad</span>]; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">dispatch_async</span>(<span class="cm-variable">dispatch_get_global_queue</span>(<span class="cm-number">0</span>, <span class="cm-number">0</span>), <span class="cm-variable">^</span>{ </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"=================1"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">dispatch_sync</span>(<span class="cm-variable">dispatch_get_main_queue</span>(), <span class="cm-variable">^</span>{ </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"=================2"</span>); }); </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"=================3"</span>); });</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><blockquote><p>程序会完成执行，为什么不会出现死锁。</p></blockquote><p>首先： async 在主线程中  创建了一个异步线程 加入  全局并发队列，async 不会等待block 执行完成，立即返回，</p><ol><li>async 立即返回， viewDidLoad 执行完毕，及主线程执行完毕。</li><li>同时，全局并发队列立即执行异步 block ， 打印 1， 当执行到 sync 它会等待 block 执行完成才返回， 及等待dispatch_get_main_queue() 队列中的 mianThread 执行完成， 然后才开始调用block 。因为1 和 2 几乎同时执行，因为2 在全局并发队列上， 2 中执行到sync 时 1 可能已经执行完成或 等了一会，mainThread 很快退出， 2 等已执行后继续内容。如果阻塞了主线程，2 中的sync 就无法执行啦，mainThread 永远不会退出， sync 就永远等待着。</li></ol><h2><a name='header-c908' class='md-header-anchor '></a>队列和多线程的使用原理</h2><p><strong>在iOS中队列分为以下几种：</strong></p><ul><li><p>串行队列：队列中的任务只会顺序执行；</p><pre class='md-fences mock-cm' style='display:block;position:relative'>dispatch_queue_t q = dispatch_queue_create(&quot;...&quot;, DISPATCH_QUEUE_SERIAL);</pre></li><li><p>并行队列： 队列中的任务通常会并发执行；</p><pre class='md-fences mock-cm' style='display:block;position:relative'>dispatch_queue_t q = dispatch_queue_create(&quot;......&quot;,DISPATCH_QUEUE_CONCURRENT);</pre></li><li><p>全局队列：是系统的，直接拿过来（GET）用就可以；与并行队列类似；</p><pre class='md-fences mock-cm' style='display:block;position:relative'>dispatch_queue_t q = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</pre></li><li><p>主队列：每一个应用程序对应唯一主队列，直接GET即可；在多线程开发中，使用主队列更新UI；</p><pre class='md-fences mock-cm' style='display:block;position:relative'>dispatch_queue_t q = dispatch_get_main_queue();</pre></li><li><p>更多细节见下图：</p></li></ul><p><img src='http://upload-images.jianshu.io/upload_images/1713024-0cb065e2b0883ffb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240' alt='' /></p><hr /><h1><a name='header-c934' class='md-header-anchor '></a>单例</h1><h2><a name='header-c935' class='md-header-anchor '></a>简单理解</h2><blockquote><p>单例模式是一种常用设计模式，单例模式是一个类在系统中只有一个实例对象。通过全局的一个入口点对这个实例对象进行访问；</p></blockquote><p><em>iOS中单例模式的实现方式一般分为两种：非ARC和ARC+GCD。</em></p><h2><a name='header-c941' class='md-header-anchor '></a>手写单例</h2><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#import "AudioPlayTool.h"</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@implementation</span> <span class="cm-variable">AudioPlayTool</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-keyword">id</span> <span class="cm-variable">_instance</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> (<span class="cm-variable">instancetype</span>)<span class="cm-variable">sharedAudioPlayTool</span>{</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/**</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">一次性执行  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">dispatch_once是安全的,系统已经帮我们加了锁,所以在多个线程强夺同一资源的时候,它也是安全的</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">static</span> <span class="cm-variable">dispatch_once_t</span> <span class="cm-variable">onceToken</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">dispatch_once</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">onceToken</span>, <span class="cm-variable">^</span>{</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"-----once------"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">_instance</span> <span class="cm-operator">=</span> [[<span class="cm-keyword">self</span> <span class="cm-variable">alloc</span>] <span class="cm-variable">init</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  });</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">_instance</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+</span> (<span class="cm-variable">instancetype</span>)<span class="cm-variable">allocWithZone</span>:(<span class="cm-keyword">struct</span> <span class="cm-variable">_NSZone</span> <span class="cm-operator">*</span>)<span class="cm-variable">zone</span>{</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">static</span> <span class="cm-variable">dispatch_once_t</span> <span class="cm-variable">onceToken</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">dispatch_once</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">onceToken</span>, <span class="cm-variable">^</span>{</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">_instance</span> <span class="cm-operator">=</span> [<span class="cm-keyword">super</span> <span class="cm-variable">allocWithZone</span>:<span class="cm-variable">zone</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  });</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">_instance</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-keyword">id</span>)<span class="cm-variable">copyWithZone</span>:(<span class="cm-variable">NSZone</span> <span class="cm-operator">*</span>)<span class="cm-variable">zone</span>{</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">_instance</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@end</span></span></pre></div></div></div></div></div></div></div></pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">UIKit</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">SoundTools</span>: <span class="cm-variable">NSObject</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// let 保证线程安全</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">static</span> <span class="cm-keyword">let</span> <span class="cm-def">sharedTools</span> <span class="cm-operator">=</span> <span class="cm-variable">SoundTools</span><span class="cm-punctuation">()</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// private 修饰的构造方法.不允许外界直接调用该构造方法</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">private</span> <span class="cm-keyword">override</span> <span class="cm-keyword">init</span><span class="cm-punctuation">()</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><hr /><h1><a name='header-c945' class='md-header-anchor '></a>keyPath/KVC/KVO</h1><h2><a name='header-c946' class='md-header-anchor '></a>键路径</h2><ul><li>在一个给定的实体中,同一个属性的所有值具有相同的数据类型。</li><li>键-值编码技术用于进行这样的查找—它是一种间接访问对象属性的机制。 - 键路径是一个由用点作分隔符的键组成的字符串,用于指定一个连接在一起的对象性质序列。第一个键的性质是由先前的性质决定的,接下来每个键的值也是相对于其前面的性质。</li><li>键路径使您可以以独立于模型实现的方式指定相关对象的性质。通过键路径,您可以指定对象图中的一个任意深度的路径,使其指向相关对象的特定属性。</li></ul><h2><a name='header-c957' class='md-header-anchor '></a>键值编码KVC</h2><ul><li>键值编码是一种间接访问对象的属性使用字符串来标识属性，而不是通过调用存取方法，直接或通过实例变量访问的机制，非对象类型的变量将被自动封装或者解封成对象，很多情况下会简化程序代码；</li><li>KVC的缺点：一旦使用 KVC 你的编译器无法检查出错误,即不会对设置的键、键路径进行错误检查,且执行效率要低于合成存取器方法和自定的 setter 和 getter 方法。因为使用 KVC 键值编码,它必须先解析字符串,然后在设置或者访问对象的实例变量。</li></ul><h2><a name='header-c965' class='md-header-anchor '></a>键值观察KVO</h2><ul><li>键值观察机制是一种能使得对象获取到其他对象属性变化的通知 ，极大的简化了代码。</li><li>实现 KVO 键值观察模式,被观察的对象必须使用 KVC 键值编码来修 改它的实例变量,这样才能被观察者观察到。因此,KVC是KVO的基础。</li></ul><h2><a name='header-c973' class='md-header-anchor '></a>Demo</h2><blockquote><p>比如我自定义的一个button</p></blockquote><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">[<span class="cm-keyword">self</span> <span class="cm-variable">addObserver</span>:<span class="cm-keyword">self</span> <span class="cm-variable">forKeyPath</span>:<span class="cm-keyword">@</span><span class="cm-string">"highlighted"</span> <span class="cm-variable">options</span>:<span class="cm-number">0</span> <span class="cm-variable">context</span>:<span class="cm-keyword">nil</span>]; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#pragma mark KVO </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">observeValueForKeyPath</span>:(<span class="cm-variable">NSString</span> <span class="cm-operator">*</span>)<span class="cm-variable">keyPath</span> <span class="cm-variable">ofObject</span>:(<span class="cm-keyword">id</span>)<span class="cm-variable">object</span> <span class="cm-variable">change</span>:(<span class="cm-variable">NSDictionary</span> <span class="cm-operator">*</span>)<span class="cm-variable">change</span> <span class="cm-variable">context</span>:(<span class="cm-variable-3">void</span> <span class="cm-operator">*</span>)<span class="cm-variable">context</span> </span></pre><pre class=""><span style="padding-right: 0.1px;">{ </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-keyword">if</span> ([<span class="cm-variable">keyPath</span> <span class="cm-variable">isEqualToString</span>:<span class="cm-keyword">@</span><span class="cm-string">"highlighted"</span>] ) { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  [<span class="cm-keyword">self</span> <span class="cm-variable">setNeedsDisplay</span>]; </span></pre><pre class=""><span style="padding-right: 0.1px;">} </span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div></div></div></pre><blockquote><p>对于系统是根据keypath去取的到相应的值发生改变，理论上来说是和kvc机制的道理是一样的。</p></blockquote><h2><a name='header-c981' class='md-header-anchor '></a>KVC机制通过<code>key</code>找到<code>value</code>的原理</h2><ul><li>当通过KVC调用对象时，比如：<code>[self valueForKey:@”someKey”]</code>时，程序会自动试图通过下面几种不同的方式解析这个调用。</li><li>首先查找对象是否带有 <code>someKey</code> 这个方法，如果没找到，会继续查找对象是否带有<code>someKey</code>这个实例变量（<code>iVar</code>），如果还没有找到，程序会继续试图调用 <code>-(id) valueForUndefinedKey:</code>这个方法。如果这个方法还是没有被实现的话，程序会抛出一个<code>NSUndefinedKeyException</code>异常错误。</li><li>补充：KVC查找方法的时候，不仅仅会查找someKey这个方法，还会查找getsomeKey这个方法，前面加一个get，或者<em>someKey以</em>getsomeKey这几种形式。同时，查找实例变量的时候也会不仅仅查找someKey这个变量，也会查找_someKey这个变量是否存在。</li><li>设计<code>valueForUndefinedKey:</code>方法的主要目的是当你使用<code>-(id)valueForKey</code>方法从对象中请求值时，对象能够在错误发生前，有最后的机会响应这个请求。</li></ul><h2><a name='header-c995' class='md-header-anchor '></a>在 Objective-C 中如何实现 KVO</h2><ul><li><p>注册观察者(<code>注意：观察者和被观察者不会被保留也不会被释放</code>) </p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">addObserver</span>:(<span class="cm-variable">NSObject</span> <span class="cm-operator">*</span>)<span class="cm-variable">observer</span> <span class="cm-variable">forKeyPath</span>:(<span class="cm-variable">NSString</span> <span class="cm-operator">*</span>)<span class="cm-variable">keyPath</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">options</span>:(<span class="cm-variable">NSKeyValueObservingOptions</span>)<span class="cm-variable">options</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">context</span>:(<span class="cm-variable-3">void</span> <span class="cm-operator">*</span>)<span class="cm-variable">context</span>;</span></pre></div></div></div></div></div></div></div></pre></li><li><p>接收变更通知</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">observeValueForKeyPath</span>:(<span class="cm-variable">NSString</span> <span class="cm-operator">*</span>)<span class="cm-variable">keyPath</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">ofObject</span>:(<span class="cm-keyword">id</span>)<span class="cm-variable">object</span> <span class="cm-variable">change</span>:(<span class="cm-variable">NSDictionary</span> <span class="cm-operator">*</span>)<span class="cm-variable">change</span> &nbsp; <span class="cm-variable">context</span>:(<span class="cm-variable-3">void</span> <span class="cm-operator">*</span>)<span class="cm-variable">context</span>;</span></pre></div></div></div></div></div></div></div></pre></li><li><p>移除对象的观察者身份</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">removeObserver</span>:(<span class="cm-variable">NSObject</span> <span class="cm-operator">*</span>)<span class="cm-variable">observer</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">forKeyPath</span>:(<span class="cm-variable">NSString</span> <span class="cm-operator">*</span>)<span class="cm-variable">keyPath</span>;</span></pre></div></div></div></div></div></div></div></pre></li><li><p>KVO中<code>谁要监听谁注册</code>，然后对响应进行处理，使得观察者与被观察者完全解耦。KVO只检测类中的属性，并且属性名都是通过NSString来查找，编译器不会检错和补全，全部取决于自己。</p></li></ul><h2><a name='header-c1012' class='md-header-anchor '></a>代理的作用</h2><ul><li>代理又叫委托，是一种设计模式，代理是对象与对象之间的通信交互，代理解除了对象之间的耦合性。</li><li>改变或传递控制链。允许一个类在某些特定时刻通知到其他类，而不需要获取到那些类的指针。可以减少框架复杂度。</li><li>另外一点，代理可以理解为java中的回调监听机制的一种类似。</li><li>代理的属性常是<code>assign</code>的原因：防止循环引用,以至对象无法得到正确的释放。</li></ul><h2><a name='header-c1026' class='md-header-anchor '></a>NSNotification、Block、Delegate和KVO的区别</h2><ul><li>KVO就是cocoa框架实现的观察者模式，一般同KVC搭配使用，通过KVO可以监测一个值的变化，比如View的高度变化。是一对多的关系，一个值的变化会通知所有的观察者。</li></ul><ul><li>NSNotification是通知，也是一对多的使用场景。在某些情况下，KVO和NSNotification是一样的，都是状态变化之后告知对方。NSNotification的特点，就是需要被观察者先主动发出通知，然后观察者注册监听后再来进行响应，比KVO多了发送通知的一步，但是其优点是监听不局限于属性的变化，还可以对多种多样的状态变化进行监听，监听范围广，使用也更灵活。</li><li>delegate 是代理，就是我不想做的事情交给别人做。比如狗需要吃饭，就通过delegate通知主人，主人就会给他做饭、盛饭、倒水，这些操作，这些狗都不需要关心，只需要调用delegate（代理人）就可以了，由其他类完成所需要的操作。所以delegate是一对一关系。</li><li>block是delegate的另一种形式，是函数式编程的一种形式。使用场景跟delegate一样，相比delegate更灵活，而且代理的实现更直观。</li><li>KVO一般的使用场景是数据，需求是数据变化，比如股票价格变化，我们一般使用KVO（观察者模式）。delegate一般的使用场景是行为，需求是需要别人帮我做一件事情，比如买卖股票，我们一般使用delegate。Notification一般是进行全局通知，比如利好消息一出，通知大家去买入。delegate是强关联，就是委托和代理双方互相知道，你委托别人买股票你就需要知道经纪人，经纪人也不要知道自己的顾客。Notification是弱关联，利好消息发出，你不需要知道是谁发的也可以做出相应的反应，同理发消息的人也不需要知道接收的人也可以正常发出消息。</li></ul><h2><a name='header-c1044' class='md-header-anchor '></a>实际应用</h2><ul><li>KVC :字典转模型 给一些只读属性赋值(自定义tabbar)</li><li>KVO:监测进度条 上拉加载下拉刷新contentsize </li><li>NSNotification:监测键盘 切换控制器访客界面登陆界面(Appdelegate)</li></ul><hr /><h1><a name='header-c1056' class='md-header-anchor '></a>UIViewController的完整生命周期</h1><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>[<span class="cm-variable">ViewController</span> <span class="cm-variable">initWithNibName</span>:<span class="cm-variable">bundle</span>:]<span class="cm-variable">；</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>[<span class="cm-variable">ViewController</span> <span class="cm-variable">init</span>]<span class="cm-variable">；</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>[<span class="cm-variable">ViewController</span> <span class="cm-variable">loadView</span>]<span class="cm-variable">；</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>[<span class="cm-variable">ViewController</span> <span class="cm-variable">viewDidLoad</span>]<span class="cm-variable">；</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>[<span class="cm-variable">ViewController</span> <span class="cm-variable">viewWillDisappear</span>:]<span class="cm-variable">；</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>[<span class="cm-variable">ViewController</span> <span class="cm-variable">viewWillAppear</span>:]<span class="cm-variable">；</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>[<span class="cm-variable">ViewController</span> <span class="cm-variable">viewDidAppear</span>:]<span class="cm-variable">；</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>[<span class="cm-variable">ViewController</span> <span class="cm-variable">viewDidDisappear</span>:]<span class="cm-variable">；</span></span></pre></div></div></div></div></div></div></div></pre><p>1、 alloc                                创建对象，分配空间</p><p>2、init(initWithNibName) 初始化对象，初始化数据</p><p>3、loadView                         从nib载入视图 ，通常这一步不需要去干涉。除非你没有使用xib文件创建视图</p><p>4、viewDidLoad                 载入完成，可以进行自定义数据以及动态创建其他控件</p><p>5、viewWillAppear             视图将出现在屏幕之前，马上这个视图就会被展现在屏幕上了</p><p>6、viewDidAppear             视图已在屏幕上渲染完成</p><p>当一个视图被移除屏幕并且销毁的时候的执行顺序，这个顺序差不多和上面的相反</p><p>1、viewWillDisappear           视图将被从屏幕上移除之前执行</p><p>2、viewDidDisappear           视图已经被从屏幕上移除，用户看不到这个视图了</p><p>3、dealloc                               视图被销毁，此处需要对你在init和viewDidLoad中创建的对象进行释放</p><p><strong>ViewController 的 loadView,、viewDidLoad,、viewDidUnload 分别是在什么时候调用的？</strong></p><ul><li><code>viewDidLoad</code>在view从nib文件初始化时调用，<code>loadView</code>在controller的view为nil时调用。</li><li>此方法在编程实现view时调用,view控制器默认会注册<code>memory warning notification</code>,当<code>view controller</code>的任何view没有用的时候，<code>viewDidUnload</code>会被调用，在这里实现将<code>retain</code>的<code>view release</code>,如果是<code>retain</code>的<code>IBOutlet view</code> 属性则不要在这里<code>release</code>,<code>IBOutlet</code>会负责<code>release</code> 。</li></ul><h1><a name='header-c1087' class='md-header-anchor '></a>UIImageView添加圆角</h1><ul><li><p><strong>最直接的方法就是使用如下属性设置</strong>：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">imgView</span>.<span class="cm-variable">layer</span>.<span class="cm-variable">cornerRadius</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>;<span class="cm-comment">// 这一行代码是很消耗性//</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">imgView</span>.<span class="cm-variable">clipsToBounds</span> <span class="cm-operator">=</span> <span class="cm-atom">YES</span>;<span class="cm-comment">//这是离屏渲染（off-screen-rendering），消耗性能的使用到了CPU//</span></span></pre></div></div></div></div></div></div></div></pre></li><li><p><strong>给UIImage添加生成圆角图片的扩展API</strong>：<em>这是on-screen-rendering</em></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-variable">UIImage</span> <span class="cm-operator">*</span>)<span class="cm-variable">imageWithCornerRadius</span>:(<span class="cm-variable">CGFloat</span>)<span class="cm-variable">radius</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CGRect</span> <span class="cm-variable">rect</span> <span class="cm-operator">=</span> (<span class="cm-variable">CGRect</span>){<span class="cm-number">0.f</span>, <span class="cm-number">0.f</span>, <span class="cm-keyword">self</span>.<span class="cm-variable">size</span>};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">UIGraphicsBeginImageContextWithOptions</span>(<span class="cm-keyword">self</span>.<span class="cm-variable">size</span>, <span class="cm-atom">NO</span>, <span class="cm-variable">UIScreen</span>.<span class="cm-variable">mainScreen</span>.<span class="cm-variable">scale</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CGContextAddPath</span>(<span class="cm-variable">UIGraphicsGetCurrentContext</span>(),</span></pre><pre class=""><span style="padding-right: 0.1px;"> [<span class="cm-variable">UIBezierPath</span> <span class="cm-variable">bezierPathWithRoundedRect</span>:<span class="cm-variable">rect</span> <span class="cm-variable">cornerRadius</span>:<span class="cm-variable">radius</span>].<span class="cm-variable">CGPath</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CGContextClip</span>(<span class="cm-variable">UIGraphicsGetCurrentContext</span>());</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">[<span class="cm-keyword">self</span> <span class="cm-variable">drawInRect</span>:<span class="cm-variable">rect</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">UIImage</span> <span class="cm-operator">*</span><span class="cm-variable">image</span> <span class="cm-operator">=</span> <span class="cm-variable">UIGraphicsGetImageFromCurrentImageContext</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">UIGraphicsEndImageContext</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">return</span> <span class="cm-variable">image</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre></li></ul><hr /><p></p><h1><a name='header-c1100' class='md-header-anchor '></a>程序优化</h1><h2><a name='header-c1101' class='md-header-anchor '></a>内存的使用和优化的注意事项</h2><ul><li><p><strong>重用问题</strong>：如UITableViewCells、UICollectionViewCells、UITableViewHeaderFooterViews设置正确的reuseIdentifier，充分重用；</p></li><li><p><strong>尽量把views设置为不透明</strong>：当opque为NO的时候，图层的半透明取决于图片和其本身合成的图层为结果，可提高性能；</p></li><li><p><strong>不要使用太复杂的XIB/Storyboard</strong>：载入时就会将XIB/storyboard需要的所有资源，包括图片全部载入内存，即使未来很久才会使用。那些相比纯代码写的延迟加载，性能及内存就差了很多；</p></li><li><p><strong>选择正确的数据结构</strong>：学会选择对业务场景最合适的数组结构是写出高效代码的基础。比如，数组: 有序的一组值。使用索引来查询很快，使用值查询很慢，插入/删除很慢。字典: 存储键值对，用键来查找比较快。集合: 无序的一组值，用值来查找很快，插入/删除很快。</p><p>gzip/zip压缩：当从服务端下载相关附件时，可以通过gzip/zip压缩后再下载，使得内存更小，下载速度也更快。</p></li><li><p><strong>延迟加载</strong>：对于不应该使用的数据，使用延迟加载方式。对于不需要马上显示的视图，使用延迟加载方式。比如，网络请求失败时显示的提示界面，可能一直都不会使用到，因此应该使用延迟加载。</p></li><li><p><strong>数据缓存</strong>：对于cell的行高要缓存起来，使得reload数据时，效率也极高。而对于那些网络数据，不需要每次都请求的，应该缓存起来，可以写入数据库，也可以通过plist文件存储。</p></li><li><p><strong>处理内存警告</strong>：一般在基类统一处理内存警告，将相关不用资源立即释放掉
重用大开销对象：一些objects的初始化很慢，比如<code>NSDateFormatter</code>和<code>NSCalendar</code>，但又不可避免地需要使用它们。通常是作为属性存储起来，防止反复创建。</p></li><li><p><strong>避免反复处理数据</strong>：许多应用需要从服务器加载功能所需的常为JSON或者XML格式的数据。在服务器端和客户端使用相同的数据结构很重要;</p></li><li><p><strong>使用Autorelease Pool</strong>：在某些循环创建临时变量处理数据时，自动释放池以保证能及时释放内存;</p></li><li><p><strong>正确选择图片加载方式</strong>：详情阅读<a href='http://www.henishuo.com/image-loaded-method/'>细读UIImage加载方式</a></p></li></ul><hr /><h1><a name='header-c1137' class='md-header-anchor '></a>XIB与Storyboards的优缺点</h1><p><strong>优点：</strong></p><ul><li>XIB：在编译前就提供了可视化界面，可以直接拖控件，也可以直接给控件添加约束，更直观一些，而且类文件中就少了创建控件的代码，确实简化不少，通常每个XIB对应一个类。</li><li>Storyboard：在编译前提供了可视化界面，可拖控件，可加约束，在开发时比较直观，而且一个storyboard可以有很多的界面，每个界面对应一个类文件，通过storybard，可以直观地看出整个App的结构。</li></ul><p><strong>缺点：</strong></p><ul><li>XIB：需求变动时，需要修改XIB很大，有时候甚至需要重新添加约束，导致开发周期变长。XIB载入相比纯代码自然要慢一些。对于比较复杂逻辑控制不同状态下显示不同内容时，使用XIB是比较困难的。当多人团队或者多团队开发时，如果XIB文件被发动，极易导致冲突，而且解决冲突相对要困难很多。</li><li>Storyboard：需求变动时，需要修改storyboard上对应的界面的约束，与XIB一样可能要重新添加约束，或者添加约束会造成大量的冲突，尤其是多团队开发。对于复杂逻辑控制不同显示内容时，比较困难。当多人团队或者多团队开发时，大家会同时修改一个storyboard，导致大量冲突，解决起来相当困难。</li></ul><hr /><h1><a name='header-c1157' class='md-header-anchor '></a>iOS的应用生命周期</h1><h2><a name='header-c1158' class='md-header-anchor '></a>应用程序的状态</h2><p><strong>Not running未运行</strong>：程序没启动。
<strong>Inactive未激活</strong>：程序在前台运行，不过没有接收到事件。在没有事件处理情况下程序通常停留在这个状态。
<strong>Active激活</strong>：程序在前台运行而且接收到了事件。这也是前台的一个正常的模式。
<strong>Backgroud后台</strong>：程序在后台而且能执行代码，大多数程序进入这个状态后会在在这个状态上停留一会。时间到之后会进入挂起状态(Suspended)。有的程序经过特殊的请求后可以长期处于Backgroud状态。
<strong>Suspended挂起</strong>：程序在后台不能执行代码。系统会自动把程序变成这个状态而且不会发出通知。当挂起时，程序还是停留在内存中的，当系统内存低时，系统就把挂起的程序清除掉，为前台程序提供更多的内存。</p><p><em>iOS的入口在main.m文件：</em></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">argc</span>, <span class="cm-variable-3">char</span> <span class="cm-operator">*</span><span class="cm-variable">argv</span>[])</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">@autoreleasepool</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">UIApplicationMain</span>(<span class="cm-variable">argc</span>, <span class="cm-variable">argv</span>, <span class="cm-keyword">nil</span>, <span class="cm-variable">NSStringFromClass</span>([<span class="cm-variable">AppDelegate</span> <span class="cm-variable">class</span>]));</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><ul><li>main函数的两个参数，iOS中没有用到，包括这两个参数是为了与标准ANSI C保持一致。 UIApplicationMain函数，前两个和main函数一样，重点是后两个。</li></ul><ul><li>后两个参数分别表示程序的主要类(principal class)和代理类(delegate class)。如果主要类(principal class)为nil，将从Info.plist中获取，如果Info.plist中不存在对应的key，则默认为UIApplication；如果代理类(delegate class)将在新建工程时创建。根据UIApplicationMain函数，程序将进入AppDelegate.m，这个文件是xcode新建工程时自动生成的。下面看一下AppDelegate.m文件，这个关乎着应用程序的生命周期。</li></ul><ol><li><strong>application didFinishLaunchingWithOptions：</strong>当应用程序启动时执行，应用程序启动入口，只在应用程序启动时执行一次。若用户直接启动，lauchOptions内无数据,若通过其他方式启动应用，<strong>lauchOptions</strong>包含对应方式的内容。</li><li><strong>applicationWillResignActive：</strong>在应用程序将要由活动状态切换到非活动状态时候，要执行的委托调用，如 按下 home 按钮，返回主屏幕，或全屏之间切换应用程序等。</li><li><strong>applicationDidEnterBackground：</strong>在应用程序已进入后台程序时，要执行的委托调用。</li><li><strong>applicationWillEnterForeground：</strong>在应用程序将要进入前台时(被激活)，要执行的委托调用，刚好与applicationWillResignActive 方法相对应。</li><li><strong>applicationDidBecomeActive：</strong>在应用程序已被激活后，要执行的委托调用，刚好与applicationDidEnterBackground 方法相对应</li><li><strong>applicationWillTerminate：</strong>在应用程序要完全推出的时候，要执行的委托调用，这个需要要设置UIApplicationExitsOnSuspend的键值。 </li></ol><p><strong>初次启动：</strong>
iOS_didFinishLaunchingWithOptions
iOS_applicationDidBecomeActive
<strong>按下home键：</strong>
iOS_applicationWillResignActive
iOS_applicationDidEnterBackground
<strong>点击程序图标进入：</strong>
iOS_applicationWillEnterForeground
iOS_applicationDidBecomeActive</p><blockquote><p>当应用程序进入后台时,应该保存用户数据或状态信息，所有没写到磁盘的文件或信息，在进入后台时，最后都写到磁盘去，因为程序可能在后台被杀死。释放尽可能释放的内存。</p></blockquote><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-variable-3">void</span>)<span class="cm-variable">applicationDidEnterBackground</span>:(<span class="cm-variable">UIApplication</span> <span class="cm-operator">*</span>)<span class="cm-variable">application</span></span></pre></div></div></div></div></div></div></div></pre><blockquote><p>方法有大概5秒的时间让你完成这些任务。如果超过时间还有未完成的任务，你的程序就会被终止而且从内存中清除。</p><p>如果还需要长时间的运行任务，可以在该方法中调用 </p></blockquote><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;">[<span class="cm-variable">application</span> <span class="cm-variable">beginBackgroundTaskWithExpirationHandler</span>:<span class="cm-variable">^</span>{ </span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"begin Background Task With Expiration Handler"</span>); </span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}];</span></pre></div></div></div></div></div></div></div></pre><p><strong>程序终止</strong></p><p>系统常常是为其他app启动时由于内存不足而回收内存最后需要终止应用程序，但有时也会是由于app很长时间才响应而终止。如果app当时运行在后台并且没有暂停，系统会在应用程序终止之前调用app的代理的方法 - (void)applicationWillTerminate:(UIApplication *)application，这样可以让你可以做一些清理工作。你可以保存一些数据或app的状态。这个方法也有5秒钟的限制。超时后方法会返回程序从内存中清除。</p><p>注意：用户可以手工关闭应用程序。</p><h1><a name='header-c1221' class='md-header-anchor '></a>数据解析</h1><h2><a name='header-c1222' class='md-header-anchor '></a>XML数据解析方式各有什么不同，JSON解析有哪些框架？</h2><ul><li><p>XML数据解析的两种解析方式：DOM解析和SAX解析；</p></li><li><p>DOM解析必须完成DOM树的构造，在处理规模较大的XML文档时就很耗内存，占用资源较多，读入整个XML文档并构建一个驻留内存的树结构（节点树），通过遍历树结构可以检索任意XML节点，读取它的属性和值，通常情况下，可以借助XPath查询XML节点；</p></li><li><p>SAX与DOM不同，它是事件驱动模型，解析XML文档时每遇到一个开始或者结束标签、属性或者一条指令时，程序就产生一个事件进行相应的处理，一边读取XML文档一边处理，不必等整个文档加载完才采取措施，当在读取解析过程中遇到需要处理的对象，会发出通知进行处理。因此，SAX相对于DOM来说更适合操作大的XML文档。</p><p><mark>比喻成吃饭：</mark>
<mark>SAX是要吃一点，就拿一点。</mark>
<mark>DOM 是先把所有的吃的拿过来，然后慢慢吃。</mark></p></li><li><p>JSON解析：性能比较好的主要是第三方的JSONKIT和iOS自带的JSON解析类，其中自带的JSON解析性能最高，但只能用于iOS5之后。</p></li></ul><h1><a name='header-c1240' class='md-header-anchor '></a>iOS 开发中数据持久性有哪几种?</h1><h2><a name='header-c1241' class='md-header-anchor '></a>基本解释</h2><p><mark>数据存储的核心都是写文件</mark>。</p><ul><li><p>属性列表：只有NSString、NSArray、NSDictionary、NSData可writeToFile；存储依旧是plist文件。plist文件可以存储的7中数据类型：array、dictionary、string、bool、data、date、number。</p></li><li><p>对象序列化（对象归档）：对象序列化通过序列化的形式，键值关系存储到本地，转化成二进制流。通过runtime实现自动化归档/解档，请参考<a href='http://www.henishuo.com/runtime-archive-unarchive-automaticly/'>这个文章</a>。实现NSCoding协议必须实现的两个方法：</p><p>1.编码（对象序列化）：把不能直接存储到plist文件中得到数据，转化为二进制数据，NSData，可以存储到本地；
2.解码（对象反序列化）：把二进制数据转化为本来的类型。</p></li><li><p>SQLite 数据库：大量有规律的数据使用数据库。</p></li><li><p>CoreData ：通过管理对象进行增、删、查、改操作的。它不是一个数据库，不仅可以使用SQLite数据库来保持数据，也可以使用其他的方式来存储数据。如：XML。</p></li></ul><h2><a name='header-c1260' class='md-header-anchor '></a>coreData</h2><h3><a name='header-c1261' class='md-header-anchor '></a>CoreData的介绍：</h3><ul><li>CoreData是面向对象的API，CoreData是iOS中非常重要的一项技术，几乎在所有编写的程序中，CoreData都作为数据存储的基础。</li><li>CoreData是苹果官方提供的一套框架，用来解决与对象声明周期管理、对象关系管理和持久化等方面相关的问题。</li><li>大多数情况下，我们引用CoreData作为持久化数据的解决方案，并利用它作为持久化数据映射为内存对象。提供的是对象-关系映射功能，也就是说，CoreData可以将Objective-C对象转换成数据，保存到SQL中，然后将保存后的数据还原成OC对象。</li></ul><h3><a name='header-c1272' class='md-header-anchor '></a>CoreData的特征：</h3><ul><li>通过CoreData管理应用程序的数据模型，可以极大程度减少需要编写的代码数量。</li><li>将对象数据存储在SQLite数据库已获得性能优化。</li><li>提供NSFetchResultsController类用于管理表视图的数据，即将Core Data的持久化存储在表视图中，并对这些数据进行管理：增删查改。</li><li>管理undo/redo操纵；</li><li>检查托管对象的属性值是否正确。</li></ul><h3><a name='header-c1289' class='md-header-anchor '></a>Core Data的6成员对象</h3><ul><li>1.<strong>NSManageObject</strong>:被管理的数据记录Managed Object Model是描述应用程序的数据模型，这个模型包含实体（Entity）、特性（Property）、读取请求（Fetch Request）等。</li><li>2.<strong>NSManageObjectContext</strong>：管理对象上下文，持久性存储模型对象，参与数据对象进行各种操作的全过程，并监测数据对象的变化，以提供对undo/redo的支持及更新绑定到数据的UI。</li><li>3.<strong>NSPersistentStoreCoordinator</strong>:连接数据库的Persistent Store Coordinator相当于数据文件管理器，处理底层的对数据文件的读取和写入，一般我们与这个没有交集。</li><li>4.<strong>NSManagedObjectModel</strong>：被管理的数据模型、数据结构。</li><li>5.<strong>NSFetchRequest</strong>：数据请求；</li><li>6.<strong>NSEntityDescription</strong>：表格实体结构，还需知道.xcdatamodel文件编译后为.momd或者.mom文件。</li></ul><h3><a name='header-c1309' class='md-header-anchor '></a>Core Data的功能</h3><ul><li>对于KVC和KVO完整且自动化的支持，除了为属性整合KVO和KVC访问方法外，还整合了适当的集合访问方法来处理多值关系；</li><li>自动验证属性（property）值；</li><li>支持跟踪修改和撤销操作；</li><li>关系维护，Core Data管理数据的关系传播，包括维护对象间的一致性；</li><li>在内存上和界面上分组、过滤、组织数据；</li><li>自动支持对象存储在外部数据仓库的功能；</li><li>创建复杂请求：无需动手写SQL语句，在获取请求（fetch request）中关联NSPredicate。NSPreadicate支持基本功能、相关子查询和其他高级的SQL特性。它支持正确的Unicode编码、区域感知查询、排序和正则表达式；</li><li>延迟操作：Core Data使用<a href='http://www.cnblogs.com/wendingding/p/3742555.html'>懒加载（lazy loading）</a>方式减少内存负载，还支持部分实体化延迟加载和复制对象的数据共享机制；</li><li>合并策略：Core Data内置版本跟踪和乐观锁（optimistic locking）来支持多用户写入冲突的解决，其中，乐观锁就是对数据冲突进行检测，若冲突就返回冲突的信息；</li><li>数据迁移：Core Data的Schema Migration工具可以简化应对数据库结构变化的任务，在某些情况允许你执行高效率的数据库原地迁移工作；</li><li>可选择针对程序Controller层的集成，来支持UI的显示同步Core Data在IPhone OS之上，提供NSFetchedResultsController对象来做相关工作，在Mac OS X上我们用Cocoa提供的绑定（Binding）机制来完成的。</li></ul><h2><a name='header-c1344' class='md-header-anchor '></a>FMDB</h2><h3><a name='header-c1345' class='md-header-anchor '></a>使用框架</h3><h3><a name='header-c1346' class='md-header-anchor '></a>官网地址</h3><p><a href='https://github.com/ccgus/fmdb' target='_blank' >https://github.com/ccgus/fmdb</a></p><h3><a name='header-c1349' class='md-header-anchor '></a>直接拖拽</h3><ul><li>将 fmdb 文件夹拖入项目</li><li>建立桥接文件</li><li>将 <code>Swift extensions</code> 拖入项目</li><li>添加 <code>libsqlite3.tdb</code></li></ul><h3><a name='header-c1363' class='md-header-anchor '></a>Podfile</h3><ul><li>不推荐</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">use_frameworks!</span></pre><pre class=""><span style="padding-right: 0.1px;">pod <span class="cm-string">'FMDB'</span>, :git <span class="cm-operator">=</span>&gt; <span class="cm-string">'https://github.com/robertmryan/fmdb.git'</span></span></pre></div></div></div></div></div></div></div></pre><p><mark>代码演练</mark></p><h3><a name='header-c1371' class='md-header-anchor '></a>单例</h3><ul><li>单例代码</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/// 数据库名称</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">private</span> <span class="cm-keyword">let</span> <span class="cm-def">dbName</span> <span class="cm-operator">=</span> <span class="cm-string">"readme.db"</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/// 数据库管理工具</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-variable">SQLiteManager</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">static</span> <span class="cm-keyword">let</span> <span class="cm-def">sharedManager</span> <span class="cm-operator">=</span> <span class="cm-variable">SQLiteManager</span><span class="cm-punctuation">()</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 全局数据库队列 - 支持线程操作</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">queue</span>: <span class="cm-variable">FMDatabaseQueue</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">private</span> <span class="cm-keyword">init</span><span class="cm-punctuation">()</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">path</span> <span class="cm-operator">=</span> <span class="cm-variable">NSSearchPathForDirectoriesInDomains</span><span class="cm-punctuation">(.</span><span class="cm-variable">DocumentDirectory</span><span class="cm-punctuation">,</span> <span class="cm-punctuation">.</span><span class="cm-variable">UserDomainMask</span><span class="cm-punctuation">,</span> <span class="cm-atom">true</span><span class="cm-punctuation">).</span><span class="cm-variable">last</span>!</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">path</span> <span class="cm-operator">=</span> <span class="cm-punctuation">(</span><span class="cm-variable">path</span> <span class="cm-keyword">as</span> <span class="cm-variable">NSString</span><span class="cm-punctuation">).</span><span class="cm-variable">stringByAppendingPathComponent</span><span class="cm-punctuation">(</span><span class="cm-variable">dbName</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-variable">path</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">queue</span> <span class="cm-operator">=</span> <span class="cm-variable">FMDatabaseQueue</span><span class="cm-punctuation">(</span><span class="cm-variable">path</span>: <span class="cm-variable">path</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">createTable</span><span class="cm-punctuation">()</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/// 创建数据表</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">private</span> <span class="cm-keyword">func</span> <span class="cm-variable">createTable</span><span class="cm-punctuation">()</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">path</span> <span class="cm-operator">=</span> <span class="cm-variable">NSBundle</span><span class="cm-punctuation">.</span><span class="cm-variable">mainBundle</span><span class="cm-punctuation">().</span><span class="cm-variable">pathForResource</span><span class="cm-punctuation">(</span><span class="cm-string">"db.sql"</span><span class="cm-punctuation">,</span> <span class="cm-variable">ofType</span>: <span class="cm-atom">nil</span><span class="cm-punctuation">)</span>!</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">sql</span> <span class="cm-operator">=</span> <span class="cm-variable">try</span>! <span class="cm-variable">String</span><span class="cm-punctuation">(</span><span class="cm-variable">contentsOfFile</span>: <span class="cm-variable">path</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">queue</span><span class="cm-punctuation">.</span><span class="cm-variable">inTransaction</span> { <span class="cm-punctuation">(</span><span class="cm-variable">db</span><span class="cm-punctuation">,</span> <span class="cm-punctuation">_)</span> <span class="cm-keyword">in</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> <span class="cm-variable">db</span><span class="cm-punctuation">.</span><span class="cm-variable">executeStatements</span><span class="cm-punctuation">(</span><span class="cm-variable">sql</span><span class="cm-punctuation">)</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-string">"创表成功"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-string">"创表失败"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><h3><a name='header-c1377' class='md-header-anchor '></a>代码小结</h3><ul><li><p>将数据库名称定义成常量，可以避免在 <code>AppDelegate</code> 中打开数据库</p></li><li><p><code>init</code> 创建队列并指定路径</p><ul><li>如果数据库不存在，会建立数据库，然后打开</li><li>如果数据库已经存在，会直接打开</li></ul></li><li><p>创表函数，可以把所有数据表的 SQL 保存在 <code>db.sql</code> 中，直接通过 <code>executeStatements</code> 一次性将所有数据表建立</p></li><li><p><code>queue</code> 是 FMDB 提供的一个核心类，封装了一个串行队列，能够实现多线程数据操作，而且是线程安全的</p></li></ul><h3><a name='header-c1398' class='md-header-anchor '></a>插入数据</h3><ul><li>传统方法</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">func</span> <span class="cm-variable">demoInsert1</span><span class="cm-punctuation">()</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// 模拟 SQL 注入</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">name</span> <span class="cm-operator">=</span> <span class="cm-string">"王五"</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">sql</span> <span class="cm-operator">=</span> <span class="cm-string">"INSERT</span> <span class="cm-string">INTO</span> <span class="cm-string">T_Person</span> <span class="cm-string">(name,</span> <span class="cm-string">age,</span> <span class="cm-string">height)</span> <span class="cm-string">VALUES</span> <span class="cm-string">('</span><span class="cm-punctuation">\(</span><span class="cm-variable">name</span><span class="cm-punctuation">)</span><span class="cm-string">',</span> <span class="cm-string">18,</span> <span class="cm-string">1.8);"</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-variable">sql</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">SQLiteManager</span><span class="cm-punctuation">.</span><span class="cm-variable">sharedManager</span><span class="cm-punctuation">.</span><span class="cm-variable">queue</span><span class="cm-punctuation">.</span><span class="cm-variable">inDatabase</span> { <span class="cm-punctuation">(</span><span class="cm-variable">db</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">Void</span> <span class="cm-keyword">in</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> <span class="cm-variable">db</span><span class="cm-punctuation">.</span><span class="cm-variable">executeStatements</span><span class="cm-punctuation">(</span><span class="cm-variable">sql</span><span class="cm-punctuation">)</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-string">"插入成功"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><blockquote><p>存在的问题：SQL 注入</p></blockquote><ul><li>修改 name 数值，演示 SQL 注入</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">let</span> <span class="cm-def">name</span> <span class="cm-operator">=</span> <span class="cm-string">"王五'</span><span class="cm-punctuation">,</span> <span class="cm-number">18</span><span class="cm-punctuation">,</span> <span class="cm-number">1</span><span class="cm-punctuation">.</span><span class="cm-number">8</span><span class="cm-punctuation">);</span> <span class="cm-variable">DELETE</span> <span class="cm-variable">FROM</span> <span class="cm-variable">T_Person</span><span class="cm-punctuation">;</span> <span class="cm-operator">--</span><span class="cm-string">"</span></span></pre></div></div></div></div></div></div></div></pre><ul><li>使用预编译指令插入数据 - 绑定参数</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">func</span> <span class="cm-variable">demoInsert2</span><span class="cm-punctuation">()</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">sql</span> <span class="cm-operator">=</span> <span class="cm-string">"INSERT</span> <span class="cm-string">INTO</span> <span class="cm-string">T_Person</span> <span class="cm-string">(name,</span> <span class="cm-string">age,</span> <span class="cm-string">height)</span> <span class="cm-string">VALUES</span> <span class="cm-string">(?,</span> <span class="cm-string">?,</span> <span class="cm-string">?);"</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">SQLiteManager</span><span class="cm-punctuation">.</span><span class="cm-variable">sharedManager</span><span class="cm-punctuation">.</span><span class="cm-variable">queue</span><span class="cm-punctuation">.</span><span class="cm-variable">inDatabase</span> { <span class="cm-punctuation">(</span><span class="cm-variable">db</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">Void</span> <span class="cm-keyword">in</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> <span class="cm-variable">db</span><span class="cm-punctuation">.</span><span class="cm-variable">executeUpdate</span><span class="cm-punctuation">(</span><span class="cm-variable">sql</span><span class="cm-punctuation">,</span> <span class="cm-string">"张三1"</span><span class="cm-punctuation">,</span> <span class="cm-number">18</span><span class="cm-punctuation">,</span> <span class="cm-number">1</span><span class="cm-punctuation">.</span><span class="cm-number">7</span><span class="cm-punctuation">)</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-string">"插入成功</span> <span class="cm-keyword">\</span>(<span class="cm-variable">db</span><span class="cm-punctuation">.</span><span class="cm-variable">lastInsertRowId</span>())<span class="cm-string">"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-string">"插入失败"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><ul><li>使用字典更新 SQL － FMDB 特有语法</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">func</span> <span class="cm-variable">demoInsert3</span><span class="cm-punctuation">(</span><span class="cm-variable">dict</span>: <span class="cm-operator">[</span><span class="cm-variable">String</span>: <span class="cm-variable">AnyObject</span><span class="cm-operator">]</span><span class="cm-punctuation">)</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">sql</span> <span class="cm-operator">=</span> <span class="cm-string">"INSERT</span> <span class="cm-string">INTO</span> <span class="cm-string">T_Person</span> <span class="cm-string">(name,</span> <span class="cm-string">age,</span> <span class="cm-string">height)</span> <span class="cm-string">VALUES</span> <span class="cm-string">(:name,</span> <span class="cm-string">:age,</span> <span class="cm-string">:height);"</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">SQLiteManager</span><span class="cm-punctuation">.</span><span class="cm-variable">sharedManager</span><span class="cm-punctuation">.</span><span class="cm-variable">queue</span><span class="cm-punctuation">.</span><span class="cm-variable">inDatabase</span> { <span class="cm-punctuation">(</span><span class="cm-variable">db</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">Void</span> <span class="cm-keyword">in</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> <span class="cm-variable">db</span><span class="cm-punctuation">.</span><span class="cm-variable">executeUpdate</span><span class="cm-punctuation">(</span><span class="cm-variable">sql</span><span class="cm-punctuation">,</span> <span class="cm-variable">withParameterDictionary</span>: <span class="cm-variable">dict</span><span class="cm-punctuation">)</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-string">"插入成功</span> <span class="cm-keyword">\</span>(<span class="cm-variable">db</span><span class="cm-punctuation">.</span><span class="cm-variable">lastInsertRowId</span>())<span class="cm-string">"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-string">"插入失败"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div></div></div></pre><h3><a name='header-c1422' class='md-header-anchor '></a>删除数据</h3><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">func</span> <span class="cm-variable">demoDelete</span><span class="cm-punctuation">(</span><span class="cm-variable">id</span>: <span class="cm-variable">Int</span><span class="cm-punctuation">)</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">sql</span> <span class="cm-operator">=</span> <span class="cm-string">"DELETE</span> <span class="cm-string">FROM</span> <span class="cm-string">T_Person</span> <span class="cm-string">WHERE</span> <span class="cm-string">id</span> <span class="cm-string">=</span> <span class="cm-string">?;"</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">SQLiteManager</span><span class="cm-punctuation">.</span><span class="cm-variable">sharedManager</span><span class="cm-punctuation">.</span><span class="cm-variable">queue</span><span class="cm-punctuation">.</span><span class="cm-variable">inDatabase</span> { <span class="cm-punctuation">(</span><span class="cm-variable">db</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">Void</span> <span class="cm-keyword">in</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> <span class="cm-variable">db</span><span class="cm-punctuation">.</span><span class="cm-variable">executeUpdate</span><span class="cm-punctuation">(</span><span class="cm-variable">sql</span><span class="cm-punctuation">,</span> <span class="cm-variable">id</span><span class="cm-punctuation">)</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-string">"删除成功</span> <span class="cm-keyword">\</span>(<span class="cm-variable">db</span><span class="cm-punctuation">.</span><span class="cm-variable">changes</span>())<span class="cm-string">"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-string">"删除失败"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><h3><a name='header-c1424' class='md-header-anchor '></a>更新数据</h3><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">func</span> <span class="cm-variable">demoUpdate</span><span class="cm-punctuation">(</span><span class="cm-variable">dict</span>: <span class="cm-operator">[</span><span class="cm-variable">String</span>: <span class="cm-variable">AnyObject</span><span class="cm-operator">]</span><span class="cm-punctuation">)</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">sql</span> <span class="cm-operator">=</span> <span class="cm-string">"UPDATE</span> <span class="cm-string">T_Person</span> <span class="cm-string">set</span> <span class="cm-string">name</span> <span class="cm-string">=</span> <span class="cm-string">:name,</span> <span class="cm-string">age</span> <span class="cm-string">=</span> <span class="cm-string">:age,</span> <span class="cm-string">height</span> <span class="cm-string">=</span> <span class="cm-string">:height</span> <span class="cm-string">WHERE</span> <span class="cm-string">id</span> <span class="cm-string">=</span> <span class="cm-string">:id;"</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">SQLiteManager</span><span class="cm-punctuation">.</span><span class="cm-variable">sharedManager</span><span class="cm-punctuation">.</span><span class="cm-variable">queue</span><span class="cm-punctuation">.</span><span class="cm-variable">inDatabase</span> { <span class="cm-punctuation">(</span><span class="cm-variable">db</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">Void</span> <span class="cm-keyword">in</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> <span class="cm-variable">db</span><span class="cm-punctuation">.</span><span class="cm-variable">executeUpdate</span><span class="cm-punctuation">(</span><span class="cm-variable">sql</span><span class="cm-punctuation">,</span> <span class="cm-variable">withParameterDictionary</span>: <span class="cm-variable">dict</span><span class="cm-punctuation">)</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-string">"更新成功</span> <span class="cm-keyword">\</span>(<span class="cm-variable">db</span><span class="cm-punctuation">.</span><span class="cm-variable">changes</span>())<span class="cm-string">"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-string">"更新失败"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><h3><a name='header-c1426' class='md-header-anchor '></a>查询数据</h3><ul><li>固定 SQL 的查询方式</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">func</span> <span class="cm-variable">persons1</span><span class="cm-punctuation">()</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">sql</span> <span class="cm-operator">=</span> <span class="cm-string">"SELECT</span> <span class="cm-string">id,</span> <span class="cm-string">name,</span> <span class="cm-string">age,</span> <span class="cm-string">height</span> <span class="cm-string">FROM</span> <span class="cm-string">T_Person;"</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">SQLiteManager</span><span class="cm-punctuation">.</span><span class="cm-variable">sharedManager</span><span class="cm-punctuation">.</span><span class="cm-variable">queue</span><span class="cm-punctuation">.</span><span class="cm-variable">inDatabase</span> { <span class="cm-punctuation">(</span><span class="cm-variable">db</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">Void</span> <span class="cm-keyword">in</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">guard</span> <span class="cm-keyword">let</span> <span class="cm-def">rs</span> <span class="cm-operator">=</span> <span class="cm-variable">db</span><span class="cm-punctuation">.</span><span class="cm-variable">executeQuery</span><span class="cm-punctuation">(</span><span class="cm-variable">sql</span><span class="cm-punctuation">)</span> <span class="cm-keyword">else</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">return</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">while</span> <span class="cm-variable">rs</span><span class="cm-punctuation">.</span><span class="cm-variable">next</span><span class="cm-punctuation">()</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">id</span> <span class="cm-operator">=</span> <span class="cm-variable">rs</span><span class="cm-punctuation">.</span><span class="cm-variable">intForColumn</span><span class="cm-punctuation">(</span><span class="cm-string">"id"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">name</span> <span class="cm-operator">=</span> <span class="cm-variable">rs</span><span class="cm-punctuation">.</span><span class="cm-variable">stringForColumn</span><span class="cm-punctuation">(</span><span class="cm-string">"name"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">age</span> <span class="cm-operator">=</span> <span class="cm-variable">rs</span><span class="cm-punctuation">.</span><span class="cm-variable">stringForColumn</span><span class="cm-punctuation">(</span><span class="cm-string">"age"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">height</span> <span class="cm-operator">=</span> <span class="cm-variable">rs</span><span class="cm-punctuation">.</span><span class="cm-variable">doubleForColumn</span><span class="cm-punctuation">(</span><span class="cm-string">"height"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-string">"</span><span class="cm-keyword">\</span>(<span class="cm-variable">id</span>) <span class="cm-keyword">\</span>(<span class="cm-variable">name</span>) <span class="cm-keyword">\</span>(<span class="cm-variable">age</span>) <span class="cm-keyword">\</span>(<span class="cm-variable">height</span>)<span class="cm-string">"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><ul><li>动态 SQL 的查询方式</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">func</span> <span class="cm-variable">persons2</span><span class="cm-punctuation">()</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">sql</span> <span class="cm-operator">=</span> <span class="cm-string">"SELECT</span> <span class="cm-string">id,</span> <span class="cm-string">name,</span> <span class="cm-string">age,</span> <span class="cm-string">height</span> <span class="cm-string">FROM</span> <span class="cm-string">T_Person;"</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">result</span> <span class="cm-operator">=</span> <span class="cm-operator">[[</span><span class="cm-variable">String</span>: <span class="cm-variable">AnyObject</span><span class="cm-operator">]]</span><span class="cm-punctuation">()</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">SQLiteManager</span><span class="cm-punctuation">.</span><span class="cm-variable">sharedManager</span><span class="cm-punctuation">.</span><span class="cm-variable">queue</span><span class="cm-punctuation">.</span><span class="cm-variable">inDatabase</span> { <span class="cm-punctuation">(</span><span class="cm-variable">db</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">Void</span> <span class="cm-keyword">in</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-variable">NSThread</span><span class="cm-punctuation">.</span><span class="cm-variable">currentThread</span><span class="cm-punctuation">())</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">guard</span> <span class="cm-keyword">let</span> <span class="cm-def">rs</span> <span class="cm-operator">=</span> <span class="cm-variable">db</span><span class="cm-punctuation">.</span><span class="cm-variable">executeQuery</span><span class="cm-punctuation">(</span><span class="cm-variable">sql</span><span class="cm-punctuation">)</span> <span class="cm-keyword">else</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">return</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">while</span> <span class="cm-variable">rs</span><span class="cm-punctuation">.</span><span class="cm-variable">next</span><span class="cm-punctuation">()</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// 0. 字典</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">dict</span> <span class="cm-operator">=</span> <span class="cm-operator">[</span><span class="cm-variable">String</span>: <span class="cm-variable">AnyObject</span><span class="cm-operator">]</span><span class="cm-punctuation">()</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// 1. 列数</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">colCount</span> <span class="cm-operator">=</span> <span class="cm-variable">rs</span><span class="cm-punctuation">.</span><span class="cm-variable">columnCount</span><span class="cm-punctuation">()</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">for</span> <span class="cm-variable">col</span> <span class="cm-keyword">in</span> <span class="cm-number">0</span><span class="cm-punctuation">..</span><span class="cm-operator">&lt;</span><span class="cm-variable">colCount</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// 2. 列名</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">colName</span> <span class="cm-operator">=</span> <span class="cm-variable">rs</span><span class="cm-punctuation">.</span><span class="cm-variable">columnNameForIndex</span><span class="cm-punctuation">(</span><span class="cm-variable">col</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// 3. 值</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">dict</span><span class="cm-operator">[</span><span class="cm-variable">colName</span><span class="cm-operator">]</span> <span class="cm-operator">=</span> <span class="cm-variable">rs</span><span class="cm-punctuation">.</span><span class="cm-variable">objectForColumnIndex</span><span class="cm-punctuation">(</span><span class="cm-variable">col</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">result</span><span class="cm-punctuation">.</span><span class="cm-variable">append</span><span class="cm-punctuation">(</span><span class="cm-variable">dict</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-variable">result</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><ul><li>在 <code>SQLiteManager</code> 中封装查询方法</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/// 执行 SQL 返回结果集合</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">///</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/// - parameter sql: sql</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">func</span> <span class="cm-variable">execRecordset</span><span class="cm-punctuation">(</span><span class="cm-variable">sql</span>: <span class="cm-variable">String</span><span class="cm-punctuation">,</span> <span class="cm-variable">finished</span>: <span class="cm-punctuation">(</span><span class="cm-operator">[[</span><span class="cm-variable">String</span>: <span class="cm-variable">AnyObject</span><span class="cm-operator">]]</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-punctuation">())</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">dispatch_async</span><span class="cm-punctuation">(</span><span class="cm-variable">dispatch_get_global_queue</span><span class="cm-punctuation">(</span><span class="cm-number">0</span><span class="cm-punctuation">,</span> <span class="cm-number">0</span><span class="cm-punctuation">))</span> { <span class="cm-punctuation">()</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">Void</span> <span class="cm-keyword">in</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">result</span> <span class="cm-operator">=</span> <span class="cm-operator">[[</span><span class="cm-variable">String</span>: <span class="cm-variable">AnyObject</span><span class="cm-operator">]]</span><span class="cm-punctuation">()</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">self</span><span class="cm-punctuation">.</span><span class="cm-variable">queue</span><span class="cm-punctuation">.</span><span class="cm-variable">inDatabase</span> { <span class="cm-punctuation">(</span><span class="cm-variable">db</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">Void</span> <span class="cm-keyword">in</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">guard</span> <span class="cm-keyword">let</span> <span class="cm-def">rs</span> <span class="cm-operator">=</span> <span class="cm-variable">db</span><span class="cm-punctuation">.</span><span class="cm-variable">executeQuery</span><span class="cm-punctuation">(</span><span class="cm-variable">sql</span><span class="cm-punctuation">)</span> <span class="cm-keyword">else</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">dispatch_async</span><span class="cm-punctuation">(</span><span class="cm-variable">dispatch_get_main_queue</span><span class="cm-punctuation">())</span> { <span class="cm-variable">finished</span><span class="cm-punctuation">(</span><span class="cm-variable">result</span><span class="cm-punctuation">)</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">return</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">while</span> <span class="cm-variable">rs</span><span class="cm-punctuation">.</span><span class="cm-variable">next</span><span class="cm-punctuation">()</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// 0. 字典</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">var</span> <span class="cm-def">dict</span> <span class="cm-operator">=</span> <span class="cm-operator">[</span><span class="cm-variable">String</span>: <span class="cm-variable">AnyObject</span><span class="cm-operator">]</span><span class="cm-punctuation">()</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// 1. 列数</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">colCount</span> <span class="cm-operator">=</span> <span class="cm-variable">rs</span><span class="cm-punctuation">.</span><span class="cm-variable">columnCount</span><span class="cm-punctuation">()</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">for</span> <span class="cm-variable">col</span> <span class="cm-keyword">in</span> <span class="cm-number">0</span><span class="cm-punctuation">..</span><span class="cm-operator">&lt;</span><span class="cm-variable">colCount</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// 2. 列名</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">colName</span> <span class="cm-operator">=</span> <span class="cm-variable">rs</span><span class="cm-punctuation">.</span><span class="cm-variable">columnNameForIndex</span><span class="cm-punctuation">(</span><span class="cm-variable">col</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// 3. 值</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">dict</span><span class="cm-operator">[</span><span class="cm-variable">colName</span><span class="cm-operator">]</span> <span class="cm-operator">=</span> <span class="cm-variable">rs</span><span class="cm-punctuation">.</span><span class="cm-variable">objectForColumnIndex</span><span class="cm-punctuation">(</span><span class="cm-variable">col</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">result</span><span class="cm-punctuation">.</span><span class="cm-variable">append</span><span class="cm-punctuation">(</span><span class="cm-variable">dict</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">dispatch_async</span><span class="cm-punctuation">(</span><span class="cm-variable">dispatch_get_main_queue</span><span class="cm-punctuation">())</span> { <span class="cm-variable">finished</span><span class="cm-punctuation">(</span><span class="cm-variable">result</span><span class="cm-punctuation">)</span> }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><h3><a name='header-c1442' class='md-header-anchor '></a>批量插入数据</h3><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">func</span> <span class="cm-variable">manyPersons</span><span class="cm-punctuation">()</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">sql</span> <span class="cm-operator">=</span> <span class="cm-string">"INSERT</span> <span class="cm-string">INTO</span> <span class="cm-string">T_Person</span> <span class="cm-string">(name,</span> <span class="cm-string">age,</span> <span class="cm-string">height)</span> <span class="cm-string">VALUES</span> <span class="cm-string">(:name,</span> <span class="cm-string">:age,</span> <span class="cm-string">:height);"</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">start</span> <span class="cm-operator">=</span> <span class="cm-variable">CACurrentMediaTime</span><span class="cm-punctuation">()</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">print</span><span class="cm-punctuation">(</span><span class="cm-string">"开始"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">SQLiteManager</span><span class="cm-punctuation">.</span><span class="cm-variable">sharedManager</span><span class="cm-punctuation">.</span><span class="cm-variable">queue</span><span class="cm-punctuation">.</span><span class="cm-variable">inTransaction</span> { <span class="cm-punctuation">(</span><span class="cm-variable">db</span><span class="cm-punctuation">,</span> <span class="cm-variable">rollback</span><span class="cm-punctuation">)</span> <span class="cm-operator">-&gt;</span> <span class="cm-variable">Void</span> <span class="cm-keyword">in</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">for</span> i <span class="cm-keyword">in</span> <span class="cm-number">0</span><span class="cm-punctuation">..</span><span class="cm-operator">&lt;</span><span class="cm-number">10000</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">age</span> <span class="cm-operator">=</span> <span class="cm-number">10</span> <span class="cm-operator">+</span> <span class="cm-variable">random</span><span class="cm-punctuation">()</span> <span class="cm-operator">%</span> <span class="cm-number">10</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">height</span> <span class="cm-operator">=</span> <span class="cm-number">1</span><span class="cm-punctuation">.</span><span class="cm-number">5</span> <span class="cm-operator">+</span> <span class="cm-variable">Double</span><span class="cm-punctuation">(</span><span class="cm-variable">random</span><span class="cm-punctuation">()</span> <span class="cm-operator">%</span> <span class="cm-number">5</span><span class="cm-punctuation">)</span> <span class="cm-operator">/</span> <span class="cm-number">10</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">let</span> <span class="cm-def">dict</span> <span class="cm-operator">=</span> <span class="cm-operator">[</span><span class="cm-string">"name"</span>: <span class="cm-string">"zhangsan</span> <span class="cm-string">-</span> <span class="cm-keyword">\</span>(<span class="cm-punctuation">i)</span><span class="cm-string">",</span> <span class="cm-string">"</span><span class="cm-variable">age</span><span class="cm-string">":</span> <span class="cm-string">age,</span> <span class="cm-string">"</span><span class="cm-variable">height</span><span class="cm-string">":</span> <span class="cm-string">height]</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-string">if</span> <span class="cm-string">!db.executeUpdate(sql,</span> <span class="cm-string">withParameterDictionary:</span> <span class="cm-string">dict</span> <span class="cm-string">as</span> <span class="cm-string">[NSObject</span> <span class="cm-string">:</span> <span class="cm-string">AnyObject])</span> <span class="cm-string">{</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-string">rollback.memory</span> <span class="cm-string">=</span> <span class="cm-string">true</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-string">break</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-string">}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-string">//</span> <span class="cm-string">模拟失败</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-string">if</span> <span class="cm-string">i</span> <span class="cm-string">==</span> <span class="cm-string">1000</span> <span class="cm-string">{</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-string">rollback.memory</span> <span class="cm-string">=</span> <span class="cm-string">true</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-string">break</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-string">}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-string">}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-string">}</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-string">print("</span>完成 <span class="cm-punctuation">\(</span><span class="cm-variable">CACurrentMediaTime</span>() <span class="cm-operator">-</span> <span class="cm-variable">start</span>)<span class="cm-string">"</span><span class="cm-punctuation">)</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><h3><a name='header-c1444' class='md-header-anchor '></a>FMDB 主要函数</h3><ul><li>执行单条语句 <code>executeUpdate</code></li><li>查询 <code>executeQuery</code></li><li>执行多条语句 <code>executeStatements</code>，创表时使用</li></ul><blockquote><p>要设置 rollBack 可以使用 <code>rollBack.memory = true</code></p></blockquote><hr /><h3><a name='header-c1459' class='md-header-anchor '></a>网络七层协议</h3><ul><li><p><strong>应用层</strong>：
1.用户接口、应用程序；
2.Application典型设备：网关；
3.典型协议、标准和应用：TELNET、FTP、HTTP</p></li><li><p><strong>表示层</strong>：</p><p>1.数据表示、压缩和加密presentation
2.典型设备：网关
3.典型协议、标准和应用：ASCLL、PICT、TIFF、JPEG|MPEG
4.表示层相当于一个东西的表示，表示的一些协议，比如图片、声音和视频MPEG。</p></li><li><p><strong>会话层</strong>：
1.会话的建立和结束；
2.典型设备：网关；
3.典型协议、标准和应用：RPC、SQL、NFS、X WINDOWS、ASP</p></li><li><p><strong>传输层</strong>：
1.主要功能：端到端控制Transport；
2.典型设备：网关；
3.典型协议、标准和应用：TCP、UDP、SPX</p></li><li><p><strong>网络层</strong>：
1.主要功能：路由、寻址Network；
2.典型设备：路由器；
3.典型协议、标准和应用：IP、IPX、APPLETALK、ICMP；</p></li><li><p><strong>数据链路层</strong>：
1.主要功能：保证无差错的疏忽链路的data link；
2.典型设备：交换机、网桥、网卡；
3.典型协议、标准和应用：802.2、802.3ATM、HDLC、FRAME RELAY；</p></li><li><p><strong>物理层</strong>：
1.主要功能：传输比特流Physical；
2.典型设备：集线器、中继器
3.典型协议、标准和应用：V.35、EIA/TIA-232.</p></li></ul><hr /><h1><a name='header-c1506' class='md-header-anchor '></a>NSObject的load和initialize方法</h1><h2><a name='header-c1507' class='md-header-anchor '></a>load和initialize的共同特点</h2><blockquote><p>在不考虑开发者主动使用的情况下，系统最多会调用一次</p><p>如果父类和子类都被调用，父类的调用一定在子类之前</p><p>都是为了应用运行提前创建合适的运行环境</p><p>在使用时都不要过重地依赖于这两个方法，除非真正必要</p></blockquote><h2><a name='header-c1517' class='md-header-anchor '></a>load和initialize的区别</h2><p><strong>load方法</strong></p><ul><li>调用时机比较早，运行环境有不确定因素。具体说来，在iOS上通常就是App启动时进行加载，但当load调用的时候，并不能保证所有类都加载完成且可用，必要时还要自己负责做auto release处理。对于有依赖关系的两个库中，被依赖的类的load会优先调用。但在一个库之内，调用顺序是不确定的。</li><li>对于一个类而言，没有load方法实现就不会调用，不会考虑对NSObject的继承。</li><li>一个类的load方法不用写明[super load]，父类就会收到调用，并且在子类之前。</li><li>Category的load也会收到调用，但顺序上在主类的load调用之后。</li><li>不会直接触发initialize的调用。</li></ul><p><strong>initialize方法相关要点</strong></p><ul><li>initialize的自然调用是在第一次主动使用当前类的时候。</li><li>在initialize方法收到调用时，运行环境基本健全。</li><li>initialize的运行过程中是能保证线程安全的。</li><li>和load不同，即使子类不实现initialize方法，会把父类的实现继承过来调用一遍。注意的是在此之前，父类的方法已经被执行过一次了，同样不需要super调用。</li><li>由于initialize的这些特点，使得其应用比load要略微广泛一些。可用来做一些初始化工作，或者单例模式的一种实现方案。</li></ul><hr /><h1><a name='header-c1555' class='md-header-anchor '></a>支付宝SDK使用</h1><blockquote><p>使用支付宝进行一个完整的支付功能，大致有以下步骤：向支付宝申请, 与支付宝签约，获得商户ID（partner）和账号ID（seller）和私钥(privateKey)。下载支付宝SDK，生成订单信息,签名加密调用支付宝客户端，由支付宝客户端跟支付宝安全服务器打交道。支付完毕后,支付宝客户端会自动跳回到原来的应用程序，在原来的应用程序中显示支付结果给用户看。</p></blockquote><p><strong>集成之后可能遇到的问题</strong></p><ul><li>集成SDK编译时找不到 openssl/asn1.h 文件</li></ul><p><img src='http://upload-images.jianshu.io/upload_images/1170656-9cd15fc846eef8ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240' alt='' /></p><p><mark>解决方案：Build Settings --&gt; Search Paths --&gt; Header Search paths : $(SRCROOT)/支付宝集成/Classes/Alipay</mark></p><p><img src='http://upload-images.jianshu.io/upload_images/1170656-0c846782413bc42c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240' alt='' /></p><ul><li>链接时：找不到 SystemConfiguration.framework 这个库</li></ul><p><img src='http://upload-images.jianshu.io/upload_images/1170656-017d3f15dea91b82.png?imageMogr2/auto-orient/strip%7CimageView2/2' alt='' /></p><p><mark>解决方案：</mark></p><p><img src='http://upload-images.jianshu.io/upload_images/1170656-9c1c8eb51640d3a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240' alt='' /></p><blockquote><p>打开支付宝客户端进行支付(用户没有安装支付宝客户端,直接在应用程序中添加一个WebView,通过网页让用户进行支付)</p></blockquote><p></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// 注意:如果是通过网页支付完成,那么会回调该block:callback</span></span></pre><pre class=""><span style="padding-right: 0.1px;">[[<span class="cm-variable">AlipaySDK</span> <span class="cm-variable">defaultService</span>] <span class="cm-variable">payOrder</span>:<span class="cm-variable">orderString</span> <span class="cm-variable">fromScheme</span>:<span class="cm-keyword">@</span><span class="cm-string">"jingdong"</span> <span class="cm-variable">callback</span>:<span class="cm-variable">^</span>(<span class="cm-variable">NSDictionary</span> <span class="cm-operator">*</span><span class="cm-variable">resultDic</span>) { }];</span></pre></div></div></div></div></div></div></div></pre><blockquote><p>在AppDelegate.m</p></blockquote><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// 当通过别的应用程序,将该应用程序打开时,会调用该方法</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-keyword">BOOL</span>)<span class="cm-variable">application</span>:(<span class="cm-variable">UIApplication</span> <span class="cm-operator">*</span>)<span class="cm-variable">app</span> <span class="cm-variable">openURL</span>:(<span class="cm-variable">NSURL</span> <span class="cm-operator">*</span>)<span class="cm-variable">url</span> <span class="cm-variable">options</span>:(<span class="cm-variable">NSDictionary</span><span class="cm-operator">&lt;</span><span class="cm-variable">NSString</span> <span class="cm-operator">*</span>,<span class="cm-keyword">id</span><span class="cm-operator">&gt;</span> <span class="cm-operator">*</span>)<span class="cm-variable">options</span>{ <span class="cm-comment">// 当用户通过支付宝客户端进行支付时,会回调该block:standbyCallback </span></span></pre><pre class=""><span style="padding-right: 0.1px;">[[<span class="cm-variable">AlipaySDK</span> <span class="cm-variable">defaultService</span>] <span class="cm-variable">processOrderWithPaymentResult</span>:<span class="cm-variable">url</span> <span class="cm-variable">standbyCallback</span>:<span class="cm-variable">^</span>(<span class="cm-variable">NSDictionary</span> <span class="cm-operator">*</span><span class="cm-variable">resultDic</span>) { <span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"result = %@"</span>,<span class="cm-variable">resultDic</span>); }]; <span class="cm-keyword">return</span> <span class="cm-atom">YES</span>;}</span></pre></div></div></div></div></div></div></div></pre><p><strong>流程图</strong></p><p><img src='http://upload-images.jianshu.io/upload_images/963857-d7f833a9ef5cb7f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240' alt='' /></p><blockquote><p>支付宝回调失败</p></blockquote><ul><li>出现的BUG 需要的参数 ：合作身份 卖家ID 商品价格 等</li><li>按照官方文档去做就可以，有一个注意点就是：partner。seller。privatekey需要我们在支付宝申请后去获取（流程问题总结）</li></ul><hr /><h1><a name='header-c1606' class='md-header-anchor '></a>推送</h1><h2><a name='header-c1607' class='md-header-anchor '></a>远程推送</h2><blockquote><p>当服务端远程向APNS推送至一台离线的设备时，苹果服务器Qos组件会自动保留一份最新的通知，等设备上线后，Qos将把推送发送到目标设备上</p></blockquote><p><em>远程推送的基本过程</em></p><ol><li>客户端的app需要将用户的UDID和app的bundleID发送给apns服务器,进行注册,apns将加密后的device Token返回给app</li><li>app获得device Token后,上传到公司服务器</li><li>当需要推送通知时,公司服务器会将推送内容和device Token一起发给apns服务器</li><li>apns再将推送内容送到客户端上</li></ol><p><em>创建证书的流程：</em></p><ol><li>打开钥匙串，生成CertificateSigningRequest.certSigningRequest文件</li><li>将CertificateSigningRequest.certSigningRequest上传进developer，导出.cer文件</li><li>利用CSR导出P12文件</li><li>需要准备下设备token值（无空格）</li><li>使用OpenSSL合成服务器所使用的推送证书</li></ol><blockquote><p>本地app代码参考</p></blockquote><ol><li><p>注册远程通知</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-operator">-</span> (<span class="cm-keyword">BOOL</span>)<span class="cm-variable">application</span>:(<span class="cm-variable">UIApplication</span> <span class="cm-operator">*</span>)<span class="cm-variable">application</span> <span class="cm-variable">didFinishLaunchingWithOptions</span>:(<span class="cm-variable">NSDictionary</span> <span class="cm-operator">*</span>)<span class="cm-variable">launchOptions</span><span class="cm-comment">//中注册远程通知</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">[[<span class="cm-variable">UIApplication</span> <span class="cm-variable">sharedApplication</span>] <span class="cm-variable">registerForRemoteNotificationTypes</span>:(<span class="cm-variable">UIRemoteNotificationTypeAlert</span> <span class="cm-operator">|</span> <span class="cm-variable">UIRemoteNotificationTypeBadge</span> <span class="cm-operator">|</span> <span class="cm-variable">UIRemoteNotificationTypeSound</span>)];</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p>​</p></li><li><p>实现几个代理方法：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//获取deviceToken令牌  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>(<span class="cm-variable-3">void</span>)<span class="cm-variable">application</span>:(<span class="cm-variable">UIApplication</span> <span class="cm-operator">*</span>)<span class="cm-variable">application</span> <span class="cm-variable">didRegisterForRemoteNotificationsWithDeviceToken</span>:(<span class="cm-variable">NSData</span> <span class="cm-operator">*</span>)<span class="cm-variable">deviceToken</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//获取设备的deviceToken唯一编号  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"deviceToken=%@"</span>,<span class="cm-variable">deviceToken</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSString</span> <span class="cm-operator">*</span><span class="cm-variable">realDeviceToken</span><span class="cm-operator">=</span>[<span class="cm-variable">NSString</span> <span class="cm-variable">stringWithFormat</span>:<span class="cm-keyword">@</span><span class="cm-string">"%@"</span>,<span class="cm-variable">deviceToken</span>];  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//去除&lt;&gt;  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">realDeviceToken</span> <span class="cm-operator">=</span> [<span class="cm-variable">realDeviceToken</span> <span class="cm-variable">stringByReplacingOccurrencesOfString</span>:<span class="cm-keyword">@</span><span class="cm-string">"&lt;"</span> <span class="cm-variable">withString</span>:<span class="cm-keyword">@</span><span class="cm-string">""</span>];  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">realDeviceToken</span> <span class="cm-operator">=</span> [<span class="cm-variable">realDeviceToken</span> <span class="cm-variable">stringByReplacingOccurrencesOfString</span>:<span class="cm-keyword">@</span><span class="cm-string">"&gt;"</span> <span class="cm-variable">withString</span>:<span class="cm-keyword">@</span><span class="cm-string">""</span>];  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"realDeviceToken=%@"</span>,<span class="cm-variable">realDeviceToken</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">[[<span class="cm-variable">NSUserDefaults</span> <span class="cm-variable">standardUserDefaults</span>] <span class="cm-variable">setValue</span>:<span class="cm-variable">realDeviceToken</span> <span class="cm-variable">forKey</span>:<span class="cm-keyword">@</span><span class="cm-string">"DeviceToken"</span>];  <span class="cm-comment">//要发送给服务器</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">//获取令牌出错  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>(<span class="cm-variable-3">void</span>)<span class="cm-variable">application</span>:(<span class="cm-variable">UIApplication</span> <span class="cm-operator">*</span>)<span class="cm-variable">application</span> <span class="cm-variable">didFailToRegisterForRemoteNotificationsWithError</span>:(<span class="cm-variable">NSError</span> <span class="cm-operator">*</span>)<span class="cm-variable">error</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//注册远程通知设备出错  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"RegisterForRemoteNotification error=%@"</span>,<span class="cm-variable">error</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">}  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">//在应用在前台时受到消息调用  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>(<span class="cm-variable-3">void</span>)<span class="cm-variable">application</span>:(<span class="cm-variable">UIApplication</span> <span class="cm-operator">*</span>)<span class="cm-variable">application</span> <span class="cm-variable">didReceiveRemoteNotification</span>:(<span class="cm-variable">NSDictionary</span> <span class="cm-operator">*</span>)<span class="cm-variable">userInfo</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">//打印推送的消息  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSLog</span>(<span class="cm-keyword">@</span><span class="cm-string">"%@"</span>,[[<span class="cm-variable">userInfo</span> <span class="cm-variable">objectForKey</span>:<span class="cm-keyword">@</span><span class="cm-string">"aps"</span>] <span class="cm-variable">objectForKey</span>:<span class="cm-keyword">@</span><span class="cm-string">"alert"</span>]):  </span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre></li><li><p>配置后台模式 <img src='http://upload-images.jianshu.io/upload_images/1170656-d955d43170b41c11.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240' alt='' /></p></li></ol><ul><li>一般我们是使用开发版本的Provisioning做推送测试,如果没有问题,再使用发布版本证书的时候一般也应该是没有问题的。为了以防万一,我们可以在越狱的手机上安装我们的使用发布版证书的ipa文件(最好使用debug版本,并打印出获取到的deviceToken),安装成功后在;XCode-&gt;Window-&gt;Organizer-找到对应的设备查看console找到打印的deviceToken。</li></ul><ul><li>在后台的推送程序中使用发布版制作的证书并使用该deviceToken做推送服务使用开发和发布证书获取到的deviceToken是不一样的</li></ul><h2><a name='header-c1669' class='md-header-anchor '></a>极光推送</h2><h3><a name='header-c1670' class='md-header-anchor '></a>要点</h3><ol><li>看官方文档集成。</li><li>注册device，用nsnotification 添加官方的几个观察对象，在didlogin之后上传 setalias.</li><li>分为通知和自定义消息两种。</li><li>通知在系统方法didReceiveRemoteMessage方法中获得</li><li>自定义消息在通知中心增加观察者jPush...ReceiveNotification中获得</li><li>推送分环境, 不同环境需要后台进行设置</li></ol><p><strong>资料：</strong><a href='http://ios.jobbole.com/83952/'>伯乐在线远程推送</a></p><hr /><h1><a name='header-c1693' class='md-header-anchor '></a>如何追踪app崩溃率，如何解决线上闪退</h1><blockquote><p>当iOS设备上的App应用闪退时，操作系统会生成一个crash日志，保存在设备上。crash日志上有很多有用的信息，比如每个正在执行线程的完整堆栈跟踪信息和内存映像，这样就能够通过解析这些信息进而定位crash发生时的代码逻辑，从而找到App闪退的原因。通常来说，crash产生来源于两种问题：违反iOS系统规则导致的crash和App代码逻辑BUG导致的crash，下面分别对他们进行分析。</p></blockquote><h2><a name='header-c1697' class='md-header-anchor '></a>违反iOS系统规则产生crash的三种类型</h2><ul><li>内存报警闪退</li></ul><blockquote><p>当iOS检测到内存过低时，它的VM系统会发出低内存警告通知，尝试回收一些内存；如果情况没有得到足够的改善，iOS会终止后台应用以回收更多内存；最后，如果内存还是不足，那么正在运行的应用可能会被终止掉。在Debug模式下，可以主动将客户端执行的动作逻辑写入一个log文件中，这样程序童鞋可以将内存预警的逻辑写入该log文件，当发生如下截图中的内存报警时，就是提醒当前客户端性能内存吃紧，可以通过Instruments工具中的Allocations 和 Leaks模块库来发现内存分配问题和内存泄漏问题。</p></blockquote><ul><li>响应超时</li></ul><blockquote><p>当应用程序对一些特定的事件（比如启动、挂起、恢复、结束）响应不及时，苹果的Watchdog机制会把应用程序干掉，并生成一份相应的crash日志。这些事件与下列UIApplicationDelegate方法相对应</p></blockquote><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">application</span>:<span class="cm-variable">didFinishLaunchingWithOptions</span>:　</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">applicationWillResignActive</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">applicationDidEnterBackground</span>:　</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">applicationWillEnterForeground</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">applicationDidBecomeActive</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">applicationWillTerminate</span>:</span></pre></div></div></div></div></div></div></div></pre><ul><li>用户强制退出</li></ul><blockquote><p>一看到“用户强制退出”，首先可能想到的双击Home键，然后关闭应用程序。不过这种场景一般是不会产生crash日志的，因为双击Home键后，所有的应用程序都处于后台状态，而iOS随时都有可能关闭后台进程，当应用阻塞界面并停止响应时这种场景才会产生crash日志。这里指的“用户强制退出”场景，是稍微比较复杂点的操作：先按住电源键，直到出现“滑动关机”的界面时，再按住Home键，这时候当前应用程序会被终止掉，并且产生一份相应事件的crash日志。</p></blockquote><h2><a name='header-c1720' class='md-header-anchor '></a>应用逻辑的Bug</h2><blockquote><p>大多数闪退崩溃日志的产生都是因为应用中的Bug，这种Bug的错误种类有很多，比如</p></blockquote><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-variable">SEGV：（Segmentation</span> <span class="cm-variable">Violation，段违例），无效内存地址，比如空指针，未初始化指针，栈溢出等；</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SIGABRT：收到Abort信号，可能自身调用abort</span>()<span class="cm-variable">或者收到外部发送过来的信号；</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SIGBUS：总线错误。与SIGSEGV不同的是，SIGSEGV访问的是无效地址（比如虚存映射不到物理内存），而SIGBUS访问的是有效地址，但总线访问异常（比如地址对齐问题）；</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SIGILL：尝试执行非法的指令，可能不被识别或者没有权限；</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SIGFPE：Floating</span> <span class="cm-variable">Point</span> <span class="cm-variable">Error，数学计算相关问题（可能不限于浮点计算），比如除零操作；</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SIGPIPE：管道另一端没有进程接手数据；</span></span></pre></div></div></div></div></div></div></div></pre><blockquote><p>常见的崩溃原因基本都是代码逻辑问题或资源问题，比如数组越界，访问野指针或者资源不存在，或资源大小写错误等。</p></blockquote><h2><a name='header-c1728' class='md-header-anchor '></a>crash的收集</h2><blockquote><p>如果是在windows上你可以通过itools或pp助手等辅助工具查看系统产生的历史crash日志，然后再根据app来查看。如果是在Mac 系统上，只需要打开xcode-&gt;windows-&gt;devices，选择device logs进行查看，如下图，这些crash文件都可以导出来，然后再单独对这个crash文件做处理分析。</p></blockquote><p><img src='http://upload-images.jianshu.io/upload_images/1170656-834619bd37e5cba8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240' alt='' /></p><blockquote><p>市场上已有的商业软件提供crash收集服务，这些软件基本都提供了日志存储，日志符号化解析和服务端可视化管理等服务：　　</p></blockquote><ul><li>Crashlytics (<a href='http://www.crashlytics.com/'>www.crashlytics.com</a>)</li><li>Crittercism (<a href='http://www.crittercism.com/'>www.crittercism.com</a>)</li><li>Bugsense (<a href='http://www.bugsense.com/'>www.bugsense.com</a>)　　</li><li>HockeyApp (<a href='http://www.hockeyapp.net/'>www.hockeyapp.net</a>)　　</li><li>Flurry(<a href='http://www.flurry.com/'>www.flurry.com</a>)</li></ul><blockquote><p>开源的软件也可以拿来收集crash日志，比如Razor,QuincyKit（git链接）等，这些软件收集crash的原理其实大同小异，都是根据系统产生的crash日志进行了一次提取或封装，然后将封装后的crash文件上传到对应的服务端进行解析处理。很多商业软件都采用了Plcrashreporter这个开源工具来上传和解析crash，比如HockeyApp,Flurry和crittercism等</p></blockquote><p><img src='http://upload-images.jianshu.io/upload_images/1170656-a8b82f0317591a3a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240' alt='' /></p><blockquote><p>由于自己的crash信息太长，找了一张示例：　　</p></blockquote><ol><li>crash标识是应用进程产生crash时的一些标识信息，它描述了该crash的唯一标识（E838FEFB-ECF6-498C-8B35-D40F0F9FEAE4），所发生的硬件设备类型（iphone3,1代表iphone4），以及App进程相关的信息等；</li><li>基本信息描述的是crash发生的时间和系统版本；　　</li><li>异常类型描述的是crash发生时抛出的异常类型和错误码；　　</li><li>线程回溯描述了crash发生时所有线程的回溯信息，每个线程在每一帧对应的函数调用信息（这里由于空间限制没有全部列出）；　　</li><li>二进制映像是指crash发生时已加载的二进制文件。以上就是一份crash日志包含的所有信息，接下来就需要根据这些信息去解析定位导致crash发生的代码逻辑， 这就需要用到符号化解析的过程（洋名叫：symbolication)。</li></ol><p><strong>解决线上闪退</strong>
首先保证，发布前充分测试。发布后依然有闪退现象，查看崩溃日志，及时修复并发布。</p><ol><li>苹果的加急通道</li><li>JSPatch 热修复 <mark>资料</mark> ：<a href='http://www.jianshu.com/p/6ea5bf2ed638'>JSPatch小记</a></li></ol><h1><a name='header-c1787' class='md-header-anchor '></a>什么是事件响应链</h1><blockquote><p>对于IOS设备用户来说，他们操作设备的方式主要有三种：触摸屏幕、晃动设备、通过遥控设施控制设备。对应的事件类型有以下三种：</p></blockquote><ol><li>触屏事件（Touch Event）</li><li>运动事件（Motion Event）</li><li>远端控制事件（Remote-Control Event）</li></ol><h2><a name='header-c1801' class='md-header-anchor '></a>响应者链（Responder Chain）</h2><ul><li>响应者对象（Responder Object），指的是有响应和处理事件能力的对象。响应者链就是由一系列的响应者对象构成的一个层次结构。</li></ul><ul><li>UIResponder是所有响应对象的基类，在UIResponder类中定义了处理上述 各种事件的接口。我们熟悉的UIApplication、 UIViewController、UIWindow和所有继承自UIView的UIKit类都直接或间接的继承自UIResponder，所以它们的实例都是可以构成响应者链的响应者对象。</li></ul><h3><a name='header-c1810' class='md-header-anchor '></a>响应者链有以下特点：</h3><ol><li>响应者链通常是由视图（UIView）构成的；</li><li>一个视图的下一个响应者是它视图控制器（UIViewController）（如果有的话），然后再转给它的父视图（Super View）；</li><li>视图控制器（如果有的话）的下一个响应者为其管理的视图的父视图；</li><li>单例的窗口（UIWindow）的内容视图将指向窗口本身作为它的下一个响应者需要指出的是，Cocoa Touch应用不像Cocoa应用，它只有一个UIWindow对象，因此整个响应者链要简单一点；</li><li>单例的应用（UIApplication）是一个响应者链的终点，它的下一个响应者指向nil，以结束整个循环。</li></ol><p><strong>点击屏幕时是如何互动的</strong></p><ul><li>iOS系统检测到手指触摸(Touch)操作时会将其打包成一个UIEvent对象，并放入当前活动Application的事件队列，单例的UIApplication会从事件队列中取出触摸事件并传递给单例的UIWindow来处理，UIWindow对象首先会使用hitTest:withEvent:方法寻找此次Touch操作初始点所在的视图(View)，即需要将触摸事件传递给其处理的视图，这个过程称之为hit-test view。</li></ul><ul><li>UIWindow实例对象会首先在它的内容视图上调用hitTest:withEvent:，此方法会在其视图层级结构中的每个视图上调用pointInside:withEvent:（该方法用来判断点击事件发生的位置是否处于当前视图范围内，以确定用户是不是点击了当前视图），如果pointInside:withEvent:返回YES，则继续逐级调用，直到找到touch操作发生的位置，这个视图也就是要找的hit-test view。</li></ul><ul><li>hitTest:withEvent:方法的处理流程如下:首先调用当前视图的pointInside:withEvent:方法判断触摸点是否在当前视图内；若返回NO,则hitTest:withEvent:返回nil;若返回YES,则向当前视图的所有子视图(subviews)发送hitTest:withEvent:消息，所有子视图的遍历顺序是从最顶层视图一直到到最底层视图，即从subviews数组的末尾向前遍历，直到有子视图返回非空对象或者全部子视图遍历完毕；若第一次有子视图返回非空对象，则hitTest:withEvent:方法返回此对象，处理结束；如所有子视图都返回非，则hitTest:withEvent:方法返回自身(self)。</li></ul><p><strong>事件的传递和响应分两个链：</strong></p><ul><li>传递链：由系统向离用户最近的view传递。UIKit –&gt; active app’s event queue –&gt; window –&gt; root view –&gt;……–&gt;lowest view</li></ul><ul><li>响应链：由离用户最近的view向系统传递。initial view –&gt; super view –&gt; …..–&gt; view controller –&gt; window –&gt; Application</li></ul><hr /><h1><a name='header-c1852' class='md-header-anchor '></a>请分析下SDWebImage的原理</h1><blockquote><p>这个类库提供一个UIImageView类别以支持加载来自网络的远程图片。具有缓存管理、异步下载、同一个URL下载次数控制和优化等特征。</p><blockquote><p>调用类别的方法：</p><p>从网络上获取，使用，缓存到内存，缓存到沙盒</p><p>从内存中（字典）找图片（当这个图片在本次程序加载过），找到直接使用；</p><p>从沙盒中找，找到直接使用，缓存到内存。</p></blockquote></blockquote><h2><a name='header-c1865' class='md-header-anchor '></a>SDWebImage 加载图片的流程</h2><ol><li>入口 setImageWithURL:placeholderImage:options: 会先把 placeholderImage 显示，然后 SDWebImageManager 根据 URL 开始处理图片。</li><li>进入 SDWebImageManager-downloadWithURL:delegate:options:userInfo:，交给 SDImageCache 从缓存查找图片是否已经下载 queryDiskCacheForKey:delegate:userInfo:.</li><li>先从内存图片缓存查找是否有图片，如果内存中已经有图片缓存，SDImageCacheDelegate 回调 imageCache:didFindImage:forKey:userInfo: 到 SDWebImageManager。</li><li>SDWebImageManagerDelegate 回调 webImageManager:didFinishWithImage: 到 UIImageView+WebCache 等前端展示图片。</li><li>如果内存缓存中没有，生成 NSInvocationOperation 添加到队列开始从硬盘查找图片是否已经缓存。</li><li>根据 URLKey 在硬盘缓存目录下尝试读取图片文件。这一步是在 NSOperation 进行的操作，所以回主线程进行结果回调 notifyDelegate:。</li><li>如果上一操作从硬盘读取到了图片，将图片添加到内存缓存中（如果空闲内存过小，会先清空内存缓存）。SDImageCacheDelegate 回调 imageCache:didFindImage:forKey:userInfo:。进而回调展示图片。</li><li>如果从硬盘缓存目录读取不到图片，说明所有缓存都不存在该图片，需要下载图片，回调 imageCache:didNotFindImageForKey:userInfo:。</li><li>共享或重新生成一个下载器 SDWebImageDownloader 开始下载图片。</li><li>图片下载由 NSURLConnection 来做，实现相关 delegate 来判断图片下载中、下载完成和下载失败。</li><li>connection:didReceiveData: 中利用 ImageIO 做了按图片下载进度加载效果。</li><li>connectionDidFinishLoading: 数据下载完成后交给 SDWebImageDecoder 做图片解码处理。</li><li>图片解码处理在一个 NSOperationQueue 完成，不会拖慢主线程 UI。如果有需要对下载的图片进行二次处理，最好也在这里完成，效率会好很多。</li><li>在主线程 notifyDelegateOnMainThreadWithInfo: 宣告解码完成，imageDecoder:didFinishDecodingImage:userInfo: 回调给 SDWebImageDownloader。</li><li>imageDownloader:didFinishWithImage: 回调给 SDWebImageManager 告知图片下载完成。</li><li>通知所有的 downloadDelegates 下载完成，回调给需要的地方展示图片。</li><li>将图片保存到 SDImageCache 中，内存缓存和硬盘缓存同时保存。写文件到硬盘也在以单独 NSInvocationOperation 完成，避免拖慢主线程。</li><li>SDImageCache 在初始化的时候会注册一些消息通知，在内存警告或退到后台的时候清理内存图片缓存，应用结束的时候清理过期图片。</li><li>SDWI 也提供了 UIButton+WebCache 和 MKAnnotationView+WebCache，方便使用。</li><li>SDWebImagePrefetcher 可以预先下载图片，方便后续使用。</li></ol><h2><a name='header-c1927' class='md-header-anchor '></a>SDWebImage库的作用</h2><blockquote><p>通过对UIImageView的类别扩展来实现异步加载替换图片的工作。</p></blockquote><p>主要用到的对象：</p><ol><li><p>UIImageView (WebCache)类别，入口封装，</p><ul><li>实现读取图片完成后的回调</li></ul></li><li><p>SDWebImageManager，对图片进行管理的中转站，记录那些图片正在读取。向下层读取Cache（调用SDImageCache），或者向网络读取对象（调用SDWebImageDownloader） 。</p><ul><li>实现SDImageCacheSDWebImageDownloader的回调。</li></ul></li><li><p>SDImageCache，根据URL的MD5摘要对图片进行存储和读取（实现存在内存中或者存在硬盘上两种实现）</p><ul><li>实现图片和内存清理工作。</li></ul></li><li><p>SDWebImageDownloader，根据URL向网络读取数据（实现部分读取和全部读取后再通知回调两种方式）</p></li></ol><p><strong>其他类：</strong>
<em>SDWebImageDecoder，异步对图像进行了一次解压⋯⋯</em></p><blockquote><p>1、SDImageCache是怎么做数据管理的?</p></blockquote><p>SDImageCache分两个部分，一个是内存层面的，一个是硬盘层面的。内存层面的相当是个缓存器，以Key-Value的形式存储图片。当内存不够的时候会清除所有缓存图片。用搜索文件系统的方式做管理，文件替换方式是以时间为单位，剔除时间大于一周的图片文件。当SDWebImageManager向SDImageCache要资源时，先搜索内存层面的数据，如果有直接返回，没有的话去访问磁盘，将图片从磁盘读取出来，然后做Decoder，将图片对象放到内存层面做备份，再返回调用层。</p><blockquote><p>2、为啥必须做Decoder?</p></blockquote><p>由于UIImage的imageWithData函数是每次画图的时候才将Data解压成ARGB的图像，所以在每次画图的时候，会有一个解压操作，这样效率很低，但是只有瞬时的内存需求。为了提高效率通过SDWebImageDecoder将包装在Data下的资源解压，然后画在另外一张图片上，这样这张新图片就不再需要重复解压了。
这种做法是典型的空间换时间的做法。</p><h1><a name='header-c1972' class='md-header-anchor '></a>情景题</h1><blockquote><p>UITableViewCell上有个UILabel，显示NSTimer实现的秒表时间，手指滚动cell过程中，label是否刷新，为什么？</p></blockquote><p>这是否刷新取决于timer加入到Run Loop中的Mode是什么。Mode主要是用来指定事件在运行循环中的优先级的，分为：</p><ul><li><p><code>NSDefaultRunLoopMode（kCFRunLoopDefaultMode）</code>：默认，空闲状态</p></li><li><p><code>UITrackingRunLoopMode</code>：ScrollView滑动时会切换到该Mode</p></li><li><p><code>UIInitializationRunLoopMode</code>：run loop启动时，会切换到该mode</p></li><li><p><code>NSRunLoopCommonModes（kCFRunLoopCommonModes）</code>：Mode集合</p><p><code>NSRunLoopCommonModes（kCFRunLoopCommonModes）</code>：Mode集合
苹果公开提供的Mode有两个：</p></li><li><p><code>NSDefaultRunLoopMode（kCFRunLoopDefaultMode）</code></p></li><li><p><code>NSRunLoopCommonModes（kCFRunLoopCommonModes）</code></p></li><li><p>在编程中：如果我们把一个<code>NSTimer</code>对象以<code>NSDefaultRunLoopMode（kCFRunLoopDefaultMode）</code>添加到主运行循环中的时候, ScrollView滚动过程中会因为mode的切换，而导致<code>NSTimer</code>将不再被调度。当我们滚动的时候，也希望不调度，那就应该使用默认模式。但是，如果希望在滚动时，定时器也要回调，那就应该使用common mode。</p></li></ul><blockquote><p>有a、b、c、d 4个异步请求，如何判断a、b、c、d都完成执行？如果需要a、b、c、d顺序执行，该如何实现？</p></blockquote><ul><li><p>对于这四个异步请求，要判断都执行完成最简单的方式就是通过GCD的group来实现：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
dispatch_group_t group = dispatch_group_create();
dispatch_group_async(group, queue, ^{ /*任务a */ });
dispatch_group_async(group, queue, ^{ /*任务b */ });
dispatch_group_async(group, queue, ^{ /*任务c */ }); 
dispatch_group_async(group, queue, ^{ /*任务d */ }); 
dispatch_group_notify(group,dispatch_get_main_queue(), ^{
 // 在a、b、c、d异步执行完成后，会回调这里
});</pre></li><li><p>当然，我们还可以使用非常老套的方法来处理，通过四个变量来标识a、b、c、d四个任务是否完成，然后在runloop中让其等待，当完成时才退出runloop。但是这样做会让后面的代码得不到执行，直到Run loop执行完毕。</p></li><li><p>解释：要求顺序执行，那么可以将任务放到串行队列中，自然就是按顺序来异步执行了。</p></li></ul><blockquote><p>使用block有什么好处？使用NSTimer写出一个使用block显示（在UILabel上）秒表的代码</p></blockquote><ul><li><p>代码紧凑，传值、回调都很方便，省去了写代理的很多代码。</p></li><li><p>NSTimer封装成的block，<a href='http://www.henishuo.com/nstimer-block/'>具体实现</a></p></li><li><p>实现方法：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSTimer</span> <span class="cm-operator">*</span><span class="cm-variable">timer</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSTimer</span> <span class="cm-variable">scheduledTimerWithTimeInterval</span>:<span class="cm-number">1.0</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">repeats</span>:<span class="cm-atom">YES</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">callback</span>:<span class="cm-variable">^</span>() {</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">weakSelf</span>.<span class="cm-variable">secondsLabel</span>.<span class="cm-variable">text</span> <span class="cm-operator">=</span> ...</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;">[[<span class="cm-variable">NSRunLoop</span> <span class="cm-variable">currentRunLoop</span>] <span class="cm-variable">addTimer</span>:<span class="cm-variable">timer</span> <span class="cm-variable">forMode</span>:<span class="cm-variable">NSRunLoopCommonModes</span>];</span></pre></div></div></div></div></div></div></div></pre></li></ul><blockquote><p>一个view已经初始化完毕，view上面添加了n个button，除用view的tag之外，还可以采用什么办法来找到自己想要的button来修改button的值</p></blockquote><p>有2种方法解决：</p><ul><li>第一种：如果是点击某个按钮后，才会刷新它的值，其它不用修改，那么不用引用任何按钮，直接在回调时，就已经将接收响应的按钮给传过来了，直接通过它修改即可。</li><li>第二种：点击某个按钮后，所有与之同类型的按钮都要修改值，那么可以通过在创建按钮时将按钮存入到数组中，在需要的时候遍历查找。</li></ul><hr /><h1><a name='header-c2044' class='md-header-anchor '></a>真机测试</h1><ul><li>首先需要用<code>钥匙串</code>创建一个钥匙（key）；</li><li>将钥匙串上传到官网，获取iOS Development证书；</li><li>创建App ID即我们应用程序中的Boundle ID；</li><li>添加Device ID即UDID；</li><li>通过勾选前面所创建的证书：App ID、Device ID；</li><li>生成mobileprovision文件；</li><li>先决条件：申请开发者账号  99美刀</li></ul><hr /><h1><a name='header-c2068' class='md-header-anchor '></a>APP发布的上架流程</h1><ul><li>登录应用发布网站添加应用信息；</li><li>下载安装发布证书；</li><li>选择发布证书，使用Archive编译发布包，用Xcode将代码（发布包）上传到服务器；</li><li>等待审核通过;</li><li>生成IPA：菜单栏-&gt;Product-&gt;Archive.</li></ul><hr /><h1><a name='header-c2086' class='md-header-anchor '></a>property属性的修饰符的作用</h1><ul><li>getter=getName、setter=setName：设置setter与getter的方法名；</li><li>readwrite、readonly：设置可供访问级别；</li><li>assign：方法直接赋值，不进行任何retain操作，为了解决原类型与环循引用问题；</li><li>retain：其setter方法对参数进行release旧值再retain新值，所有实现都是这个顺序；</li><li>copy：其setter方法进行copy操作，与retain处理流程一样，先对旧值release，再copy出新的对象，retainCount为1。这是为了减少对上下文的依赖而引入的机制。</li><li>nonatomic：非原子性访问，不加同步， 多线程并发访问会提高性能。注意，如果不加此属性，则默认是两个访问方法都为原子型事务访问。</li></ul><h1><a name='header-c2106' class='md-header-anchor '></a>内存的使用和优化的注意事项</h1><ul><li><p><strong>重用问题</strong>：如UITableViewCells、UICollectionViewCells、UITableViewHeaderFooterViews设置正确的reuseIdentifier，充分重用；</p></li><li><p><strong>尽量把views设置为不透明</strong>：当opque为NO的时候，图层的半透明取决于图片和其本身合成的图层为结果，可提高性能；</p></li><li><p><strong>不要使用太复杂的XIB/Storyboard</strong>：载入时就会将XIB/storyboard需要的所有资源，包括图片全部载入内存，即使未来很久才会使用。那些相比纯代码写的延迟加载，性能及内存就差了很多；</p></li><li><p><strong>选择正确的数据结构</strong>：学会选择对业务场景最合适的数组结构是写出高效代码的基础。比如，数组: 有序的一组值。使用索引来查询很快，使用值查询很慢，插入/删除很慢。字典: 存储键值对，用键来查找比较快。集合: 无序的一组值，用值来查找很快，插入/删除很快。</p><p><strong>选择正确的数据结构</strong>：学会选择对业务场景最合适的数组结构是写出高效代码的基础。比如，数组: 有序的一组值。使用索引来查询很快，使用值查询很慢，插入/删除很慢。字典: 存储键值对，用键来查找比较快。集合: 无序的一组值，用值来查找很快，插入/删除很快。
gzip/zip压缩：当从服务端下载相关附件时，可以通过gzip/zip压缩后再下载，使得内存更小，下载速度也更快。</p></li><li><p><strong>延迟加载</strong>：对于不应该使用的数据，使用延迟加载方式。对于不需要马上显示的视图，使用延迟加载方式。比如，网络请求失败时显示的提示界面，可能一直都不会使用到，因此应该使用延迟加载。</p></li><li><p><strong>数据缓存</strong>：对于cell的行高要缓存起来，使得reload数据时，效率也极高。而对于那些网络数据，不需要每次都请求的，应该缓存起来，可以写入数据库，也可以通过plist文件存储。</p></li><li><p><strong>处理内存警告</strong>：一般在基类统一处理内存警告，将相关不用资源立即释放掉</p><p><strong>处理内存警告</strong>：一般在基类统一处理内存警告，将相关不用资源立即释放掉
重用大开销对象：一些objects的初始化很慢，比如<code>NSDateFormatter</code>和<code>NSCalendar</code>，但又不可避免地需要使用它们。通常是作为属性存储起来，防止反复创建。</p></li><li><p><strong>避免反复处理数据</strong>：许多应用需要从服务器加载功能所需的常为JSON或者XML格式的数据。在服务器端和客户端使用相同的数据结构很重要;</p></li><li><p><strong>使用Autorelease Pool</strong>：在某些循环创建临时变量处理数据时，自动释放池以保证能及时释放内存;</p></li><li><p><strong>正确选择图片加载方式</strong>：详情阅读<a href='http://www.henishuo.com/image-loaded-method/'>细读UIImage加载方式</a></p><p>​</p></li></ul><hr /><h1><a name='header-c2147' class='md-header-anchor '></a>小问题</h1><h2><a name='header-c2148' class='md-header-anchor '></a>static、self、super关键字的作用</h2><blockquote><p>函数体内static变量的作用范围为该函数体，不同于auto变量，该变量的内存只被分配一次，因此其值在下次调用时仍维持上次的值. 在模块内的 static 全局变量可以被模块内所用函数访问，但不能被模块外其它函数访问. 在模块内的static函数只可被这一模块内的其它函数调用，这个函数的使用范围被限制在声明. 在类中的static成员变量属于整个类所拥有，对类的所有对象只有一份拷贝.</p><blockquote><p>self:当前消息的接收者。</p><p>super:向父类发送消息。</p></blockquote></blockquote><h2><a name='header-c2157' class='md-header-anchor '></a>对象可以被copy的条件</h2><blockquote><p>只有实现了NSCopying和NSMutableCopying协议的类的对象才能被拷贝,分为不可变拷贝和可变拷贝,</p></blockquote><p> NSCopying协议方法为：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> (<span class="cm-keyword">id</span>)<span class="cm-variable">copyWithZone</span>:(<span class="cm-variable">NSZone</span> <span class="cm-operator">*</span>)<span class="cm-variable">zone</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">MyObject</span> <span class="cm-operator">*</span><span class="cm-keyword">copy</span> <span class="cm-operator">=</span> [[[<span class="cm-keyword">self</span> <span class="cm-variable">class</span>] <span class="cm-variable">allocWithZone</span>: <span class="cm-variable">zone</span>] <span class="cm-variable">init</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">copy</span>.<span class="cm-variable">username</span> <span class="cm-operator">=</span> [<span class="cm-keyword">self</span>.<span class="cm-variable">username</span> <span class="cm-variable">copyWithZone</span>:<span class="cm-variable">zone</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">return</span> <span class="cm-keyword">copy</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><h2><a name='header-c2164' class='md-header-anchor '></a>使用block有什么好处？</h2><p>使用NSTimer写出一个使用block显示（在UILabel上）秒表的代码 代码紧凑，传值、回调都很方便，省去了写代理的很多代码。 NSTimer封装成的block，具体实现 实现方法：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">NSTimer</span> <span class="cm-operator">*</span><span class="cm-variable">timer</span> <span class="cm-operator">=</span> [<span class="cm-variable">NSTimer</span> <span class="cm-variable">scheduledTimerWithTimeInterval</span>:<span class="cm-number">1.0</span> <span class="cm-variable">repeats</span>:<span class="cm-atom">YES</span> <span class="cm-variable">callback</span>:<span class="cm-variable">^</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">weakSelf</span>.<span class="cm-variable">secondsLabel</span>.<span class="cm-variable">text</span> <span class="cm-operator">=</span> ...</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">[[<span class="cm-variable">NSRunLoop</span> <span class="cm-variable">currentRunLoop</span>] <span class="cm-variable">addTimer</span>:<span class="cm-variable">timer</span> <span class="cm-variable">forMode</span>:<span class="cm-variable">NSRunLoopCommonModes</span>];</span></pre></div></div></div></div></div></div></div></pre><h2><a name='header-c2168' class='md-header-anchor '></a>Block的注意事项：</h2><ul><li>__weak block A-B-C作用域问题</li></ul><ul><li><p>大概意思归结出来就是两点：</p><ul><li><em>_block对象在block中是可以被修改、重新赋值的。 	_</em></li></ul></li></ul><ul><li>__block对象在block中不会被block强引用一次，从而不会出现循环引用问题。</li></ul><ul><li>使用了__weak修饰符的对象，作用等同于定义为weak的property。自然不会导致循环引用问题，因为苹果文档已经说的很清楚，当原对象没有任何强引用的时候，弱引用指针也会被设置为nil。</li></ul><ul><li><p>因此，<strong>block和</strong>weak修饰符的区别其实是挺明显的： </p><ul><li><em>_block不管是ARC还是MRC模式下都可以使用，可以修饰对象，还可以修饰基本数据类型。 _</em></li><li><strong>_</strong>weak只能在ARC模式下使用，也只能修饰对象（NSString），不能修饰基本数据类型（int）。 </li><li><em>_block对象可以在block中被重新赋值，  _</em>weak不可以 </li></ul></li></ul><ul><li>PS：<strong>unsafe_unretained修饰符可以被视为iOSSDK 4.3以前版本的</strong>weak的替代品，不过不会被自动置空为nil。所以尽可能不要使用这个修饰符。</li></ul><h2><a name='header-c2207' class='md-header-anchor '></a>动画：分为显示动画和隐式动画</h2><ul><li>在UIView上的事显示动画，不用我们手动去开启，只要直接调用animation的接口就可以了。</li></ul><ul><li>在CALayer上的动画叫隐式动画，需要我们去手动开启，隐式动画分为三种，属性动画，组动画和转场动画，属性动画又分为基础动画和帧动画，帧动画需要指定路径</li></ul><ul><li>隐式动画有隐式代理：动画的开始和动画的结束</li></ul><h2><a name='header-c2220' class='md-header-anchor '></a>SSO 授权</h2><ol><li>首先去Mob注册装好，下载SDK,然后添加自己的应用得到AppKey</li><li>集成sharaSDK,导入sdk添加需要的库函数</li><li>配置url scheme</li><li>注册sharaSDK,添加要集成的第三方登陆平台，需要有回调地址</li><li>然后配置咱们的info。plist文件，URL types项</li><li>适配iOS9参照友盟官网“适配ios9系统”－－》信任白名单</li></ol><h2><a name='header-c2240' class='md-header-anchor '></a>LBS地图，定位，导航</h2><blockquote><p>Map Kit用于地图的展示Core Location用于地理位置定位<code>(BOOL)locationServicesEnabled</code>判断用户是否授权定位功能CLGeocoder完成地理编码和反地理编码地理编码：根据地名获取经纬度</p><p>反地理编码：根据经纬度获取地名</p><p>当地理编码或反地理编码完成之后就会调用一个block</p><p>导航划线：本质上是在mapView上添加泽盖屋，数据交由苹果处理（其实在国内就是高德地图）</p><p>1.地理编码目的地位置</p><p>2.转化：CLPlacemark—MKPlacemark</p><p>3.获取当前位置和目的地mapItem</p><p>4.开始导航</p><p>MKMapItem openMapsWithItems: launchOptions:</p><p>划线大致分为三步：1.定位，创建位置管理器并请求用户授权即可</p><p>2.请求目的地和当前位置的折线（polyline）</p><p>3.创建渲染物对象：在mapview代理方法中根据折线创建渲染物，并设置颜色，说实话，这个类事很多的，很不好记</p><p></p></blockquote><h2><a name='header-c2268' class='md-header-anchor '></a>应用跳转：是根据协议头跳转</h2><blockquote><p>A跳转B,需要b增加url types，a应用根据url的协议头跳转</p><p>ios8之前的跳转</p><p>iOS9需要配置plist文件，添加白名单－－</p></blockquote><h2><a name='header-c2276' class='md-header-anchor '></a>用@property声明的NSString（或NSArray，NSDictionary）经常使用copy关键字，为什么？</h2><blockquote><p>如果改用strong关键字，可能造成什么问题？</p></blockquote><p>答：用@property声明 NSString、NSArray、NSDictionary 经常使用copy关键字，是因为他们有对应的可变类型：NSMutableString、NSMutableArray、NSMutableDictionary，他们之间可能进行赋值操作，为确保对象中的字符串值不会无意间变动，应该在设置新属性值时拷贝一份。如果我们使用是strong,那么这个属性就有可能指向一个可变对象,如果这个可变对象在外部被修改了,那么会影响该属性。 copy此特质所表达的所属关系与strong类似。然而设置方法并不保留新值，而是将其“拷贝” (copy)。 当属性类型为NSString时，经常用此特质来保护其封装性，因为传递给设置方法的新值有可能指向一个NSMutableString类的实例。这个类是NSString的子类，表示一种可修改其值的字符串，此时若是不拷贝字符串，那么设置完属性之后，字符串的值就可能会在对象不知情的情况下遭人更改。所以，这时就要拷贝一份“不可变” (NSMutable)的字符串，确保对象中的字符串值不会无意间变动。只要实现属性所用的对象是“可变的” (mutable)，就应该在设置新属性值时拷贝一份。</p><h2><a name='header-c2282' class='md-header-anchor '></a>分别写一个setter方法用于完成@property (nonatomic,retain)NSString <em>name和@property (nonatomic,copy) NSString *name</em></h2><blockquote><p>retain属性的setter方法是保留新值并释放旧值，然后更新实例变量，令其指向新值。顺序很重要。假如还未保留新值就先把旧值释放了，而且两个值又指向同一个对象，先执行的release操作就可能导致系统将此对象永久回收。</p></blockquote><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-code" style=""><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>(<span class="cm-variable-3">void</span>)<span class="cm-variable">setName</span>:(<span class="cm-variable">NSString</span> <span class="cm-operator">*</span>)<span class="cm-variable">name</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  [<span class="cm-variable">name</span> <span class="cm-keyword">retain</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  [<span class="cm-variable">_name</span> <span class="cm-variable">release</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">_name</span> <span class="cm-operator">=</span> <span class="cm-variable">name</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span>(<span class="cm-variable-3">void</span>)<span class="cm-variable">setName</span>:(<span class="cm-variable">NSString</span> <span class="cm-operator">*</span>)<span class="cm-variable">name</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  [<span class="cm-variable">_name</span> <span class="cm-variable">release</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">_name</span> <span class="cm-operator">=</span> [<span class="cm-variable">name</span> <span class="cm-keyword">copy</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span></span></pre></div></div></div></div></div></div></div></pre><h2><a name='header-c2287' class='md-header-anchor '></a>常见的 Http 状态码有哪些？</h2><blockquote><p>http状态吗 ：302 是请求重定向。500以上是服务器错误。400以上是请求链接错误或者找不到服务器。200以上是正确。100以上是请求接受成功。</p></blockquote><hr /><h1><a name='header-c2292' class='md-header-anchor '></a>AFN的原理和封装</h1><blockquote><p>AFN:发送网络请求，封装一句话的网络请求代码，还可以监测网络环境类型，在咱们平时使用的时候会做一个简单的封装</p></blockquote><ol><li>写一个结构体，放请求方式</li><li>单例的全局访问点</li><li>发送请求的方法</li><li>设计的参数：请求方式，请求地址，请求参数，请求完成之后的block回调</li><li>设置解析类型在responseseltype方法中</li></ol><blockquote><p>AFN使用</p></blockquote><ol><li>初始化管理类</li><li>改变解析器类型post get</li><li>发送请求</li><li>一般是要我们自己去封装一下的</li></ol><p><mark>底层是基于NSOPeration 封装了NSURSLSession 和NSURLConnection</mark></p><h1><a name='header-c2330' class='md-header-anchor '></a>二维码：</h1><ol><li>创建过滤器、</li><li>设置默认值inputmessage</li><li>用CIimage生成二维码图片outputimage</li><li>要是想要添加一个图片上去，就采用quer2d</li></ol><hr /><h1><a name='header-c2345' class='md-header-anchor '></a>项目遇到BUG</h1><blockquote><p>哪些情况容易崩溃 日志调用了不存在的方法 seloctor kvc不对等 数组越界崩溃日志</p></blockquote><pre class='md-fences mock-cm' style='display:block;position:relative'>1.(null): URGENT: all bitcode will be dropped because‘xxxx’ was built without bitcode. You must rebuild it with bitcode enabled(Xcode setting ENABLE_BITCODE), obtain an updated library from the vendor, ordisable bitcode for this target. Note: This will be an error in the future.</pre><blockquote><p>从上述的错误中应该可以看出，这是因为一个第三方的库不兼容，我的工程中   开启了ENABLE_BITCODE （应该是升级之后自动转换的），而这个第三方的库在编译的时候没有 enable bitcode，所以导致上诉问题。把enable bitcode设为NO.</p></blockquote><pre class='md-fences mock-cm' style='display:block;position:relative'>2.This application&#39;sapplication-identifier entitlement does not match that of the installedapplication. These values must match for an upgrade to be allowed.</pre><blockquote><p>包名重复，你卸掉原来安装的那个用appstore下载的，要么，把包名改成另一个名字。成功安装到手机后，直接出现登陆界面。</p></blockquote><p>3.<em>iOS](<a href='http://lib.csdn.net/base/1' target='_blank' >http://lib.csdn.net/base/1</a>)开发证书显示“此证书的签发者无效”解决方法</em></p><blockquote><p>删除原来的Apple Worldwide Developer RelationsCertification Authority Intermediate Certificate证书。点击下载最新的：<a href='https://developer.apple.com/certificationauthority/AppleWWDRCA.cer'>https://developer.apple.com/certificationauthority/AppleWWDRCA.cer</a>下载后双击导入即可。</p></blockquote><p>4.不支持armv64 编码</p><pre class='md-fences mock-cm' style='display:block;position:relative'>No architectures to compile for (ONLY_ACTIVE_ARCH=YES,active arch=x86_64, VALID_ARCHS=i386).</pre><p><img src='file://localhost/Users/Steve/Library/Group%20Containers/UBF8T346G9.Office/msoclip1/01/500D804D-D540-094F-B3B6-371001243852.png' alt='计算机生成了可选文字:V Arch itectures Setting Additional SDKs Ar ch itec tures Base SDK Build Active Architecture Only Supported Platforms Valid Architectures Standard architectures (arnw7, arm64) Latest ios OOS C ios v arm64 armv7 armv7s ' /></p><blockquote><p>将Build Active Architecture Only设为YES </p></blockquote><p>5.Could not find Developer Disk Image</p><blockquote><p>设备版本高于Xcode支持的最高版本。升级Xcode就可以。</p></blockquote><p>6.XCode提示有类似C++语法的错误。可能是您在调用接口时没有设置成OC与C++混编模式（具体做法为将调用接口的实现文件改为.mm的后缀）。</p><hr /><p></p></div>
</body>
</html>